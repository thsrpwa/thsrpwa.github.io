import{A as O,B as D,a as xe,b as H,c as $,d as q,e as Ce,g as J,h as ge,j as be,k as ve,l as Se,m as he,n as ye,o as Ee,p as K,q as Q,s as Ie,t as N,u as X,v as A,x as we,y as Te,z as V}from"./chunk-5JAWHIKF.js";import{$ as M,Aa as E,Ba as i,Bb as F,Ca as n,Da as f,Ea as T,Fa as v,Ga as m,L as x,Q as Y,R as S,Ra as l,S as h,Sa as u,Ta as g,Ua as U,V as k,Y as pe,Ya as ie,Z as C,Za as oe,_ as ue,_a as ae,a as de,b as me,ba as s,cb as z,db as re,e as ce,eb as le,fb as se,ga as G,ha as I,ka as _e,ma as p,nb as B,ob as fe,ra as _,sb as W,ta as P,wa as c,ya as w,za as y}from"./chunk-H5KATAC4.js";function Be(t,o){if(t&1&&(i(0,"div",1),f(1,"i",2),l(2),n()),t&2){let e=o.$implicit;s(2),g(" ",e,"")}}function $e(t,o){if(t&1&&(i(0,"div",0),y(1,Be,3,1,"div",1,w),n()),t&2){let e=m();s(),E(e.errors())}}var De=class t{errors=M([]);messageService=x(D);elementRef=x(ue);constructor(){this.messageService.errorComponent=this}focus(){setTimeout(()=>{this.elementRef.nativeElement.scrollIntoView()})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-errors"]],decls:1,vars:1,consts:[[1,"d-flex","flex-column","gap-2","pt-2"],[1,"alert","alert-danger","mb-0","p-2"],[1,"fas","fa-exclamation-circle"]],template:function(e,r){e&1&&p(0,$e,3,0,"div",0),e&2&&c(r.errors().length>0?0:-1)},encapsulation:2})};var ke=(t,o)=>({"d-flex flex-column justify-content-start":t,"d-flex align-items-center":o}),Ve=(t,o)=>({"d-flex flex-column justify-content-start mt-4 pt-2":t,"d-flex align-items-center":o}),Me=class t{readonly=C(!1);personalIdDisabled=C(!1);coperateIdDisabled=C(!1);personalId=G("");coperateId=G("");showing=M(!1);rowStyle=C(!1);enabledPidCheck=B(()=>this.personalId()||this.coperateId());loadingService=x(V);messageService=x(D);destroyRef=x(k);apiService=x(O);constructor(){fe(()=>{if(this.coperateIdDisabled()&&this.coperateId()&&(this.coperateId.set(""),this.hidePid()),this.personalIdDisabled()){let o=this.coperateIdDisabled()?"0":"";this.personalId()!==o&&(this.personalId.set(o),this.hidePid())}})}onPidCheck(){this.showing()?this.hidePid():this.check()}hidePid(){this.showing()&&this.showing.set(!1)}check(){if(this.loadingService.loading)return;this.loadingService.start();let o={membership:{personalId:this.personalId(),coperateId:this.coperateId()}};this.apiService.queryMembership(o).pipe(A(this.destroyRef)).subscribe({next:e=>{this.loadingService.stop();let r="",a="";this.coperateId()?(r="\u4F01\u696D\u6703\u54E1",a=e.corporateMember.companyName):(r=`\u500B\u4EBA\u6703\u54E1-${e.individualMember.membeLevel}`,a=`${e.individualMember.memberName} ${e.individualMember.memberGender}`),this.messageService.show({title:r,message:a}),this.showing.set(!0)},error:e=>{this.loadingService.stop(),this.messageService.handleError(e)},complete:()=>{this.loadingService.stop()}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-member-code"]],inputs:{readonly:[1,"readonly"],personalIdDisabled:[1,"personalIdDisabled"],coperateIdDisabled:[1,"coperateIdDisabled"],personalId:[1,"personalId"],coperateId:[1,"coperateId"],rowStyle:[1,"rowStyle"]},outputs:{personalId:"personalIdChange",coperateId:"coperateIdChange"},decls:15,vars:18,consts:[[1,"w-100","d-flex","align-items-center"],[3,"ngClass"],["for","coperateId",1,"text-nowrap","m-1"],[1,"m-1"],["id","coperateId",1,"form-control","form-control-sm","fs-6",3,"ngModelChange","ngModel","disabled"],["for","personalId",1,"text-nowrap","m-1"],["id","personalId",1,"form-control","form-control-sm","fs-6",3,"ngModelChange","ngModel","disabled"],[1,"mb-1","me-1"],["type","button",1,"btn","btn-secondary","btn-sm","fs-6",3,"click","disabled"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"label",2),l(3,"\u4F01\u696D\u6703\u54E1\u7DE8\u865F"),n(),i(4,"div",3)(5,"input",4),v("ngModelChange",function(d){return r.coperateId.set(d)}),n()()(),i(6,"div",1)(7,"label",5),l(8,"\u500B\u4EBA\u6703\u54E1\u7DE8\u865F"),n(),i(9,"div",3)(10,"input",6),v("ngModelChange",function(d){return r.personalId.set(d)}),n()()(),i(11,"div",1)(12,"div",7)(13,"button",8),v("click",function(){return r.onPidCheck()}),l(14),n()()()()),e&2&&(s(),_("ngClass",z(9,ke,!r.rowStyle(),r.rowStyle())),s(4),_("ngModel",r.coperateId())("disabled",r.readonly()||r.coperateIdDisabled()||!!r.personalId()),s(),_("ngClass",z(12,ke,!r.rowStyle(),r.rowStyle())),s(4),_("ngModel",r.personalId())("disabled",r.readonly()||r.personalIdDisabled()||!!r.coperateId()),s(),_("ngClass",z(15,Ve,!r.rowStyle(),r.rowStyle())),s(2),_("disabled",!r.enabledPidCheck()),s(),g(" ",r.showing()?"\u986F\u793A\u4E2D":"PID\u6703\u54E1\u8CC7\u6599\u6AA2\u6838/\u986F\u793A"," "))},dependencies:[F,W,N,H,q,J],encapsulation:2})};var ee=class t{transform([o,e,r,a]){return r.find(d=>d.carNumber===parseInt(a,10)&&d.col===e&&d.row===parseInt(o,10))}static \u0275fac=function(e){return new(e||t)};static \u0275pipe=_e({name:"seatPassenger",type:t,pure:!0})};var Fe=(t,o,e,r)=>[t,o,e,r],Oe=(t,o)=>o.passengerIndex;function je(t,o){if(t&1&&(i(0,"div",34),l(1),n()),t&2){let e=o.$implicit;s(),g(" ",e," ")}}function Ge(t,o){if(t&1){let e=T();ie(0),le(1,"seatPassenger"),i(2,"a",39),v("click",function(){let a=S(e),d=a.$implicit,b=a.$index,R=ae(0),j=m().$implicit,ne=m(3);return h(ne.selectSeat(j[0],d,j[b+1],R))}),f(3,"i",16)(4,"i",25),l(5),n()}if(t&2){let e=o.$implicit,r=o.$index,a=m().$implicit,d=m(3),b=oe(se(1,4,re(7,Fe,a[0],e,d.passengers(),d.carNumber())));s(2),P("selected",b),_("ngClass",d.seatStatus[a[r+1]].class),s(3),g(" ",b==null?null:b.passengerIndex," ")}}function Ue(t,o){if(t&1&&(i(0,"div",35)(1,"div",37),l(2),n(),y(3,Ge,6,12,"a",38,w),n()),t&2){let e=o.$implicit,r=m();s(2),u(e[0]),s(),E(r.columnName.slice(0,2))}}function Le(t,o){if(t&1&&(i(0,"div",34),l(1),n()),t&2){let e=o.$implicit;s(),g(" ",e," ")}}function Ye(t,o){if(t&1){let e=T();ie(0),le(1,"seatPassenger"),i(2,"a",39),v("click",function(){let a=S(e),d=a.$implicit,b=a.$index,R=ae(0),j=m().$implicit,ne=m(3);return h(ne.selectSeat(j[0],d,j[b+3],R))}),f(3,"i",16)(4,"i",25),l(5),n()}if(t&2){let e=o.$implicit,r=o.$index,a=m().$implicit,d=m(3),b=oe(se(1,4,re(7,Fe,a[0],e,d.passengers(),d.carNumber())));s(2),P("selected",b),_("ngClass",d.seatStatus[a[r+3]].class),s(3),g(" ",b==null?null:b.passengerIndex," ")}}function ze(t,o){if(t&1&&(i(0,"div",35),y(1,Ye,6,12,"a",38,w),i(3,"div",37),l(4),n()()),t&2){let e=o.$implicit,r=m();s(),E(r.columnName.slice(2)),s(3),u(e[0])}}function We(t,o){if(t&1&&(i(0,"div",7)(1,"div",31)(2,"div",32),f(3,"div",33),y(4,je,2,1,"div",34,w),n(),y(6,Ue,5,1,"div",35,w),n(),i(8,"div",36),l(9," \u8D70\u9053 "),n(),i(10,"div",31)(11,"div",32),y(12,Le,2,1,"div",34,w),n(),y(14,ze,5,1,"div",35,w),n()()),t&2){let e=o;s(4),E(e.columnName.slice(0,2)),s(2),E(e.value),s(6),E(e.columnName.slice(2)),s(2),E(e.value)}}function He(t,o){if(t&1&&(i(0,"option",12),l(1),n()),t&2){let e=o.$implicit;_("value",e),s(),g(" ",e," ")}}function Je(t,o){if(t&1&&(i(0,"div",9)(1,"span",40),l(2,"\u8ECA\u5EC2\u7A2E\u985E:"),n(),i(3,"span",41),l(4),n()(),i(5,"div",9)(6,"span",42),l(7,"\u5168\u8ECA\u5EA7\u4F4D\u6578:"),n(),i(8,"span"),l(9),n()(),i(10,"div",9)(11,"span",42),l(12,"\u672C\u8ECA\u5EC2\u5EA7\u4F4D:"),n(),i(13,"span"),l(14),n()()),t&2){let e=o;s(4),u(e.classType),s(5),u(e.regSeat),s(5),u(e.totalSeats)}}function Ke(t,o){if(t&1&&(i(0,"tr")(1,"td",30),l(2),n(),i(3,"td",30),l(4),n(),i(5,"td",30),l(6),n()()),t&2){let e,r=o.$implicit;s(2),u(r.passengerIndex),s(2),u(r.profile),s(2),U(" ",r.carNumber==null||(e=r.carNumber.toString())==null?null:e.padStart(2,"0"),"/",r.col,"",r.row," ")}}function Qe(t,o){if(t&1){let e=T();i(0,"div",0)(1,"p",1),l(2,"\u5EA7\u4F4D\u8868"),n(),i(3,"button",2),v("click",function(){S(e);let a=m();return h(a.ngbActiveModal.close(null))}),n()(),i(4,"div",3)(5,"div",4)(6,"div",5)(7,"span",6),l(8," \u65E5\u671F: "),i(9,"span"),l(10),n()(),i(11,"span",6),l(12),n(),i(13,"span",6),l(14),n(),i(15,"span",6),l(16),n()(),p(17,We,16,0,"div",7),n(),i(18,"div",8)(19,"div",9)(20,"span",10),l(21,"\u8ECA\u5EC2:"),n(),i(22,"select",11),v("ngModelChange",function(a){S(e);let d=m();return h(d.carNumber.set(a))}),y(23,He,2,2,"option",12,w),n()(),p(25,Je,15,3),i(26,"ul",13)(27,"li",9)(28,"span",14),l(29,"\u4E00\u822C\u5EA7\u4F4D"),n(),i(30,"div",15),f(31,"i",16),n(),i(32,"div",17),l(33," N "),n()(),i(34,"li",9)(35,"span",14),l(36,"\u4FDD\u7559\u5EA7\u4F4D"),n(),i(37,"div",18),f(38,"i",16),n(),f(39,"div",19),n(),i(40,"li",9)(41,"span",14),l(42,"\u656C\u8001\u611B\u5FC3\u5EA7"),n(),i(43,"div",20),f(44,"i",16),n(),i(45,"div",21),l(46," N "),n()(),i(47,"li",9)(48,"span",14),l(49,"\u7121\u969C\u7919\u5EA7\u4F4D"),n(),i(50,"div",22),f(51,"i",16),n(),i(52,"div",23),l(53," N "),n()(),i(54,"li",9)(55,"span",14),l(56,"\u5DF2\u88AB\u5360\u7528\u5EA7"),n(),i(57,"div",24),f(58,"i",25),n(),f(59,"div",19),n()(),i(60,"button",26),v("click",function(){S(e);let a=m();return h(a.reset())}),l(61,"\u5EA7\u4F4D\u91CD\u8A2D"),n(),i(62,"button",27),v("click",function(){S(e);let a=m();return h(a.confirm())}),l(63,"\u5EA7\u4F4D\u78BA\u8A8D"),n(),i(64,"table",28)(65,"thead",29)(66,"tr")(67,"th",30),l(68,"\u7DE8\u865F"),n(),i(69,"th",30),l(70,"\u8EAB\u5206\u5225"),n(),i(71,"th",30),l(72,"\u8ECA\u5EC2/\u5EA7\u4F4D"),n()()(),i(73,"tbody"),y(74,Ke,7,5,"tr",null,Oe),n()()()()}if(t&2){let e,r,a=o,d=m();s(10),g("",a.date," "),s(2),g("\u8ECA\u6B21: ",a.trainNumber,""),s(2),g("\u51FA\u767C\u7AD9: ",a.departStation,""),s(2),g("\u5230\u9054\u7AD9: ",a.arrivalStation,""),s(),c((e=d.seat())?17:-1,e),s(5),_("ngModel",d.carNumber()),s(),E(d.carNumbers()),s(2),c((r=d.seat())?25:-1,r),s(37),_("disabled",!d.allSelected()),s(12),E(d.passengers())}}var Ne={};[{symbol:"",class:"invisible"},{symbol:"V",class:"seat-reserved"},{symbol:"$",class:"seat-taken"},{symbol:"@",class:"seat-available"},{symbol:"@C",class:"seat-priority"},{symbol:"@W",class:"seat-accessibility"}].forEach(t=>{Ne[t.symbol]=t});var te=class t{seatStatus=Ne;seatData=M(null);passengers=M([]);carNumber=M("");carNumbers=B(()=>this.seatData()?.seats.map(o=>o.carNumber)||[]);seat=B(()=>{let o=this.seatData()?.seats||[],e=this.carNumber();return o.find(a=>a.carNumber===e)});allSelected=B(()=>this.passengers().every(o=>o.col&&o.row));ngbActiveModal=x(we);loadingService=x(V);apiService=x(O);messageService=x(D);destroyRef=x(k);ngOnInit(){this.setCarNumber()}ngOnChanges(){this.setCarNumber()}selectSeat(o,e,r,a){if(a){a.col=void 0,a.row=void 0,a.carNumber=void 0,this.passengers.set([...this.passengers()]);return}r==="$"||r==="V"||(a=this.passengers().find(d=>!d.carNumber),a&&(a.col=e,a.row=parseInt(o,10),a.carNumber=parseInt(this.carNumber(),10),this.passengers.set([...this.passengers()])))}reset(){this.passengers.update(o=>o.map(e=>me(de({},e),{col:void 0,row:void 0,carNumber:void 0})))}confirm(){if(this.loadingService.loading)return;this.loadingService.start();let o={pnrId:"",trainNumber:this.seatData()?.trainNumber,newSeats:this.toRequestSeats(this.passengers())};this.apiService.bookSetSeat(o).pipe(A(this.destroyRef)).subscribe({next:e=>{this.loadingService.stop(),this.ngbActiveModal.close(e.data.trip)},error:e=>{this.loadingService.stop(),this.messageService.handleError(e)},complete:()=>{this.loadingService.stop()}})}toRequestSeats(o){return o.map(e=>({passengerIndex:e.passengerIndex,carNumber:e.carNumber,row:e.row,col:e.col}))}setCarNumber(){let o=!1,e=this.passengers()[0];e?.carNumber&&(this.carNumber.set(e.carNumber.toString()),o=!0),o||this.carNumber.set(this.carNumbers()[0])}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-seat-modal"]],features:[Y],decls:1,vars:1,consts:[[1,"modal-header","bg-warning-subtle","align-items-center","justify-content-between"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","d-flex","align-items-start"],[1,"flex-grow-1"],[1,"fs-6"],[1,"ms-3"],[1,"d-flex","justify-content-start","ms-5"],[1,"mx-4","fs-6","w-30"],[1,"d-flex","text-nowrap","align-items-center","m-2","justify-content-between"],[1,"me-2"],[1,"form-select","form-select-sm","fs-7","ml-2",3,"ngModelChange","ngModel"],[3,"value"],[1,"list-unstyled"],[1,"legend-box"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","ms-auto"],[1,"fas","fa-chair"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-available","selected"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-reserved","ms-auto"],[1,"m-1","w-30-px"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-priority","ms-auto"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-priority","selected"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-accessibility","ms-auto"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-accessibility","selected"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-taken","ms-auto"],[1,"fas","fa-ban"],[1,"btn","btn-secondary","btn-sm","me-1",3,"click"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],[1,"table","mt-3","table-bordered","text-center","align-middle"],[1,"table-light"],[1,"text-nowrap"],[1,"mt-3"],[1,"d-flex","gap-3","mb-1"],[1,"text-center","fw-bold","w-30-px"],[1,"text-center","fw-bold","bg-warning-subtle","w-30-px"],[1,"d-flex","align-items-center","gap-3","mb-1"],[1,"w-5","container","my-3","mx-3","d-flex","align-items-center","justify-content-center","flex-column","bg-warning-subtle"],[1,"text-center","bg-warning-subtle","w-30-px"],["href","javascript:;",1,"d-flex","align-items-center","justify-content-center","border","w-30-px","seat","text-decoration-none",3,"ngClass","selected"],["href","javascript:;",1,"d-flex","align-items-center","justify-content-center","border","w-30-px","seat","text-decoration-none",3,"click","ngClass"],[1,"me-1","text-end"],[1,"text-start"],[1,"me-1"]],template:function(e,r){if(e&1&&p(0,Qe,76,8),e&2){let a;c((a=r.seatData())?0:-1,a)}},dependencies:[F,W,N,K,Q,Ee,q,J,ee],styles:[".seat[_ngcontent-%COMP%]{height:30px;border-radius:4px}.seat[_ngcontent-%COMP%]   .fa-ban[_ngcontent-%COMP%], .seat.selected[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]{display:none}.seat-reserved[_ngcontent-%COMP%]{color:#0dcaf0}.seat-priority[_ngcontent-%COMP%]{color:#ffc107}.seat-priority.selected[_ngcontent-%COMP%]{background-color:#ffc107;color:#000}.seat-accessibility[_ngcontent-%COMP%]{color:#0d6efd}.seat-accessibility.selected[_ngcontent-%COMP%]{background-color:#0d6efd;color:#000}.seat-available[_ngcontent-%COMP%]{color:#000}.seat-available.selected[_ngcontent-%COMP%]{background-color:#d63384}.seat-taken[_ngcontent-%COMP%]{color:#000}.seat-taken[_ngcontent-%COMP%]   .fa-ban[_ngcontent-%COMP%]{display:inline}.seat-taken[_ngcontent-%COMP%]   .fa-chair[_ngcontent-%COMP%]{display:none}"]})};function Xe(t,o){t&1&&f(0,"th",2)}function Ze(t,o){t&1&&(i(0,"th",2),l(1,"\u5EA7\u4F4D\u9078\u64C7"),n())}function et(t,o){t&1&&(i(0,"td"),f(1,"input",3),n())}function tt(t,o){t&1&&(i(0,"td"),l(1,"\u53BB"),n())}function nt(t,o){t&1&&(i(0,"td"),l(1,"\u53BB\u7A0B\u5217\u8ECA"),n())}function it(t,o){if(t&1){let e=T();i(0,"td")(1,"button",4),v("click",function(){S(e);let a=m(2);return h(a.selectSeat(!0))}),l(2,"\u5EA7\u4F4D\u8868"),n()()}}function ot(t,o){if(t&1&&(i(0,"tr"),p(1,et,2,0,"td")(2,tt,2,0,"td")(3,nt,2,0,"td"),i(4,"td"),l(5),n(),i(6,"td"),l(7),n(),i(8,"td"),l(9),n(),i(10,"td"),l(11),n(),i(12,"td"),l(13),n(),i(14,"td"),l(15),n(),i(16,"td"),l(17),n(),i(18,"td"),l(19),n(),i(20,"td"),l(21),n(),p(22,it,3,0,"td"),n()),t&2){let e=o,r=m();s(),c(r.hasCheckbox()?1:-1),s(),c(r.isShort()?2:-1),s(),c(r.isShort()?-1:3),s(2),u(e.discount),s(2),u(e.trainNumber),s(2),u(e.departStation),s(2),u(e.arrivalStation),s(2),u(e.departDate),s(2),u(e.departTime),s(2),u(e.arrivalTime),s(2),u(e.elapseTime),s(2),u(e.carriage),s(),c(r.seatSelectable()?22:-1)}}function at(t,o){t&1&&(i(0,"td"),f(1,"input",3),n())}function rt(t,o){t&1&&(i(0,"td"),l(1,"\u56DE"),n())}function lt(t,o){t&1&&(i(0,"td"),l(1,"\u56DE\u7A0B\u5217\u8ECA"),n())}function st(t,o){if(t&1){let e=T();i(0,"td")(1,"button",4),v("click",function(){S(e);let a=m(3);return h(a.selectSeat(!1))}),l(2,"\u5EA7\u4F4D\u8868"),n()()}}function dt(t,o){if(t&1&&(i(0,"tr"),p(1,at,2,0,"td")(2,rt,2,0,"td")(3,lt,2,0,"td"),i(4,"td"),l(5),n(),i(6,"td"),l(7),n(),i(8,"td"),l(9),n(),i(10,"td"),l(11),n(),i(12,"td"),l(13),n(),i(14,"td"),l(15),n(),i(16,"td"),l(17),n(),i(18,"td"),l(19),n(),i(20,"td"),l(21),n(),p(22,st,3,0,"td"),n()),t&2){let e=o,r=m(2);s(),c(r.hasCheckbox()?1:-1),s(),c(r.isShort()?2:-1),s(),c(r.isShort()?-1:3),s(2),u(e.discount),s(2),u(e.trainNumber),s(2),u(e.departStation),s(2),u(e.arrivalStation),s(2),u(e.departDate),s(2),u(e.departTime),s(2),u(e.arrivalTime),s(2),u(e.elapseTime),s(2),u(e.carriage),s(),c(r.seatSelectable()?22:-1)}}function mt(t,o){if(t&1&&p(0,dt,23,13,"tr"),t&2){let e,r=m();c((e=r.inbound())?0:-1,e)}}var Ae=class t{outbound=C();inbound=C();seatSelectable=C(!0);roundTrip=C(!1);passengers=C();isShort=C(!0);hasCheckbox=C(!0);seatChange=pe();ngbModal=x(Te);loadingService=x(V);apiService=x(O);messageService=x(D);destroyRef=x(k);data=null;selectSeat(o){if(this.loadingService.loading)return;this.loadingService.start();let e=o?this.outbound():this.inbound(),r=this.getPassengers(o),a={pnrId:"",trainNumber:e?.trainNumber,classType:e?.carriage==="\u6A19\u6E96\u8ECA\u5EC2"?"Y":"N",originalSeats:this.toRequestSeats(r)};this.apiService.bookSeatMap(a).pipe(A(this.destroyRef)).subscribe({next:d=>{this.loadingService.stop(),this.data=d.data,this.openSeatModal(r)},error:d=>{this.loadingService.stop(),this.messageService.handleError(d)},complete:()=>{this.loadingService.stop()}})}openSeatModal(o){return ce(this,null,function*(){let e=this.ngbModal.open(te,{size:"lg",centered:!0,scrollable:!0,backdrop:"static"});e.componentInstance.seatData.set(this.data),e.componentInstance.passengers.set(o);let r=yield e.result;r&&this.seatChange.emit(r)})}getPassengers(o){return(this.passengers()||[]).map(e=>{let r=o?"OUTBOUND":"INBOUND",a=e.tickets.find(d=>d.journey===r);return{profile:e.profile,passengerIndex:e.index,carNumber:a.car,row:a.seatRow,col:a.seatCol}})}toRequestSeats(o){return o.map(e=>({passengerIndex:e.passengerIndex,carNumber:e.carNumber,row:e.row,col:e.col}))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-bound"]],inputs:{outbound:[1,"outbound"],inbound:[1,"inbound"],seatSelectable:[1,"seatSelectable"],roundTrip:[1,"roundTrip"],passengers:[1,"passengers"],isShort:[1,"isShort"],hasCheckbox:[1,"hasCheckbox"]},outputs:{seatChange:"seatChange"},decls:27,vars:4,consts:[[1,"table","table-sm","table-striped","table-hover","table-bordered","table-sticky-header","text-center","align-middle","m-0"],[1,"table-warning","backdrop-blur"],[1,"text-nowrap"],["type","checkbox",1,"form-check-input","me-1","flex-grow-1"],[1,"btn","btn-primary",3,"click"]],template:function(e,r){if(e&1&&(i(0,"table",0)(1,"thead",1)(2,"tr"),p(3,Xe,1,0,"th",2),f(4,"th",2),i(5,"th",2),l(6,"\u512A\u60E0*"),n(),i(7,"th",2),l(8,"\u8ECA\u6B21"),n(),i(9,"th",2),l(10,"\u51FA\u767C\u7AD9"),n(),i(11,"th",2),l(12,"\u5230\u9054\u7AD9"),n(),i(13,"th",2),l(14,"\u51FA\u767C\u65E5\u671F"),n(),i(15,"th",2),l(16,"\u51FA\u767C\u6642\u9593"),n(),i(17,"th",2),l(18,"\u5230\u9054\u6642\u9593"),n(),i(19,"th",2),l(20,"\u884C\u8ECA\u6642\u9593"),n(),i(21,"th",2),l(22,"\u5EC2\u7B49"),n(),p(23,Ze,2,0,"th",2),n()(),i(24,"tbody"),p(25,ot,23,13,"tr")(26,mt,1,1),n()()),e&2){let a;s(3),c(r.hasCheckbox()?3:-1),s(20),c(r.seatSelectable()?23:-1),s(2),c((a=r.outbound())?25:-1,a),s(),c(r.roundTrip()?26:-1)}},dependencies:[N,F,X],encapsulation:2})};var ct=(t,o)=>o.index;function pt(t,o){t&1&&f(0,"th",3)}function ut(t,o){t&1&&(i(0,"th",3),l(1,"\u8A3B\u8A18"),n())}function _t(t,o){t&1&&(i(0,"td"),f(1,"input",23),n())}function ft(t,o){if(t&1&&(i(0,"td")(1,"select",24)(2,"option"),l(3),n()()()),t&2){let e=m().$implicit;s(3),u(e.profile)}}function xt(t,o){if(t&1&&(i(0,"td"),l(1),n()),t&2){let e=m().$implicit;s(),u(e.profile)}}function Ct(t,o){if(t&1&&l(0),t&2){let e=m().$implicit;g(" ",e.personalId," ")}}function gt(t,o){t&1&&(i(0,"span",12),l(1,"*"),n())}function bt(t,o){if(t&1){let e=T();i(0,"input",25),v("change",function(){S(e);let a=m().$index,d=m();return h(d.onPersonalIdChange(a))}),n(),p(1,gt,2,0,"span",12),f(2,"input",26)}if(t&2){let e=m(),r=e.$implicit,a=e.$index;P("invisible",a===0),_("id","personalIdCheck-"+r.index),s(),c(r.personalIdRequired?1:-1),s(),_("id","personalId-"+r.index)}}function vt(t,o){if(t&1&&l(0),t&2){let e=m().$implicit;g(" ",e.expiryDate," ")}}function St(t,o){t&1&&(i(0,"span",12),l(1,"*"),n())}function ht(t,o){if(t&1&&(p(0,St,2,0,"span",12),f(1,"input",27)),t&2){let e=m().$implicit;c(e!=null&&e.expiryDateRequired?0:-1),s(),_("id","expiryDate-"+e.index)}}function yt(t,o){t&1&&(i(0,"span",12),l(1,"*"),n())}function Et(t,o){if(t&1&&(i(0,"label",19),l(1,"\u53BB:"),n()),t&2){let e=m().$implicit;_("for","outboundCoupon-"+e.index)}}function It(t,o){if(t&1&&l(0),t&2){let e=m().$implicit;g(" ",e.outbound==null?null:e.outbound.coupon," ")}}function wt(t,o){t&1&&(i(0,"span",12),l(1,"*"),n())}function Tt(t,o){if(t&1&&(p(0,wt,2,0,"span",12),f(1,"input",28)),t&2){let e=m().$implicit;c(e.outboundCouponRequired?0:-1),s(),_("id","outboundCoupon-"+e.index)}}function Dt(t,o){if(t&1&&l(0),t&2){let e=m(2).$implicit;g(" ",e.inbound==null?null:e.inbound.coupon," ")}}function kt(t,o){t&1&&(i(0,"span",12),l(1,"*"),n())}function Mt(t,o){if(t&1&&(p(0,kt,2,0,"span",12),f(1,"input",29)),t&2){let e=m(2).$implicit;c(e.inboundCouponRequired?0:-1),s(),_("id","inboundCoupon-"+e.index)}}function Pt(t,o){if(t&1&&(i(0,"div",20)(1,"label",19),l(2,"\u56DE:"),n(),p(3,Dt,1,1)(4,Mt,2,2),n()),t&2){let e=m().$implicit,r=m();s(),_("for","inboundCoupon-"+e.index),s(2),c(r.readonly()?3:4)}}function Ft(t,o){if(t&1&&(i(0,"span",22)(1,"span"),l(2,"NT$"),n(),l(3),n()),t&2){let e=m().$implicit;s(3),u(e==null||e.inbound==null?null:e.inbound.fare)}}function Nt(t,o){if(t&1&&(i(0,"span",22),l(1),n()),t&2){let e=m().$implicit;s(),U("",e.inbound==null?null:e.inbound.car,"/",e.inbound==null?null:e.inbound.seatRow,"",e.inbound==null?null:e.inbound.seatCol,"")}}function At(t,o){t&1&&(i(0,"td"),l(1,"132"),n())}function Rt(t,o){if(t&1){let e=T();i(0,"tr",7),p(1,_t,2,0,"td"),i(2,"td"),l(3),n(),p(4,ft,4,1,"td")(5,xt,2,1,"td"),i(6,"td")(7,"div",8),p(8,Ct,1,1)(9,bt,3,5),n()(),i(10,"td",9)(11,"div",10),p(12,vt,1,1)(13,ht,2,2),n()(),i(14,"td",11),p(15,yt,2,0,"span",12),f(16,"input",13),i(17,"label",14),l(18,"\u6709"),n(),f(19,"input",13),i(20,"label",15),l(21,"\u7121"),n()(),i(22,"td",11)(23,"div",16)(24,"input",17),v("change",function(){let a=S(e).$index,d=m();return h(d.onNoIdDocumentChange(a))}),n(),i(25,"label",14),l(26,"\u7121\u8B49\u4EF6"),n()()(),i(27,"td")(28,"div",18)(29,"div",16),p(30,Et,2,1,"label",19)(31,It,1,1)(32,Tt,2,2),n(),p(33,Pt,5,2,"div",20),n()(),i(34,"td")(35,"div",18)(36,"span",21)(37,"span"),l(38,"NT$"),n(),l(39),n(),p(40,Ft,4,1,"span",22),n()(),i(41,"td")(42,"div",18)(43,"span",21),l(44),n(),p(45,Nt,2,3,"span",22),n()(),p(46,At,2,0,"td"),n()}if(t&2){let e=o.$implicit,r=o.$index,a=m();_("formGroupName",r),s(),c(a.showRowCheckbox()?1:-1),s(2),g(" ",e.index," "),s(),c(a.isSelect()?4:-1),s(),c(a.isSelect()?-1:5),s(3),c(a.readonly()?8:9),s(4),c(a.readonly()?12:13),s(3),c(!a.readonly()&&e.needCompanionRequired?15:-1),s(),P("disabled",a.readonly()),_("id","needCompanionYes-"+e.index)("readonly",a.readonly()?"true":null)("value",!0),s(),_("for","needCompanionYes-"+e.index),s(2),P("disabled",a.readonly()),_("id","needCompanionNo-"+e.index)("readonly",a.readonly()?"true":null)("value",!1),s(),_("for","needCompanionNo-"+e.index),s(4),P("disabled",a.readonly()),_("id","noIdDocument-"+e.index)("readonly",a.readonly()?"true":null),s(),_("for","noIdDocument-"+e.index),s(5),c(a.roundTrip()?30:-1),s(),c(a.readonly()?31:32),s(2),c(a.roundTrip()?33:-1),s(6),u(e==null||e.outbound==null?null:e.outbound.fare),s(),c(a.roundTrip()?40:-1),s(4),U("",e.outbound==null?null:e.outbound.car,"/",e.outbound==null?null:e.outbound.seatRow,"",e.outbound==null?null:e.outbound.seatCol,""),s(),c(a.roundTrip()?45:-1),s(),c(a.showRowMarker()?46:-1)}}var Re=class t{passengers=C();roundTrip=C(!1);readonly=C(!1);promotion=C(null);needToCheck=G(!1);isSelect=C(!1);showRowCheckbox=C(!1);showRowMarker=C(!1);form;formBuilder=x(Ie);destroyRef=x(k);messageService=x(D);constructor(){this.form=this.formBuilder.group({passengers:this.formBuilder.array([])}),this.form.valueChanges.pipe(A(this.destroyRef)).subscribe(()=>{let e=(this.form.get("passengers")?.value||[]).some(r=>(r.profile==="\u611B\u5FC3"||r.profile==="\u656C\u8001")&&!r.noIdDocument);this.needToCheck.set(e)})}ngOnChanges(o){if(o.passengers||"promotion"in o){let e=o.promotion?.currentValue,r=o.passengers.currentValue.map(a=>{a.outbound=a.tickets.find(R=>R.journey==="OUTBOUND"),a.inbound=a.tickets.find(R=>R.journey==="INBOUND"),a.personalIdRequired=a.profile==="\u611B\u5FC3"||a.profile==="\u656C\u8001",e&&(a.profile==="\u6210\u4EBA"||a.profile==="\u5B69\u7AE5")&&(a.personalIdRequired=e.adultChildId),a.expiryDateRequired=a.profile==="\u611B\u5FC3",a.needCompanionRequired=a.profile==="\u611B\u5FC3";let d=a.profile==="\u7279\u60E0\u5168"||a.profile==="\u7279\u60E0\u534A"||e?.voucherNumberRequired;a.outboundCouponRequired=d,a.inboundCouponRequired=d;let b=a.profile==="\u611B\u5FC3"||a.profile==="\u656C\u8001";return this.formBuilder.group({index:[a.index],profile:[a.profile],personalIdCheck:[{value:!1,disabled:!a.personalIdRequired}],personalId:[{value:a.personalId||"",disabled:!a.personalIdRequired},a.personalIdRequired?[$.required]:[]],expiryDate:[{value:a.expiryDate||"",disabled:!a.expiryDateRequired},a.expiryDateRequired?[$.required]:[]],needCompanion:[{value:a.needCompanion,disabled:!a.needCompanionRequired},a.needCompanionRequired?[$.required]:[]],noIdDocument:[{value:a.noIdDocument||!1,disabled:!b}],outboundCoupon:[a.outbound?.coupon||"",a.outboundCouponRequired?[$.required]:[]],inboundCoupon:[a.inbound?.coupon||"",a.inboundCouponRequired?[$.required]:[]]})});this.form.setControl("passengers",this.formBuilder.array(r))}}onPersonalIdChange(o){let e=this.form.get(`passengers.${o-1}`),r=this.form.get(`passengers.${o}`);r.get("personalIdCheck")?.value?r.get("personalId")?.setValue(e.get("personalId")?.value):r.get("personalId")?.setValue("")}onNoIdDocumentChange(o){let e=this.form.get(`passengers.${o}`);e.get("profile")?.value==="\u611B\u5FC3"&&(e.get("noIdDocument").value?(e.get("needCompanion")?.disable(),e.get("expiryDate")?.disable()):(e.get("needCompanion")?.enable(),e.get("expiryDate")?.enable()))}getValues(){return this.form.value.passengers.map(e=>({index:e.index,profile:e.profile,personalId:e.personalId,expiryDate:e.expiryDate?.replaceAll("-","/"),needCompanion:e.needCompanion,noIdDocument:e.noIdDocument,outbound:{coupon:e.outboundCoupon},inbound:{coupon:e.inboundCoupon}}))}setPassengers(o){let e=this.getValues();for(let a of o)for(let d of e.filter(b=>b.personalId===a.personalId)){let b=this.form.get(`passengers.${d.index-1}`);b.get("expiryDate")?.enabled&&b.patchValue({expiryDate:a.expiryDate.replaceAll("/","-"),needCompanion:a.needCompanion})}let r=[];for(let a of(this.passengers()||[]).filter(d=>d.expiryDateRequired))this.form.get(`passengers.${a.index-1}`).get("expiryDate")?.value||r.push(`\u4E58\u5BA2${a.index}\u8CC7\u6599\u4E0D\u5B58\u5728\u65BC\u7CFB\u7D71\uFF0C\u8ACB\u4F9D\u65C5\u5BA2\u8B49\u4EF6\u8FA6\u7406\u8CC7\u6599\u767B\u9304`);this.form.markAllAsTouched(),this.messageService.setErrors(r)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-passengers"]],inputs:{passengers:[1,"passengers"],roundTrip:[1,"roundTrip"],readonly:[1,"readonly"],promotion:[1,"promotion"],needToCheck:[1,"needToCheck"],isSelect:[1,"isSelect"],showRowCheckbox:[1,"showRowCheckbox"],showRowMarker:[1,"showRowMarker"]},outputs:{needToCheck:"needToCheckChange"},features:[Y],decls:27,vars:3,consts:[[3,"formGroup"],[1,"table","table-sm","table-striped","table-hover","table-bordered","table-sticky-header","text-center","align-middle","m-0"],[1,"table-warning","backdrop-blur"],[1,"text-nowrap"],[1,"text-nowrap","id-col"],[1,"text-nowrap","expiry-col"],["formArrayName","passengers"],[3,"formGroupName"],[1,"id-col","d-flex","align-items-center"],[1,"expiry-col"],[1,"d-flex","align-items-center","justify-content-center"],[1,"align-items-center","text-nowrap"],[1,"m-1","text-danger"],["type","radio","formControlName","needCompanion",1,"form-check-input","me-1",3,"id","readonly","value"],[1,"form-check-label","me-2",3,"for"],[1,"form-check-label",3,"for"],[1,"d-flex","align-items-center"],["type","checkbox","formControlName","noIdDocument",1,"form-check-input","me-1","fs-6",3,"change","id","readonly"],[1,"d-flex","flex-column","justify-content-start"],[1,"me-1",3,"for"],[1,"d-flex","align-items-center","mt-1"],[1,"me-1","mb-2"],[1,"me-1","mb-1"],["type","checkbox","id","select-1",1,"form-check-input","me-1","flex-grow-1"],["disabled","",1,"form-select","form-select-sm","fs-7","ml-2"],["type","checkbox","formControlName","personalIdCheck",1,"form-check-input","me-1","fs-6","flex-grow-1",3,"change","id"],["type","text","formControlName","personalId",1,"fs-6","form-control","form-control-sm","flex-grow-1",3,"id"],["type","date","formControlName","expiryDate",1,"fs-6","form-control","form-control-sm","flex-1",3,"id"],["type","text","formControlName","outboundCoupon",1,"fs-6","form-control","form-control-sm","flex-grow-1",3,"id"],["type","text","formControlName","inboundCoupon",1,"fs-6","form-control","form-control-sm","flex-grow-1",3,"id"]],template:function(e,r){e&1&&(i(0,"form",0)(1,"table",1)(2,"thead",2)(3,"tr"),p(4,pt,1,0,"th",3),i(5,"th",3),l(6,"\u7DE8\u865F"),n(),i(7,"th",3),l(8,"\u8EAB\u5206\u5225"),n(),i(9,"th",4),l(10,"\u8EAB\u5206\u8B49\u865F/\u8B77\u7167\u865F\u78BC"),n(),i(11,"th",5),l(12,"\u6548\u671F"),n(),i(13,"th",3),l(14,"\u966A\u4F34\u8CC7\u683C"),n(),i(15,"th",3),l(16,"\u7121\u8B49\u4EF6"),n(),i(17,"th",3),l(18,"\u514C\u63DB\u5238\u865F\u78BC"),n(),i(19,"th",3),l(20,"\u7968\u50F9"),n(),i(21,"th",3),l(22,"\u8ECA\u5EC2/\u5EA7\u4F4D"),n(),p(23,ut,2,0,"th",3),n()(),i(24,"tbody",6),y(25,Rt,47,35,"tr",7,ct),n()()()),e&2&&(_("formGroup",r.form),s(4),c(r.showRowCheckbox()?4:-1),s(19),c(r.showRowMarker()?23:-1),s(2),E(r.passengers()))},dependencies:[N,ge,K,Q,H,xe,be,q,Ce,F,X,ve,ye,Se,he],styles:[".id-col[_ngcontent-%COMP%], .expiry-col[_ngcontent-%COMP%]{max-width:160px}.expiry-col[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{min-width:0}"]})};export{Me as a,Ae as b,Re as c,De as d};
