import{A as q,B as D,a as xe,b as K,c as R,d as V,e as Ce,g as Q,h as be,j as ge,k as ve,l as Se,m as he,n as ye,o as Ee,p as X,q as Z,s as Ie,t as P,u as ee,v as A,x as we,y as Te,z as O}from"./chunk-W3S6NECQ.js";import{$ as k,Aa as E,Ba as o,Bb as N,Ca as n,Da as f,Ea as T,Fa as v,Ga as m,L as x,Q as z,R as S,Ra as r,S as h,Sa as u,Ta as g,Ua as L,V as M,Ya as ae,Z as C,Za as re,_ as ue,_a as le,a as ce,b as pe,ba as l,cb as H,db as se,eb as de,fb as me,ga as G,ha as I,j as U,ka as _e,ma as p,nb as B,ob as fe,ra as _,sb as J,ta as F,wa as c,y as Y,ya as w,za as y}from"./chunk-6URDJDZ6.js";function Ve(t,i){if(t&1&&(o(0,"div",1),f(1,"i",2),r(2),n()),t&2){let e=i.$implicit;l(2),g(" ",e,"")}}function Oe(t,i){if(t&1&&(o(0,"div",0),y(1,Ve,3,1,"div",1,w),n()),t&2){let e=m();l(),E(e.errors())}}var De=class t{errors=k([]);messageService=x(D);elementRef=x(ue);constructor(){this.messageService.errorComponent=this}focus(){setTimeout(()=>{this.elementRef.nativeElement.scrollIntoView()})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-errors"]],decls:1,vars:1,consts:[[1,"d-flex","flex-column","gap-2","pt-2"],[1,"alert","alert-danger","mb-0","p-2"],[1,"fas","fa-exclamation-circle"]],template:function(e,s){e&1&&p(0,Oe,3,0,"div",0),e&2&&c(s.errors().length>0?0:-1)},encapsulation:2})};var Me={individualMember:{memberName:"\u738B\u5C0F\u660E",membeLevel:"\u666E\u5361",memberGender:"\u5148\u751F/\u5C0F\u59D0",memberCardID:"GA11114668"},corporateMember:{companyName:"\u795E\u901A\u8CC7\u8A0A\u79D1\u6280\u80A1\u4EFD\u6709\u9650\u516C\u53F8",isMember:"\u6703\u54E1"}};var ke=(t,i)=>({"d-flex flex-column justify-content-start":t,"d-flex align-items-center":i}),je=(t,i)=>({"d-flex flex-column justify-content-start mt-4 pt-2":t,"d-flex align-items-center":i}),Fe=class t{readonly=C(!1);personalIdDisabled=C(!1);coperateIdDisabled=C(!1);personalId=G("");coperateId=G("");showing=k(!1);rowStyle=C(!1);enabledPidCheck=B(()=>this.personalId()||this.coperateId());loadingService=x(O);messageService=x(D);destroyRef=x(M);apiService=x(q);constructor(){fe(()=>{if(this.coperateIdDisabled()&&this.coperateId()&&(this.coperateId.set(""),this.hidePid()),this.personalIdDisabled()){let i=this.coperateIdDisabled()?"0":"";this.personalId()!==i&&(this.personalId.set(i),this.hidePid())}})}onPidCheck(){this.showing()?this.hidePid():this.check()}hidePid(){this.showing()&&this.showing.set(!1)}check(){if(this.loadingService.loading)return;this.loadingService.start();let i={membership:{personalId:this.personalId(),coperateId:this.coperateId()}};this.apiService.queryMembership(i).pipe(A(this.destroyRef)).subscribe({next:e=>{this.loadingService.stop();let s="",a="";this.coperateId()?(s="\u4F01\u696D\u6703\u54E1",a=e.corporateMember.companyName):(s=`\u500B\u4EBA\u6703\u54E1-${e.individualMember.membeLevel}`,a=`${e.individualMember.memberName} ${e.individualMember.memberGender}`),this.messageService.show({title:s,message:a}),this.showing.set(!0)},error:e=>{this.loadingService.stop(),this.messageService.handleError(e)},complete:()=>{this.loadingService.stop()}})}request(i){return console.log(i),U(Me).pipe(Y(100))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-member-code"]],inputs:{readonly:[1,"readonly"],personalIdDisabled:[1,"personalIdDisabled"],coperateIdDisabled:[1,"coperateIdDisabled"],personalId:[1,"personalId"],coperateId:[1,"coperateId"],rowStyle:[1,"rowStyle"]},outputs:{personalId:"personalIdChange",coperateId:"coperateIdChange"},decls:15,vars:18,consts:[[1,"w-100","d-flex","align-items-center"],[3,"ngClass"],["for","coperateId",1,"text-nowrap","m-1"],[1,"m-1"],["id","coperateId",1,"form-control","form-control-sm","fs-6",3,"ngModelChange","ngModel","disabled"],["for","personalId",1,"text-nowrap","m-1"],["id","personalId",1,"form-control","form-control-sm","fs-6",3,"ngModelChange","ngModel","disabled"],[1,"mb-1","me-1"],["type","button",1,"btn","btn-secondary","btn-sm","fs-6",3,"click","disabled"]],template:function(e,s){e&1&&(o(0,"div",0)(1,"div",1)(2,"label",2),r(3,"\u4F01\u696D\u6703\u54E1\u7DE8\u865F"),n(),o(4,"div",3)(5,"input",4),v("ngModelChange",function(d){return s.coperateId.set(d)}),n()()(),o(6,"div",1)(7,"label",5),r(8,"\u500B\u4EBA\u6703\u54E1\u7DE8\u865F"),n(),o(9,"div",3)(10,"input",6),v("ngModelChange",function(d){return s.personalId.set(d)}),n()()(),o(11,"div",1)(12,"div",7)(13,"button",8),v("click",function(){return s.onPidCheck()}),r(14),n()()()()),e&2&&(l(),_("ngClass",H(9,ke,!s.rowStyle(),s.rowStyle())),l(4),_("ngModel",s.coperateId())("disabled",s.readonly()||s.coperateIdDisabled()||!!s.personalId()),l(),_("ngClass",H(12,ke,!s.rowStyle(),s.rowStyle())),l(4),_("ngModel",s.personalId())("disabled",s.readonly()||s.personalIdDisabled()||!!s.coperateId()),l(),_("ngClass",H(15,je,!s.rowStyle(),s.rowStyle())),l(2),_("disabled",!s.enabledPidCheck()),l(),g(" ",s.showing()?"\u986F\u793A\u4E2D":"PID\u6703\u54E1\u8CC7\u6599\u6AA2\u6838/\u986F\u793A"," "))},dependencies:[N,J,P,K,V,Q],encapsulation:2})};var ne=class t{transform([i,e,s,a]){let d=`${i}${e}`,b=a.toString().padStart(2,"0");return s.find($=>$.car===b&&$.seat===d)}static \u0275fac=function(e){return new(e||t)};static \u0275pipe=_e({name:"seatPassenger",type:t,pure:!0})};var Pe=(t,i,e,s)=>[t,i,e,s],Ge=(t,i)=>i.index;function Le(t,i){if(t&1&&(o(0,"div",34),r(1),n()),t&2){let e=i.$implicit;l(),g(" ",e," ")}}function We(t,i){if(t&1){let e=T();ae(0),de(1,"seatPassenger"),o(2,"a",39),v("click",function(){let a=S(e),d=a.$implicit,b=a.$index,$=le(0),j=m().$implicit,oe=m(3);return h(oe.selectSeat(j[0],d,j[b+1],$))}),f(3,"i",16)(4,"i",25),r(5),n()}if(t&2){let e=i.$implicit,s=i.$index,a=m().$implicit,d=m(3),b=re(me(1,4,se(7,Pe,a[0],e,d.passengers(),d.carNumber())));l(2),F("selected",b),_("ngClass",d.seatStatus[a[s+1]].class),l(3),g(" ",b==null?null:b.index," ")}}function Ue(t,i){if(t&1&&(o(0,"div",35)(1,"div",37),r(2),n(),y(3,We,6,12,"a",38,w),n()),t&2){let e=i.$implicit,s=m();l(2),u(e[0]),l(),E(s.columnName.slice(0,2))}}function Ye(t,i){if(t&1&&(o(0,"div",34),r(1),n()),t&2){let e=i.$implicit;l(),g(" ",e," ")}}function ze(t,i){if(t&1){let e=T();ae(0),de(1,"seatPassenger"),o(2,"a",39),v("click",function(){let a=S(e),d=a.$implicit,b=a.$index,$=le(0),j=m().$implicit,oe=m(3);return h(oe.selectSeat(j[0],d,j[b+3],$))}),f(3,"i",16)(4,"i",25),r(5),n()}if(t&2){let e=i.$implicit,s=i.$index,a=m().$implicit,d=m(3),b=re(me(1,4,se(7,Pe,a[0],e,d.passengers(),d.carNumber())));l(2),F("selected",b),_("ngClass",d.seatStatus[a[s+3]].class),l(3),g(" ",b==null?null:b.index," ")}}function He(t,i){if(t&1&&(o(0,"div",35),y(1,ze,6,12,"a",38,w),o(3,"div",37),r(4),n()()),t&2){let e=i.$implicit,s=m();l(),E(s.columnName.slice(2)),l(3),u(e[0])}}function Je(t,i){if(t&1&&(o(0,"div",7)(1,"div",31)(2,"div",32),f(3,"div",33),y(4,Le,2,1,"div",34,w),n(),y(6,Ue,5,1,"div",35,w),n(),o(8,"div",36),r(9," \u8D70\u9053 "),n(),o(10,"div",31)(11,"div",32),y(12,Ye,2,1,"div",34,w),n(),y(14,He,5,1,"div",35,w),n()()),t&2){let e=i;l(4),E(e.columnName.slice(0,2)),l(2),E(e.value),l(6),E(e.columnName.slice(2)),l(2),E(e.value)}}function Ke(t,i){if(t&1&&(o(0,"option",12),r(1),n()),t&2){let e=i.$implicit;_("value",e),l(),g(" ",e," ")}}function Qe(t,i){if(t&1&&(o(0,"div",9)(1,"span",40),r(2,"\u8ECA\u5EC2\u7A2E\u985E:"),n(),o(3,"span",41),r(4),n()(),o(5,"div",9)(6,"span",42),r(7,"\u5168\u8ECA\u5EA7\u4F4D\u6578:"),n(),o(8,"span"),r(9),n()(),o(10,"div",9)(11,"span",42),r(12,"\u672C\u8ECA\u5EC2\u5EA7\u4F4D:"),n(),o(13,"span"),r(14),n()()),t&2){let e=i;l(4),u(e.classType),l(5),u(e.regSeat),l(5),u(e.totalSeats)}}function Xe(t,i){if(t&1&&(o(0,"tr")(1,"td",30),r(2),n(),o(3,"td",30),r(4),n(),o(5,"td",30),r(6),n()()),t&2){let e=i.$implicit;l(2),u(e.index),l(2),u(e.profile),l(2),L("",e.car,"/",e.seat,"")}}function Ze(t,i){if(t&1){let e=T();o(0,"div",0)(1,"p",1),r(2,"\u5EA7\u4F4D\u8868"),n(),o(3,"button",2),v("click",function(){S(e);let a=m();return h(a.ngbActiveModal.close(null))}),n()(),o(4,"div",3)(5,"div",4)(6,"div",5)(7,"span",6),r(8," \u65E5\u671F: "),o(9,"span"),r(10),n()(),o(11,"span",6),r(12),n(),o(13,"span",6),r(14),n(),o(15,"span",6),r(16),n()(),p(17,Je,16,0,"div",7),n(),o(18,"div",8)(19,"div",9)(20,"span",10),r(21,"\u8ECA\u5EC2:"),n(),o(22,"select",11),v("ngModelChange",function(a){S(e);let d=m();return h(d.carNumber.set(a))}),y(23,Ke,2,2,"option",12,w),n()(),p(25,Qe,15,3),o(26,"ul",13)(27,"li",9)(28,"span",14),r(29,"\u4E00\u822C\u5EA7\u4F4D"),n(),o(30,"div",15),f(31,"i",16),n(),o(32,"div",17),r(33," N "),n()(),o(34,"li",9)(35,"span",14),r(36,"\u4FDD\u7559\u5EA7\u4F4D"),n(),o(37,"div",18),f(38,"i",16),n(),f(39,"div",19),n(),o(40,"li",9)(41,"span",14),r(42,"\u656C\u8001\u611B\u5FC3\u5EA7"),n(),o(43,"div",20),f(44,"i",16),n(),o(45,"div",21),r(46," N "),n()(),o(47,"li",9)(48,"span",14),r(49,"\u7121\u969C\u7919\u5EA7\u4F4D"),n(),o(50,"div",22),f(51,"i",16),n(),o(52,"div",23),r(53," N "),n()(),o(54,"li",9)(55,"span",14),r(56,"\u5DF2\u88AB\u5360\u7528\u5EA7"),n(),o(57,"div",24),f(58,"i",25),n(),f(59,"div",19),n()(),o(60,"button",26),v("click",function(){S(e);let a=m();return h(a.reset())}),r(61,"\u5EA7\u4F4D\u91CD\u8A2D"),n(),o(62,"button",27),v("click",function(){S(e);let a=m();return h(a.confirm())}),r(63,"\u5EA7\u4F4D\u78BA\u8A8D"),n(),o(64,"table",28)(65,"thead",29)(66,"tr")(67,"th",30),r(68,"\u7DE8\u865F"),n(),o(69,"th",30),r(70,"\u8EAB\u5206\u5225"),n(),o(71,"th",30),r(72,"\u8ECA\u5EC2/\u5EA7\u4F4D"),n()()(),o(73,"tbody"),y(74,Xe,7,4,"tr",null,Ge),n()()()()}if(t&2){let e,s,a=i,d=m();l(10),g("",a.date," "),l(2),g("\u8ECA\u6B21: ",a.trainNumber,""),l(2),g("\u51FA\u767C\u7AD9: ",a.departStation,""),l(2),g("\u5230\u9054\u7AD9: ",a.arrivalStation,""),l(),c((e=d.seat())?17:-1,e),l(5),_("ngModel",d.carNumber()),l(),E(d.carNumbers()),l(2),c((s=d.seat())?25:-1,s),l(37),_("disabled",!d.allSelected()),l(12),E(d.passengers())}}var Ae={};[{symbol:"",class:"invisible"},{symbol:"V",class:"seat-reserved"},{symbol:"$",class:"seat-taken"},{symbol:"@",class:"seat-available"},{symbol:"@C",class:"seat-priority"},{symbol:"@W",class:"seat-accessibility"}].forEach(t=>{Ae[t.symbol]=t});var ie=class t{seatStatus=Ae;seatData=k(null);passengers=k([]);carNumber=k("");carNumbers=B(()=>this.seatData()?.seats.map(i=>i.carNumber)||[]);seat=B(()=>{let i=this.seatData()?.seats||[],e=this.carNumber();return i.find(a=>a.carNumber===e)});allSelected=B(()=>this.passengers().every(i=>i.seat));ngbActiveModal=x(we);loadingService=x(O);apiService=x(q);messageService=x(D);destroyRef=x(M);ngOnInit(){this.setCarNumber()}ngOnChanges(){this.setCarNumber()}selectSeat(i,e,s,a){if(a){a.seat=null,a.car=null,this.passengers.set([...this.passengers()]);return}s==="$"||s==="V"||(a=this.passengers().find(d=>!d.car),a&&(a.seat=`${i}${e}`,a.car=this.carNumber().toString().padStart(2,"0"),this.passengers.set([...this.passengers()])))}reset(){this.passengers.update(i=>i.map(e=>pe(ce({},e),{seat:null,car:null})))}confirm(){if(this.loadingService.loading)return;this.loadingService.start();let i={pnrId:"",trainNumber:this.seatData()?.trainNumber,newSeats:this.toSeats(this.passengers())};this.apiService.bookSetSeat(i).pipe(A(this.destroyRef)).subscribe({next:e=>{this.loadingService.stop(),this.ngbActiveModal.close(e)},error:e=>{this.loadingService.stop(),this.messageService.handleError(e)},complete:()=>{this.loadingService.stop()}})}toSeats(i){return i.map(e=>({passengerIndex:e.index,carNumber:parseInt(e.car,10),row:parseInt(e.seat.slice(0,1),10),col:e.seat.slice(1)}))}setCarNumber(){let i=!1,e=this.passengers()[0];e?.car&&(this.carNumber.set(parseInt(e.car,10).toString()),i=!0),i||this.carNumber.set(this.carNumbers()[0])}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-seat-modal"]],features:[z],decls:1,vars:1,consts:[[1,"modal-header","bg-warning-subtle","align-items-center","justify-content-between"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","d-flex","align-items-start"],[1,"flex-grow-1"],[1,"fs-6"],[1,"ms-3"],[1,"d-flex","justify-content-start","ms-5"],[1,"mx-4","fs-6","w-30"],[1,"d-flex","text-nowrap","align-items-center","m-2","justify-content-between"],[1,"me-2"],[1,"form-select","form-select-sm","fs-7","ml-2",3,"ngModelChange","ngModel"],[3,"value"],[1,"list-unstyled"],[1,"legend-box"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","ms-auto"],[1,"fas","fa-chair"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-available","selected"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-reserved","ms-auto"],[1,"m-1","w-30-px"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-priority","ms-auto"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-priority","selected"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-accessibility","ms-auto"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-accessibility","selected"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-taken","ms-auto"],[1,"fas","fa-ban"],[1,"btn","btn-secondary","btn-sm","me-1",3,"click"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],[1,"table","mt-3","table-bordered","text-center","align-middle"],[1,"table-light"],[1,"text-nowrap"],[1,"mt-3"],[1,"d-flex","gap-3","mb-1"],[1,"text-center","fw-bold","w-30-px"],[1,"text-center","fw-bold","bg-warning-subtle","w-30-px"],[1,"d-flex","align-items-center","gap-3","mb-1"],[1,"w-5","container","my-3","mx-3","d-flex","align-items-center","justify-content-center","flex-column","bg-warning-subtle"],[1,"text-center","bg-warning-subtle","w-30-px"],["href","javascript:;",1,"d-flex","align-items-center","justify-content-center","border","w-30-px","seat","text-decoration-none",3,"ngClass","selected"],["href","javascript:;",1,"d-flex","align-items-center","justify-content-center","border","w-30-px","seat","text-decoration-none",3,"click","ngClass"],[1,"me-1","text-end"],[1,"text-start"],[1,"me-1"]],template:function(e,s){if(e&1&&p(0,Ze,76,8),e&2){let a;c((a=s.seatData())?0:-1,a)}},dependencies:[N,J,P,X,Z,Ee,V,Q,ne],styles:[".seat[_ngcontent-%COMP%]{height:30px;border-radius:4px}.seat[_ngcontent-%COMP%]   .fa-ban[_ngcontent-%COMP%], .seat.selected[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]{display:none}.seat-reserved[_ngcontent-%COMP%]{color:#0dcaf0}.seat-priority[_ngcontent-%COMP%]{color:#ffc107}.seat-priority.selected[_ngcontent-%COMP%]{background-color:#ffc107;color:#000}.seat-accessibility[_ngcontent-%COMP%]{color:#0d6efd}.seat-accessibility.selected[_ngcontent-%COMP%]{background-color:#0d6efd;color:#000}.seat-available[_ngcontent-%COMP%]{color:#000}.seat-available.selected[_ngcontent-%COMP%]{background-color:#d63384}.seat-taken[_ngcontent-%COMP%]{color:#000}.seat-taken[_ngcontent-%COMP%]   .fa-ban[_ngcontent-%COMP%]{display:inline}.seat-taken[_ngcontent-%COMP%]   .fa-chair[_ngcontent-%COMP%]{display:none}"]})};var $e={code:null,message:null,data:{date:"12/08",trainNumber:"0129",departStation:"TPE",arrivalStation:"TAC",seats:[{carNumber:"5",classType:"\u6A19\u6E96\u8ECA\u5EC2",regSeat:"574",totalSeats:"63",columnName:["E","D","C","B","A"],value:[["1","","","","",""],["2","@","@","$","$","$"],["3","@","@","@","@","@"],["4","@","@","@","@","@"],["5","@","@","@","@","@"],["6","@","@","@","@","@"],["7","@","@","@","@","@"],["8","@","@","@","@","@"],["9","@","@","@","@","@"],["10","@","@","@","@","@"],["11","@","@","@","@","@"],["12","V","V","V","V","V"],["13","@C","@C","@C","@C","@C"],["14","@W","","","","@W"]]},{carNumber:"2",classType:"\u6A19\u6E96\u8ECA\u5EC2",regSeat:"574",totalSeats:"55",columnName:["E","D","C","B","A"],value:[["1","@","@","","",""],["2","@","@","$","$","$"],["3","@","@","@","@","@"],["4","@","@","@","@","@"],["5","@","@","@","@","@"],["13","@C","@C","@C","@C","@C"],["14","@W","","","","@W"]]},{carNumber:"1",classType:"\u5546\u52D9\u8ECA\u5EC2",regSeat:"574",totalSeats:"55",columnName:["E","D","B","A"],value:[["1","@","@","",""],["2","@","@","$","$"],["3","@","@","@","@"],["4","@","@","@","@"],["5","@","@","@","@"],["13","@C","@C","@C","@C"],["14","@W","","","@W"]]}]}};function et(t,i){t&1&&f(0,"th",2)}function tt(t,i){t&1&&(o(0,"th",2),r(1,"\u5EA7\u4F4D\u9078\u64C7"),n())}function nt(t,i){t&1&&(o(0,"td"),f(1,"input",3),n())}function it(t,i){t&1&&(o(0,"td"),r(1,"\u53BB"),n())}function ot(t,i){t&1&&(o(0,"td"),r(1,"\u53BB\u7A0B\u5217\u8ECA"),n())}function at(t,i){if(t&1){let e=T();o(0,"td")(1,"button",4),v("click",function(){S(e);let a=m(2);return h(a.selectSeat(!0))}),r(2,"\u5EA7\u4F4D\u8868"),n()()}}function rt(t,i){if(t&1&&(o(0,"tr"),p(1,nt,2,0,"td")(2,it,2,0,"td")(3,ot,2,0,"td"),o(4,"td"),r(5),n(),o(6,"td"),r(7),n(),o(8,"td"),r(9),n(),o(10,"td"),r(11),n(),o(12,"td"),r(13),n(),o(14,"td"),r(15),n(),o(16,"td"),r(17),n(),o(18,"td"),r(19),n(),o(20,"td"),r(21),n(),p(22,at,3,0,"td"),n()),t&2){let e=i,s=m();l(),c(s.hasCheckbox()?1:-1),l(),c(s.isShort()?2:-1),l(),c(s.isShort()?-1:3),l(2),u(e.discount),l(2),u(e.trainNumber),l(2),u(e.departStation),l(2),u(e.arrivalStation),l(2),u(e.departDate),l(2),u(e.departTime),l(2),u(e.arrivalTime),l(2),u(e.elapseTime),l(2),u(e.classType),l(),c(s.seatSelectable()?22:-1)}}function lt(t,i){t&1&&(o(0,"td"),f(1,"input",3),n())}function st(t,i){t&1&&(o(0,"td"),r(1,"\u56DE"),n())}function dt(t,i){t&1&&(o(0,"td"),r(1,"\u56DE\u7A0B\u5217\u8ECA"),n())}function mt(t,i){if(t&1){let e=T();o(0,"td")(1,"button",4),v("click",function(){S(e);let a=m(3);return h(a.selectSeat(!1))}),r(2,"\u5EA7\u4F4D\u8868"),n()()}}function ct(t,i){if(t&1&&(o(0,"tr"),p(1,lt,2,0,"td")(2,st,2,0,"td")(3,dt,2,0,"td"),o(4,"td"),r(5),n(),o(6,"td"),r(7),n(),o(8,"td"),r(9),n(),o(10,"td"),r(11),n(),o(12,"td"),r(13),n(),o(14,"td"),r(15),n(),o(16,"td"),r(17),n(),o(18,"td"),r(19),n(),o(20,"td"),r(21),n(),p(22,mt,3,0,"td"),n()),t&2){let e=i,s=m(2);l(),c(s.hasCheckbox()?1:-1),l(),c(s.isShort()?2:-1),l(),c(s.isShort()?-1:3),l(2),u(e.discount),l(2),u(e.trainNumber),l(2),u(e.departStation),l(2),u(e.arrivalStation),l(2),u(e.departDate),l(2),u(e.departTime),l(2),u(e.arrivalTime),l(2),u(e.elapseTime),l(2),u(e.classType),l(),c(s.seatSelectable()?22:-1)}}function pt(t,i){if(t&1&&p(0,ct,23,13,"tr"),t&2){let e,s=m();c((e=s.inbound())?0:-1,e)}}var Be=class t{outbound=C();inbound=C();seatSelectable=C(!0);roundTrip=C(!1);passengers=C();isShort=C(!0);hasCheckbox=C(!0);ngbModal=x(Te);loadingService=x(O);apiService=x(q);messageService=x(D);destroyRef=x(M);data;selectSeat(i){if(this.loadingService.loading)return;this.loadingService.start();let e=i?this.outbound():this.inbound(),s=this.getPassenger(i),a={pnrId:"",trainNumber:e?.trainNumber,classType:e?.classType==="\u6A19\u6E96\u8ECA\u5EC2"?"Y":"N",originalSeats:this.toSeats(s)};this.apiService.bookSeatMap(a).pipe(A(this.destroyRef)).subscribe({next:d=>{this.loadingService.stop(),this.data=d.data,this.openSeatModal(s)},error:d=>{this.loadingService.stop(),this.messageService.handleError(d)},complete:()=>{this.loadingService.stop()}})}openSeatModal(i){let e=this.ngbModal.open(ie,{size:"lg",centered:!0,scrollable:!0,backdrop:"static"});e.componentInstance.seatData.set(this.data),e.componentInstance.passengers.set(i)}getPassenger(i){return(this.passengers()||[]).map(e=>{let s=i?e.outbound:e.inbound;return{index:e.index,profile:e.profile,car:s.car,seat:s.seat}})}toSeats(i){return i.map(e=>({passengerIndex:e.index,carNumber:parseInt(e.car,10),row:parseInt(e.seat.slice(0,1),10),col:e.seat.slice(1)}))}request(i){return console.log(i),U($e).pipe(Y(100))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-bound"]],inputs:{outbound:[1,"outbound"],inbound:[1,"inbound"],seatSelectable:[1,"seatSelectable"],roundTrip:[1,"roundTrip"],passengers:[1,"passengers"],isShort:[1,"isShort"],hasCheckbox:[1,"hasCheckbox"]},decls:27,vars:4,consts:[[1,"table","table-sm","table-striped","table-hover","table-bordered","table-sticky-header","text-center","align-middle","m-0"],[1,"table-warning","backdrop-blur"],[1,"text-nowrap"],["type","checkbox",1,"form-check-input","me-1","flex-grow-1"],[1,"btn","btn-primary",3,"click"]],template:function(e,s){if(e&1&&(o(0,"table",0)(1,"thead",1)(2,"tr"),p(3,et,1,0,"th",2),f(4,"th",2),o(5,"th",2),r(6,"\u512A\u60E0*"),n(),o(7,"th",2),r(8,"\u8ECA\u6B21"),n(),o(9,"th",2),r(10,"\u51FA\u767C\u7AD9"),n(),o(11,"th",2),r(12,"\u5230\u9054\u7AD9"),n(),o(13,"th",2),r(14,"\u51FA\u767C\u65E5\u671F"),n(),o(15,"th",2),r(16,"\u51FA\u767C\u6642\u9593"),n(),o(17,"th",2),r(18,"\u5230\u9054\u6642\u9593"),n(),o(19,"th",2),r(20,"\u884C\u8ECA\u6642\u9593"),n(),o(21,"th",2),r(22,"\u5EC2\u7B49"),n(),p(23,tt,2,0,"th",2),n()(),o(24,"tbody"),p(25,rt,23,13,"tr")(26,pt,1,1),n()()),e&2){let a;l(3),c(s.hasCheckbox()?3:-1),l(20),c(s.seatSelectable()?23:-1),l(2),c((a=s.outbound())?25:-1,a),l(),c(s.roundTrip()?26:-1)}},dependencies:[P,N,ee],encapsulation:2})};var ut=(t,i)=>i.index;function _t(t,i){t&1&&f(0,"th",3)}function ft(t,i){t&1&&(o(0,"th",3),r(1,"\u8A3B\u8A18"),n())}function xt(t,i){t&1&&(o(0,"td"),f(1,"input",23),n())}function Ct(t,i){if(t&1&&(o(0,"td")(1,"select",24)(2,"option"),r(3),n()()()),t&2){let e=m().$implicit;l(3),u(e.profile)}}function bt(t,i){if(t&1&&(o(0,"td"),r(1),n()),t&2){let e=m().$implicit;l(),u(e.profile)}}function gt(t,i){if(t&1&&r(0),t&2){let e=m().$implicit;g(" ",e.personalId," ")}}function vt(t,i){t&1&&(o(0,"span",12),r(1,"*"),n())}function St(t,i){if(t&1){let e=T();o(0,"input",25),v("change",function(){S(e);let a=m().$index,d=m();return h(d.onPersonalIdChange(a))}),n(),p(1,vt,2,0,"span",12),f(2,"input",26)}if(t&2){let e=m(),s=e.$implicit,a=e.$index;F("invisible",a===0),_("id","personalIdCheck-"+s.index),l(),c(s.personalIdRequired?1:-1),l(),_("id","personalId-"+s.index)}}function ht(t,i){if(t&1&&r(0),t&2){let e=m().$implicit;g(" ",e.expiryDate," ")}}function yt(t,i){t&1&&(o(0,"span",12),r(1,"*"),n())}function Et(t,i){if(t&1&&(p(0,yt,2,0,"span",12),f(1,"input",27)),t&2){let e=m().$implicit;c(e!=null&&e.expiryDateRequired?0:-1),l(),_("id","expiryDate-"+e.index)}}function It(t,i){t&1&&(o(0,"span",12),r(1,"*"),n())}function wt(t,i){if(t&1&&(o(0,"label",19),r(1,"\u53BB:"),n()),t&2){let e=m().$implicit;_("for","outboundCoupon-"+e.index)}}function Tt(t,i){if(t&1&&r(0),t&2){let e=m().$implicit;g(" ",e.outbound==null?null:e.outbound.coupon," ")}}function Dt(t,i){t&1&&(o(0,"span",12),r(1,"*"),n())}function Mt(t,i){if(t&1&&(p(0,Dt,2,0,"span",12),f(1,"input",28)),t&2){let e=m().$implicit;c(e.outboundCouponRequired?0:-1),l(),_("id","outboundCoupon-"+e.index)}}function kt(t,i){if(t&1&&r(0),t&2){let e=m(2).$implicit;g(" ",e.inbound==null?null:e.inbound.coupon," ")}}function Ft(t,i){t&1&&(o(0,"span",12),r(1,"*"),n())}function Nt(t,i){if(t&1&&(p(0,Ft,2,0,"span",12),f(1,"input",29)),t&2){let e=m(2).$implicit;c(e.inboundCouponRequired?0:-1),l(),_("id","inboundCoupon-"+e.index)}}function Pt(t,i){if(t&1&&(o(0,"div",20)(1,"label",19),r(2,"\u56DE:"),n(),p(3,kt,1,1)(4,Nt,2,2),n()),t&2){let e=m().$implicit,s=m();l(),_("for","inboundCoupon-"+e.index),l(2),c(s.readonly()?3:4)}}function At(t,i){if(t&1&&(o(0,"span",22)(1,"span"),r(2,"NT$"),n(),r(3),n()),t&2){let e=m().$implicit;l(3),u(e==null||e.inbound==null?null:e.inbound.fare)}}function $t(t,i){if(t&1&&(o(0,"span",22),r(1),n()),t&2){let e=m().$implicit;l(),L("",e.inbound==null?null:e.inbound.car,"/",e.inbound==null?null:e.inbound.seat,"")}}function Bt(t,i){t&1&&(o(0,"td"),r(1,"132"),n())}function Rt(t,i){if(t&1){let e=T();o(0,"tr",7),p(1,xt,2,0,"td"),o(2,"td"),r(3),n(),p(4,Ct,4,1,"td")(5,bt,2,1,"td"),o(6,"td")(7,"div",8),p(8,gt,1,1)(9,St,3,5),n()(),o(10,"td",9)(11,"div",10),p(12,ht,1,1)(13,Et,2,2),n()(),o(14,"td",11),p(15,It,2,0,"span",12),f(16,"input",13),o(17,"label",14),r(18,"\u6709"),n(),f(19,"input",13),o(20,"label",15),r(21,"\u7121"),n()(),o(22,"td",11)(23,"div",16)(24,"input",17),v("change",function(){let a=S(e).$index,d=m();return h(d.onNoIdDocumentChange(a))}),n(),o(25,"label",14),r(26,"\u7121\u8B49\u4EF6"),n()()(),o(27,"td")(28,"div",18)(29,"div",16),p(30,wt,2,1,"label",19)(31,Tt,1,1)(32,Mt,2,2),n(),p(33,Pt,5,2,"div",20),n()(),o(34,"td")(35,"div",18)(36,"span",21)(37,"span"),r(38,"NT$"),n(),r(39),n(),p(40,At,4,1,"span",22),n()(),o(41,"td")(42,"div",18)(43,"span",21),r(44),n(),p(45,$t,2,2,"span",22),n()(),p(46,Bt,2,0,"td"),n()}if(t&2){let e=i.$implicit,s=i.$index,a=m();_("formGroupName",s),l(),c(a.showRowCheckbox()?1:-1),l(2),g(" ",e.index," "),l(),c(a.isSelect()?4:-1),l(),c(a.isSelect()?-1:5),l(3),c(a.readonly()?8:9),l(4),c(a.readonly()?12:13),l(3),c(!a.readonly()&&e.needCompanionRequired?15:-1),l(),F("disabled",a.readonly()),_("id","needCompanionYes-"+e.index)("readonly",a.readonly()?"true":null)("value",!0),l(),_("for","needCompanionYes-"+e.index),l(2),F("disabled",a.readonly()),_("id","needCompanionNo-"+e.index)("readonly",a.readonly()?"true":null)("value",!1),l(),_("for","needCompanionNo-"+e.index),l(4),F("disabled",a.readonly()),_("id","noIdDocument-"+e.index)("readonly",a.readonly()?"true":null),l(),_("for","noIdDocument-"+e.index),l(5),c(a.roundTrip()?30:-1),l(),c(a.readonly()?31:32),l(2),c(a.roundTrip()?33:-1),l(6),u(e==null||e.outbound==null?null:e.outbound.fare),l(),c(a.roundTrip()?40:-1),l(4),L("",e.outbound==null?null:e.outbound.car,"/",e.outbound==null?null:e.outbound.seat,""),l(),c(a.roundTrip()?45:-1),l(),c(a.showRowMarker()?46:-1)}}var Re=class t{passengers=C();roundTrip=C(!1);readonly=C(!1);promotion=C(null);needToCheck=G(!1);isSelect=C(!1);showRowCheckbox=C(!1);showRowMarker=C(!1);form;formBuilder=x(Ie);destroyRef=x(M);messageService=x(D);constructor(){this.form=this.formBuilder.group({passengers:this.formBuilder.array([])}),this.form.valueChanges.pipe(A(this.destroyRef)).subscribe(()=>{let e=(this.form.get("passengers")?.value||[]).some(s=>(s.profile==="\u611B\u5FC3"||s.profile==="\u656C\u8001")&&!s.noIdDocument);this.needToCheck.set(e)})}ngOnChanges(i){if(i.passengers||"promotion"in i){let e=i.promotion?.currentValue,s=i.passengers.currentValue.map(a=>{a.personalIdRequired=a.profile==="\u611B\u5FC3"||a.profile==="\u656C\u8001",e&&(a.profile==="\u6210\u4EBA"||a.profile==="\u5B69\u7AE5")&&(a.personalIdRequired=e.adultChildId),a.expiryDateRequired=a.profile==="\u611B\u5FC3",a.needCompanionRequired=a.profile==="\u611B\u5FC3";let d=a.profile==="\u7279\u60E0\u5168"||a.profile==="\u7279\u60E0\u534A"||e?.voucherNumberRequired;a.outboundCouponRequired=d,a.inboundCouponRequired=d;let b=a.profile==="\u611B\u5FC3"||a.profile==="\u656C\u8001";return this.formBuilder.group({index:[a.index],profile:[a.profile],personalIdCheck:[{value:!1,disabled:!a.personalIdRequired}],personalId:[{value:a.personalId||"",disabled:!a.personalIdRequired},a.personalIdRequired?[R.required]:[]],expiryDate:[{value:a.expiryDate||"",disabled:!a.expiryDateRequired},a.expiryDateRequired?[R.required]:[]],needCompanion:[{value:a.needCompanion,disabled:!a.needCompanionRequired},a.needCompanionRequired?[R.required]:[]],noIdDocument:[{value:a.noIdDocument||!1,disabled:!b}],outboundCoupon:[a.outbound?.coupon||"",a.outboundCouponRequired?[R.required]:[]],inboundCoupon:[a.inbound?.coupon||"",a.inboundCouponRequired?[R.required]:[]]})});this.form.setControl("passengers",this.formBuilder.array(s))}}onPersonalIdChange(i){let e=this.form.get(`passengers.${i-1}`),s=this.form.get(`passengers.${i}`);s.get("personalIdCheck")?.value?s.get("personalId")?.setValue(e.get("personalId")?.value):s.get("personalId")?.setValue("")}onNoIdDocumentChange(i){let e=this.form.get(`passengers.${i}`);e.get("profile")?.value==="\u611B\u5FC3"&&(e.get("noIdDocument").value?(e.get("needCompanion")?.disable(),e.get("expiryDate")?.disable()):(e.get("needCompanion")?.enable(),e.get("expiryDate")?.enable()))}getValues(){return this.form.value.passengers.map(e=>({index:e.index,profile:e.profile,personalId:e.personalId,expiryDate:e.expiryDate?.replaceAll("-","/"),needCompanion:e.needCompanion,noIdDocument:e.noIdDocument,outbound:{coupon:e.outboundCoupon},inbound:{coupon:e.inboundCoupon}}))}setPassengers(i){let e=this.getValues();for(let a of i)for(let d of e.filter(b=>b.personalId===a.personalId)){let b=this.form.get(`passengers.${d.index-1}`);b.get("expiryDate")?.enabled&&b.patchValue({expiryDate:a.expiryDate.replaceAll("/","-"),needCompanion:a.needCompanion})}let s=[];for(let a of(this.passengers()||[]).filter(d=>d.expiryDateRequired))this.form.get(`passengers.${a.index-1}`).get("expiryDate")?.value||s.push(`\u4E58\u5BA2${a.index}\u8CC7\u6599\u4E0D\u5B58\u5728\u65BC\u7CFB\u7D71\uFF0C\u8ACB\u4F9D\u65C5\u5BA2\u8B49\u4EF6\u8FA6\u7406\u8CC7\u6599\u767B\u9304`);this.form.markAllAsTouched(),this.messageService.setErrors(s)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-passengers"]],inputs:{passengers:[1,"passengers"],roundTrip:[1,"roundTrip"],readonly:[1,"readonly"],promotion:[1,"promotion"],needToCheck:[1,"needToCheck"],isSelect:[1,"isSelect"],showRowCheckbox:[1,"showRowCheckbox"],showRowMarker:[1,"showRowMarker"]},outputs:{needToCheck:"needToCheckChange"},features:[z],decls:27,vars:3,consts:[[3,"formGroup"],[1,"table","table-sm","table-striped","table-hover","table-bordered","table-sticky-header","text-center","align-middle","m-0"],[1,"table-warning","backdrop-blur"],[1,"text-nowrap"],[1,"text-nowrap","id-col"],[1,"text-nowrap","expiry-col"],["formArrayName","passengers"],[3,"formGroupName"],[1,"id-col","d-flex","align-items-center"],[1,"expiry-col"],[1,"d-flex","align-items-center","justify-content-center"],[1,"align-items-center","text-nowrap"],[1,"m-1","text-danger"],["type","radio","formControlName","needCompanion",1,"form-check-input","me-1",3,"id","readonly","value"],[1,"form-check-label","me-2",3,"for"],[1,"form-check-label",3,"for"],[1,"d-flex","align-items-center"],["type","checkbox","formControlName","noIdDocument",1,"form-check-input","me-1","fs-6",3,"change","id","readonly"],[1,"d-flex","flex-column","justify-content-start"],[1,"me-1",3,"for"],[1,"d-flex","align-items-center","mt-1"],[1,"me-1","mb-2"],[1,"me-1","mb-1"],["type","checkbox","id","select-1",1,"form-check-input","me-1","flex-grow-1"],["disabled","",1,"form-select","form-select-sm","fs-7","ml-2"],["type","checkbox","formControlName","personalIdCheck",1,"form-check-input","me-1","fs-6","flex-grow-1",3,"change","id"],["type","text","formControlName","personalId",1,"fs-6","form-control","form-control-sm","flex-grow-1",3,"id"],["type","date","formControlName","expiryDate",1,"fs-6","form-control","form-control-sm","flex-1",3,"id"],["type","text","formControlName","outboundCoupon",1,"fs-6","form-control","form-control-sm","flex-grow-1",3,"id"],["type","text","formControlName","inboundCoupon",1,"fs-6","form-control","form-control-sm","flex-grow-1",3,"id"]],template:function(e,s){e&1&&(o(0,"form",0)(1,"table",1)(2,"thead",2)(3,"tr"),p(4,_t,1,0,"th",3),o(5,"th",3),r(6,"\u7DE8\u865F"),n(),o(7,"th",3),r(8,"\u8EAB\u5206\u5225"),n(),o(9,"th",4),r(10,"\u8EAB\u5206\u8B49\u865F/\u8B77\u7167\u865F\u78BC"),n(),o(11,"th",5),r(12,"\u6548\u671F"),n(),o(13,"th",3),r(14,"\u966A\u4F34\u8CC7\u683C"),n(),o(15,"th",3),r(16,"\u7121\u8B49\u4EF6"),n(),o(17,"th",3),r(18,"\u514C\u63DB\u5238\u865F\u78BC"),n(),o(19,"th",3),r(20,"\u7968\u50F9"),n(),o(21,"th",3),r(22,"\u8ECA\u5EC2/\u5EA7\u4F4D"),n(),p(23,ft,2,0,"th",3),n()(),o(24,"tbody",6),y(25,Rt,47,34,"tr",7,ut),n()()()),e&2&&(_("formGroup",s.form),l(4),c(s.showRowCheckbox()?4:-1),l(19),c(s.showRowMarker()?23:-1),l(2),E(s.passengers()))},dependencies:[P,be,X,Z,K,xe,ge,V,Ce,N,ee,ve,ye,Se,he],styles:[".id-col[_ngcontent-%COMP%], .expiry-col[_ngcontent-%COMP%]{max-width:160px}.expiry-col[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{min-width:0}"]})};export{Fe as a,Be as b,Re as c,De as d};
