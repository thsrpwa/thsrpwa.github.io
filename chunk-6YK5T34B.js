import{a as Te,b as Re,c as we,d as At}from"./chunk-47KGWLGQ.js";import{A as oe,B as ae,a as Dt,b as Ve,c as J,d as be,e as ge,h as _e,i as kt,j as It,k as ye,m as Mt,n as xe,o as Le,p as qe,q as Oe,r as $t,s as Ee,t as Q,u as Z,v as z,w as ce,z as re}from"./chunk-5JAWHIKF.js";import{a as wt}from"./chunk-SJF4UMRN.js";import{$ as w,Aa as N,Ab as xt,Ba as r,Bb as H,Ca as i,D as Ke,Da as _,Ea as K,Fa as y,Ga as x,I as ft,Jb as Et,Ka as tt,L as T,Nb as Tt,Oa as nt,Pa as bt,Q as ht,R as k,Ra as s,S as I,Sa as b,Ta as X,V as ie,Va as Me,Wa as Ce,Xa as $e,Y as R,Z as j,a as ve,b as dt,ba as l,c as Ht,d as ct,e as Pe,ea as St,eb as gt,fa as Xe,ga as de,ha as P,hb as _t,ia as vt,m as Ze,ma as V,nb as C,ob as yt,qa as et,ra as c,sa as Ct,ta as F,wa as L,ya as Y,za as A}from"./chunk-H5KATAC4.js";var ot=Ht((it,rt)=>{"use strict";(function(a,t){typeof it=="object"&&typeof rt<"u"?rt.exports=t():typeof define=="function"&&define.amd?define(t):(a=typeof globalThis<"u"?globalThis:a||self).dayjs=t()})(it,function(){"use strict";var a=1e3,t=6e4,e=36e5,n="millisecond",o="second",m="minute",q="hour",W="day",Ae="week",U="month",lt="quarter",te="year",he="date",pt="Invalid Date",qt=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Ot=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Rt={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(h){var d=["th","st","nd","rd"],p=h%100;return"["+h+(d[(p-20)%10]||d[p]||d[0])+"]"}},ze=function(h,d,p){var f=String(h);return!f||f.length>=d?h:""+Array(d+1-f.length).join(p)+h},jt={s:ze,z:function(h){var d=-h.utcOffset(),p=Math.abs(d),f=Math.floor(p/60),u=p%60;return(d<=0?"+":"-")+ze(f,2,"0")+":"+ze(u,2,"0")},m:function h(d,p){if(d.date()<p.date())return-h(p,d);var f=12*(p.year()-d.year())+(p.month()-d.month()),u=d.clone().add(f,U),S=p-u<0,v=d.clone().add(f+(S?-1:1),U);return+(-(f+(p-u)/(S?u-v:v-u))||0)},a:function(h){return h<0?Math.ceil(h)||0:Math.floor(h)},p:function(h){return{M:U,y:te,w:Ae,d:W,D:he,h:q,m,s:o,ms:n,Q:lt}[h]||String(h||"").toLowerCase().replace(/s$/,"")},u:function(h){return h===void 0}},De="en",pe={};pe[De]=Rt;var mt="$isDayjsObject",Je=function(h){return h instanceof Fe||!(!h||!h[mt])},Ne=function h(d,p,f){var u;if(!d)return De;if(typeof d=="string"){var S=d.toLowerCase();pe[S]&&(u=S),p&&(pe[S]=p,u=S);var v=d.split("-");if(!u&&v.length>1)return h(v[0])}else{var E=d.name;pe[E]=d,u=E}return!f&&u&&(De=u),u||!f&&De},M=function(h,d){if(Je(h))return h.clone();var p=typeof d=="object"?d:{};return p.date=h,p.args=arguments,new Fe(p)},g=jt;g.l=Ne,g.i=Je,g.w=function(h,d){return M(h,{locale:d.$L,utc:d.$u,x:d.$x,$offset:d.$offset})};var Fe=function(){function h(p){this.$L=Ne(p.locale,null,!0),this.parse(p),this.$x=this.$x||p.x||{},this[mt]=!0}var d=h.prototype;return d.parse=function(p){this.$d=function(f){var u=f.date,S=f.utc;if(u===null)return new Date(NaN);if(g.u(u))return new Date;if(u instanceof Date)return new Date(u);if(typeof u=="string"&&!/Z$/i.test(u)){var v=u.match(qt);if(v){var E=v[2]-1||0,D=(v[7]||"0").substring(0,3);return S?new Date(Date.UTC(v[1],E,v[3]||1,v[4]||0,v[5]||0,v[6]||0,D)):new Date(v[1],E,v[3]||1,v[4]||0,v[5]||0,v[6]||0,D)}}return new Date(u)}(p),this.init()},d.init=function(){var p=this.$d;this.$y=p.getFullYear(),this.$M=p.getMonth(),this.$D=p.getDate(),this.$W=p.getDay(),this.$H=p.getHours(),this.$m=p.getMinutes(),this.$s=p.getSeconds(),this.$ms=p.getMilliseconds()},d.$utils=function(){return g},d.isValid=function(){return this.$d.toString()!==pt},d.isSame=function(p,f){var u=M(p);return this.startOf(f)<=u&&u<=this.endOf(f)},d.isAfter=function(p,f){return M(p)<this.startOf(f)},d.isBefore=function(p,f){return this.endOf(f)<M(p)},d.$g=function(p,f,u){return g.u(p)?this[f]:this.set(u,p)},d.unix=function(){return Math.floor(this.valueOf()/1e3)},d.valueOf=function(){return this.$d.getTime()},d.startOf=function(p,f){var u=this,S=!!g.u(f)||f,v=g.p(p),E=function(ue,O){var ne=g.w(u.$u?Date.UTC(u.$y,O,ue):new Date(u.$y,O,ue),u);return S?ne:ne.endOf(W)},D=function(ue,O){return g.w(u.toDate()[ue].apply(u.toDate("s"),(S?[0,0,0,0]:[23,59,59,999]).slice(O)),u)},$=this.$W,B=this.$M,G=this.$D,Se="set"+(this.$u?"UTC":"");switch(v){case te:return S?E(1,0):E(31,11);case U:return S?E(1,B):E(0,B+1);case Ae:var me=this.$locale().weekStart||0,ke=($<me?$+7:$)-me;return E(S?G-ke:G+(6-ke),B);case W:case he:return D(Se+"Hours",0);case q:return D(Se+"Minutes",1);case m:return D(Se+"Seconds",2);case o:return D(Se+"Milliseconds",3);default:return this.clone()}},d.endOf=function(p){return this.startOf(p,!1)},d.$set=function(p,f){var u,S=g.p(p),v="set"+(this.$u?"UTC":""),E=(u={},u[W]=v+"Date",u[he]=v+"Date",u[U]=v+"Month",u[te]=v+"FullYear",u[q]=v+"Hours",u[m]=v+"Minutes",u[o]=v+"Seconds",u[n]=v+"Milliseconds",u)[S],D=S===W?this.$D+(f-this.$W):f;if(S===U||S===te){var $=this.clone().set(he,1);$.$d[E](D),$.init(),this.$d=$.set(he,Math.min(this.$D,$.daysInMonth())).$d}else E&&this.$d[E](D);return this.init(),this},d.set=function(p,f){return this.clone().$set(p,f)},d.get=function(p){return this[g.p(p)]()},d.add=function(p,f){var u,S=this;p=Number(p);var v=g.p(f),E=function(B){var G=M(S);return g.w(G.date(G.date()+Math.round(B*p)),S)};if(v===U)return this.set(U,this.$M+p);if(v===te)return this.set(te,this.$y+p);if(v===W)return E(1);if(v===Ae)return E(7);var D=(u={},u[m]=t,u[q]=e,u[o]=a,u)[v]||1,$=this.$d.getTime()+p*D;return g.w($,this)},d.subtract=function(p,f){return this.add(-1*p,f)},d.format=function(p){var f=this,u=this.$locale();if(!this.isValid())return u.invalidDate||pt;var S=p||"YYYY-MM-DDTHH:mm:ssZ",v=g.z(this),E=this.$H,D=this.$m,$=this.$M,B=u.weekdays,G=u.months,Se=u.meridiem,me=function(O,ne,Ie,Be){return O&&(O[ne]||O(f,S))||Ie[ne].slice(0,Be)},ke=function(O){return g.s(E%12||12,O,"0")},ue=Se||function(O,ne,Ie){var Be=O<12?"AM":"PM";return Ie?Be.toLowerCase():Be};return S.replace(Ot,function(O,ne){return ne||function(Ie){switch(Ie){case"YY":return String(f.$y).slice(-2);case"YYYY":return g.s(f.$y,4,"0");case"M":return $+1;case"MM":return g.s($+1,2,"0");case"MMM":return me(u.monthsShort,$,G,3);case"MMMM":return me(G,$);case"D":return f.$D;case"DD":return g.s(f.$D,2,"0");case"d":return String(f.$W);case"dd":return me(u.weekdaysMin,f.$W,B,2);case"ddd":return me(u.weekdaysShort,f.$W,B,3);case"dddd":return B[f.$W];case"H":return String(E);case"HH":return g.s(E,2,"0");case"h":return ke(1);case"hh":return ke(2);case"a":return ue(E,D,!0);case"A":return ue(E,D,!1);case"m":return String(D);case"mm":return g.s(D,2,"0");case"s":return String(f.$s);case"ss":return g.s(f.$s,2,"0");case"SSS":return g.s(f.$ms,3,"0");case"Z":return v}return null}(O)||v.replace(":","")})},d.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},d.diff=function(p,f,u){var S,v=this,E=g.p(f),D=M(p),$=(D.utcOffset()-this.utcOffset())*t,B=this-D,G=function(){return g.m(v,D)};switch(E){case te:S=G()/12;break;case U:S=G();break;case lt:S=G()/3;break;case Ae:S=(B-$)/6048e5;break;case W:S=(B-$)/864e5;break;case q:S=B/e;break;case m:S=B/t;break;case o:S=B/a;break;default:S=B}return u?S:g.a(S)},d.daysInMonth=function(){return this.endOf(U).$D},d.$locale=function(){return pe[this.$L]},d.locale=function(p,f){if(!p)return this.$L;var u=this.clone(),S=Ne(p,f,!0);return S&&(u.$L=S),u},d.clone=function(){return g.w(this.$d,this)},d.toDate=function(){return new Date(this.valueOf())},d.toJSON=function(){return this.isValid()?this.toISOString():null},d.toISOString=function(){return this.$d.toISOString()},d.toString=function(){return this.$d.toUTCString()},h}(),ut=Fe.prototype;return M.prototype=ut,[["$ms",n],["$s",o],["$m",m],["$H",q],["$W",W],["$M",U],["$y",te],["$D",he]].forEach(function(h){ut[h[1]]=function(d){return this.$g(d,h[0],h[1])}}),M.extend=function(h,d){return h.$i||(h(d,Fe,M),h.$i=!0),M},M.locale=Ne,M.isDayjs=Je,M.unix=function(h){return M(1e3*h)},M.en=pe[De],M.Ls=pe,M.p={},M})});var Nt=a=>a?.canDeactiveGuard();var ee=ct(ot());var at=(e=>(e[e.general=1]="general",e[e.group=2]="group",e))(at||{});var Yt=(a,t)=>t.code,Qt=(a,t)=>t.name,Wt=(a,t)=>t.id,Ut=(a,t)=>t.promotionCode;function zt(a,t){if(a&1&&(r(0,"option",6),s(1),i()),a&2){let e=t.$implicit;c("value",e),l(),b(e)}}function Jt(a,t){if(a&1&&(r(0,"option",6),s(1),i()),a&2){let e=t.$implicit;c("value",e),l(),b(e)}}function Zt(a,t){if(a&1&&(r(0,"div",16)(1,"label",52),s(2),i(),_(3,"input",53),i()),a&2){let e=t.$implicit,n=t.$index;l(),c("for","profile-"+e.code),l(),b(e.content),l(),c("id","profile-"+e.code)("formControlName",n)}}function Kt(a,t){if(a&1&&(r(0,"div",7),_(1,"input",54),r(2,"label",55),s(3),i()()),a&2){let e=t.$implicit;l(),tt("id","classType-",e.value,""),c("formControlName","classType")("value",e.value),et("disabled",e.disabled?"true":null),l(),tt("for","classType-",e.value,""),l(),b(e.name)}}function Xt(a,t){if(a&1&&(r(0,"option",6),s(1),i()),a&2){let e=t.$implicit;c("value",e),l(),b(e)}}function en(a,t){if(a&1&&(r(0,"option",6),s(1),i()),a&2){let e=t.$implicit;c("value",e),l(),b(e)}}function tn(a,t){if(a&1&&(r(0,"option",6),s(1),i()),a&2){let e=t.$implicit;c("value",e),l(),b(e)}}function nn(a,t){if(a&1&&(r(0,"option",6),s(1),i()),a&2){let e=t.$implicit;c("value",e),l(),b(e)}}function rn(a,t){if(a&1&&(r(0,"div",19),s(1,"\u56DE\u7A0B"),i(),r(2,"div",20)(3,"label",56),s(4,"\u51FA\u767C\u65E5\u671F"),i(),r(5,"div",22),_(6,"input",57),i(),r(7,"div",24)(8,"label",58),s(9,"\u51FA\u767C\u6642\u9593"),i(),r(10,"select",59),A(11,tn,2,2,"option",6,Y),i(),r(13,"label",60),s(14,"\u6642"),i(),r(15,"select",61),A(16,nn,2,2,"option",6,Y),i(),r(18,"label",62),s(19,"\u5206"),i()(),r(20,"select",63)(21,"option",31),s(22,"\u4EE5\u51FA\u767C\u6642\u9593\u67E5\u8A62"),i(),r(23,"option",32),s(24,"\u4EE5\u5230\u9054\u6642\u9593\u67E5\u8A62"),i()(),r(25,"label",64),s(26,"\u6307\u5B9A\u8ECA\u6B21"),i(),_(27,"input",65),i()),a&2){let e=x();l(11),N(e.hours()),l(5),N(e.minutes())}}function on(a,t){if(a&1&&(r(0,"option",6),s(1),i()),a&2){let e=t.$implicit;c("value",e.id),l(),b(e.name)}}function an(a,t){if(a&1&&(r(0,"option",6),s(1),i()),a&2){let e=t.$implicit;c("value",e.promotionCode),l(),b(e.projectName)}}var Ft=[{content:"\u6210\u4EBA",code:"F",isEnable:!0},{content:"\u5B69\u7AE5",code:"H",isEnable:!0},{content:"\u611B\u5FC3",code:"W",isEnable:!0},{content:"\u656C\u8001",code:"E",isEnable:!0},{content:"\u5B78\u751F",code:"P",isEnable:!0},{content:"\u7279\u60E0\u5168",code:"S",isEnable:!0},{content:"\u7279\u60E0\u534A",code:"M",isEnable:!0}],Bt=[{name:"\u6A19\u6E96\u8ECA\u5EC2",value:1,disabled:!1},{name:"\u5546\u52D9\u8ECA\u5EC2",value:2,disabled:!1},{name:"\u8F2A\u6905\u5EA7\u4F4D",value:3,disabled:!1}],je=class a{confirm=R();promotions=R();bookingType=at;form;profiles=w(Ft);departStationList=w([]);arrivalStationList=w([]);totalPeople;classType;classTypes=w(Bt);promotionTypeList=w([]);promotionDataList=w([]);hours=w(Array.from({length:24},(t,e)=>e.toString().padStart(2,"0")));minutes=w(Array.from({length:60},(t,e)=>e.toString().padStart(2,"0")));promotionType;promotionList;roundTrip;personalId=w("");coperateId=w("");selectedPromotion;filteredPromotionDataList=C(()=>{let t=this.promotionType();return this.promotionDataList().filter(e=>e.promotionTypeId===t)});disableGernalBook=C(()=>this.totalPeople()>10);disableGroupBook=C(()=>this.roundTrip()||this.classType()===3||this.selectedPromotion()?.cancel_group_reservation);formBuilder=T(Ee);apiService=T(oe);loadingService=T(re);messageService=T(ae);destroyRef=T(ie);constructor(){this.form=this.formBuilder.group({profiles:this.formBuilder.array(Ft.map(()=>this.formBuilder.control(null))),departStation:[null,J.required],arrivalStation:[null,J.required],classType:[Bt[0].value,J.required],roundTrip:[!1],departDate:[(0,ee.default)().format("YYYY-MM-DD"),J.required],departHour:[(0,ee.default)().format("HH"),J.required],departMinute:[(0,ee.default)().format("mm"),J.required],departSearchMethod:[1],departApointTrainNumber:[null],returnDate:[(0,ee.default)().add(1,"day").format("YYYY-MM-DD"),J.required],returnHour:[(0,ee.default)().format("HH"),J.required],returnMinute:[(0,ee.default)().format("mm"),J.required],returnSearchMethod:[1],returnApointTrainNumber:[null],promotionType:[0],promotionCodeList:[""],promotionCode:[null]}),this.promotionType=ce(this.form.get("promotionType").valueChanges.pipe(Ze(e=>parseInt(e,10)),Ke(()=>this.form.patchValue({promotionCodeList:""}))),{initialValue:0}),this.promotionList=ce(this.form.get("promotionCodeList").valueChanges.pipe(Ke(e=>this.form.patchValue({promotionCode:e}))),{initialValue:""}),this.totalPeople=ce(this.form.valueChanges.pipe(Ze(()=>this.form.get("profiles").controls.reduce((e,n)=>e+(n.value||0),0))),{initialValue:0}),this.roundTrip=ce(this.form.get("roundTrip").valueChanges),this.classType=ce(this.form.get("classType").valueChanges);let t=ce(this.form.get("promotionCode").valueChanges);this.selectedPromotion=C(()=>this.promotionDataList().find(n=>n.promotionCode===t())??null),this.loadingService.start(),this.apiService.startReservation(!1).pipe(z(this.destroyRef)).subscribe({next:e=>{this.loadingService.stop(),this.departStationList.set(e.data.departStationList),this.arrivalStationList.set(e.data.arrivalStationList),this.promotionTypeList.set(e.data.promotionOfProjectData.promotionTypeList),this.promotionDataList.set(e.data.promotionOfProjectData.promotionDataList),this.profiles.set(e.data.profile),this.form.setControl("profiles",this.formBuilder.array(e.data.profile.map(()=>this.formBuilder.control(null)))),this.classTypes.update(n=>(n.forEach(o=>{let m=e.data.classType.find(q=>q===o.name);o.disabled=!m}),n)),this.form.patchValue({departStation:this.departStationList()[0],arrivalStation:this.arrivalStationList()[1]}),this.promotions.emit(e.data.promotionOfProjectData.promotionDataList)},error:e=>{this.loadingService.stop(),this.messageService.handleError(e)},complete:()=>{this.loadingService.stop()}})}swapStation(){let t=this.form.get("departureStation")?.value,e=this.form.get("arrivalStation")?.value;this.form.get("departureStation")?.setValue(e),this.form.get("arrivalStation")?.setValue(t)}onSubmit(t){if(this.loadingService.loading)return;this.loadingService.start();let e=dt(ve({},this.form.value),{bookingType:t});e.tripType=e.roundTrip?2:1,e.profile=this.getProfiles(),e.membership={personalId:e.personalId,coperateId:e.coperateId},e.departDate=e.departDate.replaceAll("-","/"),e.returnDate=e.returnDate.replaceAll("-","/"),e.departTime=`${e.departHour}:${e.departMinute}`,e.returnTime=`${e.returnHour}:${e.returnMinute}`,e.allTrain=0,e.requeryTrain=!1,e.personalId=this.personalId(),e.coperateId=this.coperateId(),["profiles","promotionType","promotionCodeList","roundTrip","departHour","departMinute","returnHour","returnMinute"].forEach(n=>{delete e[n]}),this.apiService.queryTrain(e).pipe(z(this.destroyRef)).subscribe({next:n=>{this.loadingService.stop(),this.confirm.emit({query:e,data:n.data})},error:n=>{this.loadingService.stop(),this.messageService.handleError(n)},complete:()=>{this.loadingService.stop()}})}validate(){let t=[];this.form.get("departStation")?.value===this.form.get("arrivalStation")?.value&&t.push("\u51FA\u767C\u7AD9\u8207\u5230\u9054\u7AD9\u9700\u4E0D\u540C");let e=this.getProfiles();e.length>4&&t.push("\u6700\u591A\u53EA\u80FD\u540C\u6642\u8CFC\u8CB7\u56DB\u7A2E\u8EAB\u5206\u5225"),e.length<1&&t.push("\u81F3\u5C11\u9700\u8F38\u5165\u4E00\u500B\u8EAB\u5206\u5225\u7684\u5F35\u6578");let n=Math.max(...e.map(q=>q.quantity));this.form.get("roundTrip")?.value&&n>5&&t.push("\u4E00\u822C\u8A02\u4F4D\u53BB\u56DE\u7A0B\u6700\u591A\u50C5\u80FD\u9078\u64C75\u5F35\u7968");let o=(0,ee.default)(`${this.form.get("departDate")?.value} ${this.form.get("departHour")?.value}:${this.form.get("departMinute")?.value}`),m=(0,ee.default)(`${this.form.get("returnDate")?.value} ${this.form.get("returnHour")?.value}:${this.form.get("returnMinute")?.value}`);return(m.isBefore(o)||m.isSame(o))&&t.push("\u8A02\u8CFC\u53BB\u56DE\u7A0B\uFF0C\u56DE\u7A0B\u6642\u9593\u65E9\u65BC\u53BB\u7A0B\u6642\u9593"),e.some(q=>q.code==="P")&&this.form.get("classType").value===2&&t.push("\u5B78\u751F\u7968\u4E0D\u9069\u7528\u5546\u52D9\u8ECA\u5EC2\uFF0C\u8ACB\u91CD\u65B0\u9078\u64C7"),t}getProfiles(){let t=this.profiles();return this.form.get("profiles").value.map((e,n)=>({code:t[n].code,quantity:e})).filter(e=>e.quantity)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=P({type:a,selectors:[["app-step1"]],outputs:{confirm:"confirm",promotions:"promotions"},decls:95,vars:11,consts:[[1,"py-2",3,"formGroup"],[1,"border","rounded","p-3","shadow-sm","bg-white","fs-6","m-0","w-100"],[1,"row","mb-2","align-items-center","w-100"],["for","departStation",1,"col-auto"],[1,"col"],["id","departStation","formControlName","departStation",1,"form-select","form-select-sm","fs-6"],[3,"value"],[1,"col-auto"],["href","javascript:;",3,"click"],[1,"fa-solid","fa-right-left"],["for","arrivalStation",1,"col-auto"],["id","arrivalStation","formControlName","arrivalStation",1,"form-select","form-select-sm","fs-6"],["type","checkbox","id","roundTrip","formControlName","roundTrip",1,"form-check-input","me-1","fs-6"],["for","roundTrip",1,"form-check-label"],[1,"col-auto","text-end","text-warning"],["formArrayName","profiles",1,"row","mb-2","align-items-center","w-100"],[1,"col","d-flex","align-items-center","p-0","me-3"],[1,"row","mb-2","w-100"],[3,"personalIdChange","coperateIdChange","coperateIdDisabled","personalIdDisabled","rowStyle"],[1,"w-100","border","rounded-top","bg-warning-subtle","mt-2","p-1"],[1,"border","p-3","shadow-sm","fs-6","m-0","w-100","d-flex","align-items-center"],["for","departDate",1,"text-nowrap","m-1"],[1,"w-25","d-flex","align-items-center","justify-content-start"],["type","date","id","departDate","formControlName","departDate",1,"form-control","fs-6"],[1,"d-flex","align-items-center"],["for","departHour",1,"text-nowrap","m-1"],["id","departHour","formControlName","departHour",1,"form-select","form-select-sm","fs-6","w-auto"],["for","departHour",1,"m-1"],["id","departMinute","formControlName","departMinute",1,"form-select","form-select-sm","fs-6","w-auto"],["for","departMinute",1,"m-1"],["formControlName","departSearchMethod",1,"form-select","form-select-sm","fs-6"],["value","1"],["value","2"],["for","departApointTrainNumber",1,"text-center","m-1","text-nowrap"],["type","text","id","departApointTrainNumber","formControlName","departApointTrainNumber",1,"fs-6","form-control","form-control-sm","flex-grow-1"],[1,"border","rounded","shadow-sm","mt-2","p-3","fs-6"],[1,"d-flex","flex-wrap","align-items-center","justify-content-between"],[1,"border","rounded","d-flex","align-items-center","px-2","py-1","flex-grow-1","me-2"],[1,"d-flex","align-items-center","me-3","w-50"],["for","promotionType",1,"me-2","text-nowrap"],["id","promotionType","formControlName","promotionType",1,"form-select","form-select-sm","w-100"],[1,"d-flex","align-items-center","w-50"],["for","promotionCodeList",1,"me-2","text-nowrap"],["id","promotionCodeList","formControlName","promotionCodeList",1,"form-select","form-select-sm","w-100"],["value",""],[1,"mx-2"],[1,"border","rounded","d-flex","align-items-center","px-2","py-1",2,"min-width","250px"],["for","promotionCode",1,"me-2","text-nowrap"],["type","text","id","promotionCode","formControlName","promotionCode",1,"form-control","form-control-sm"],[1,"d-flex","align-items-center","gap-2","fs-6","w-100","justify-content-center","mt-2"],["type","button",1,"btn","bg-primary","text-white","px-4",3,"click","disabled"],["type","button",1,"btn","btn-secondary","px-4",3,"click","disabled"],[1,"text-center","text-nowrap","me-1",3,"for"],["type","number","min","0",1,"fs-6","form-control","form-control-sm",3,"id","formControlName"],["type","radio",1,"form-check-input","me-1",3,"id","formControlName","value"],[1,"form-check-label",3,"for"],["for","returnDate",1,"text-nowrap","m-1"],["type","date","id","returnDate","formControlName","returnDate",1,"form-control","fs-6"],["for","returnHour",1,"text-nowrap","m-1"],["id","returnHour","formControlName","returnHour",1,"form-select","form-select-sm","fs-6","w-auto"],["for","returnHour",1,"m-1"],["id","returnMinute","formControlName","returnMinute",1,"form-select","form-select-sm","fs-6","w-auto"],["for","returnMinute",1,"m-1"],["formControlName","returnSearchMethod",1,"form-select","form-select-sm","fs-6"],["for","returnApointTrainNumber",1,"text-center","m-1","text-nowrap"],["type","text","id","returnApointTrainNumber","formControlName","returnApointTrainNumber",1,"fs-6","form-control","form-control-sm","flex-grow-1"]],template:function(e,n){if(e&1&&(r(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),s(4,"\u51FA\u767C\u7AD9"),i(),r(5,"div",4)(6,"select",5),A(7,zt,2,2,"option",6,Y),i()(),r(9,"div",7)(10,"a",8),y("click",function(){return n.swapStation()}),_(11,"i",9),i()(),r(12,"label",10),s(13,"\u5230\u9054\u7AD9"),i(),r(14,"div",4)(15,"select",11),A(16,Jt,2,2,"option",6,Y),i()(),r(18,"div",7),_(19,"input",12),r(20,"label",13),s(21,"\u53BB\u56DE\u7968"),i()(),r(22,"div",14)(23,"span"),s(24,"\u7E3D\u4EBA\u6578 "),i(),r(25,"strong"),s(26),i()()(),r(27,"div",15)(28,"div",4),s(29,"\u8EAB\u5206\u5225/\u5F35\u6578"),i(),A(30,Zt,4,4,"div",16,Yt),i(),r(32,"div",17)(33,"div",7),s(34,"\u8ECA\u5EC2\u7A2E\u985E"),i(),A(35,Kt,4,8,"div",7,Qt),i(),r(37,"app-member-code",18),y("personalIdChange",function(m){return n.personalId.set(m)})("coperateIdChange",function(m){return n.coperateId.set(m)}),i()(),r(38,"div",19),s(39,"\u53BB\u7A0B"),i(),r(40,"div",20)(41,"label",21),s(42,"\u51FA\u767C\u65E5\u671F"),i(),r(43,"div",22),_(44,"input",23),i(),r(45,"div",24)(46,"label",25),s(47,"\u51FA\u767C\u6642\u9593"),i(),r(48,"select",26),A(49,Xt,2,2,"option",6,Y),i(),r(51,"label",27),s(52,"\u6642"),i(),r(53,"select",28),A(54,en,2,2,"option",6,Y),i(),r(56,"label",29),s(57,"\u5206"),i()(),r(58,"select",30)(59,"option",31),s(60,"\u4EE5\u51FA\u767C\u6642\u9593\u67E5\u8A62"),i(),r(61,"option",32),s(62,"\u4EE5\u5230\u9054\u6642\u9593\u67E5\u8A62"),i()(),r(63,"label",33),s(64,"\u6307\u5B9A\u8ECA\u6B21"),i(),_(65,"input",34),i(),V(66,rn,28,0),r(67,"div",35)(68,"div",36)(69,"div",37)(70,"div",38)(71,"label",39),s(72,"\u5C08\u6848\u5206\u985E"),i(),r(73,"select",40),A(74,on,2,2,"option",6,Wt),i()(),r(76,"div",41)(77,"label",42),s(78,"\u4FC3\u92B7\u4EE3\u78BC"),i(),r(79,"select",43)(80,"option",44),s(81,"\u8ACB\u9078\u64C7"),i(),A(82,an,2,2,"option",6,Ut),i()()(),r(84,"span",45),s(85,"\u6216"),i(),r(86,"div",46)(87,"label",47),s(88,"\u4FC3\u92B7\u4EE3\u78BC"),i(),_(89,"input",48),i()()(),r(90,"div",49)(91,"button",50),y("click",function(){return n.onSubmit(n.bookingType.general)}),s(92," \u4E00\u822C\u8A02\u4F4D "),i(),r(93,"button",51),y("click",function(){return n.onSubmit(n.bookingType.group)}),s(94," \u5718\u9AD4\u8A02\u4F4D "),i()()()),e&2){let o,m;c("formGroup",n.form),l(7),N(n.departStationList()),l(9),N(n.arrivalStationList()),l(10),b(n.totalPeople()),l(4),N(n.profiles()),l(5),N(n.classTypes()),l(2),c("coperateIdDisabled",!(!((o=(o=n.selectedPromotion())==null?null:o.accumulateCorporateMembers)!==null&&o!==void 0)||o))("personalIdDisabled",!(!((m=(m=n.selectedPromotion())==null?null:m.accumulateMembers)!==null&&m!==void 0)||m))("rowStyle",!0),l(12),N(n.hours()),l(5),N(n.minutes()),l(12),L(n.roundTrip()?66:-1),l(8),N(n.promotionTypeList()),l(8),N(n.filteredPromotionDataList()),l(7),F("disabled",n.promotionList()),et("readonly",n.promotionList()?"true":null),l(2),c("disabled",n.disableGernalBook()),l(2),c("disabled",n.disableGroupBook())}},dependencies:[H,Q,_e,qe,Oe,Ve,kt,Dt,Le,It,be,ge,$t,Z,ye,xe,Mt,Te],encapsulation:2})};var st=ct(ot());var sn=(a,t)=>t.index,ln=(a,t)=>t.name;function pn(a,t){if(a&1&&(r(0,"span",5),s(1),i()),a&2){let e=x();l(),b(e.promotionText())}}function mn(a,t){if(a&1&&(r(0,"option",9),s(1),i()),a&2){let e=t.$implicit;c("value",e),l(),b(e)}}function un(a,t){if(a&1&&(r(0,"option",9),s(1),i()),a&2){let e=t.$implicit;c("value",e),l(),b(e)}}function dn(a,t){if(a&1&&(r(0,"span",26),s(1),i()),a&2){let e=t.$implicit;Ct("background-color","#"+e.colorCode),l(),X(" ",e==null?null:e.name," ")}}function cn(a,t){if(a&1){let e=K();r(0,"tr",21),y("click",function(){let o=k(e).$implicit,m=x();return I(m.index.set(o.index))}),r(1,"td")(2,"input",22),y("change",function(){let o=k(e).$implicit,m=x();return I(m.index.set(o.index))}),i()(),r(3,"td"),s(4),i(),r(5,"td"),s(6),i(),r(7,"td"),s(8),i(),r(9,"td"),s(10),i(),r(11,"td"),s(12),i(),r(13,"td"),s(14),i(),r(15,"td",23)(16,"div",24),A(17,dn,2,3,"span",25,ln),i()()()}if(a&2){let e=t.$implicit,n=x();l(2),c("name",n.prefix()+"shift-index")("value",e.index)("checked",n.index()===e.index),l(2),b(e.trainNumber),l(2),b(e.departTime),l(2),b(e.arrivalTime),l(2),b(e.elapseTime),l(2),b(e.aVLSeatCount),l(2),b(e.trainDiscount),l(3),N(e.projects)}}var He=class a{search=R();query=j(null);records=j([]);outbound=j(!0);promotion=j(null);index=de(0);hours=w(Array.from({length:24},(t,e)=>e.toString().padStart(2,"0")));minutes=w(Array.from({length:60},(t,e)=>e.toString().padStart(2,"0")));prefix=C(()=>this.outbound()?"outbound":"inbound");queryObj=C(()=>this.query()||{});fromStation=C(()=>this.queryObj()[this.outbound()?"departStation":"arrivalStation"]);toStation=C(()=>this.queryObj()[this.outbound()?"arrivalStation":"departStation"]);date=C(()=>new Date(this.queryObj()[this.outbound()?"departDate":"returnDate"]||0));time=C(()=>(this.queryObj()[this.outbound()?"departTime":"returnTime"]||"").split(":"));searchMethod=C(()=>this.queryObj()[this.outbound()?"departSearchMethod":"returnSearchMethod"]||1);hour=C(()=>this.time()[0]);minute=C(()=>this.time()[1]);promotionText=C(()=>{let t=this.promotion();if(!t)return"";let e=parseFloat(t.projectDiscount)>0?`\u6298\u6263\u7387${t.projectDiscount}%`:`\u6298\u50F9${t.projectDiscount}`;return`${t.code} - ${t.projectName} ${e}`});form;formBuilder=T(Ee);constructor(){this.form=this.formBuilder.group({hour:[this.hour()],minute:[this.minute()],searchMethod:[this.searchMethod()]})}ngOnChanges(t){if(t.query&&this.form.patchValue({hour:this.hour(),minute:this.minute(),searchMethod:this.searchMethod()}),t.records){let e=this.records();e.length&&setTimeout(()=>{this.index.set(e[0].index)},0)}}onSubmit(){this.search.emit(this.form.value)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=P({type:a,selectors:[["app-timetable"]],inputs:{query:[1,"query"],records:[1,"records"],outbound:[1,"outbound"],promotion:[1,"promotion"],index:[1,"index"]},outputs:{search:"search",index:"indexChange"},features:[ht],decls:56,vars:17,consts:[[1,"d-flex","flex-column","h-100"],[1,"d-flex","align-items-center","mb-1","fw-bold","p-2"],[1,"me-1","text-danger"],[1,"me-1"],[1,"me-2"],[1,"fw-bold","text-danger","me-1"],[1,"d-flex","align-items-center","flex-wrap","gap-2","ms-auto",3,"ngSubmit","formGroup"],[3,"for"],["formControlName","hour",1,"form-select","form-select-sm","w-auto",3,"id"],[3,"value"],["formControlName","minute",1,"form-select","form-select-sm","w-auto",3,"id"],["formControlName","searchMethod",1,"form-select","form-select-sm","w-auto","me-1","fw-bold",3,"id"],["value","1"],["value","2"],[1,"btn","btn-sm","btn-primary","fw-bold"],[1,"flex-1","overflow-auto"],[1,"table","table-sm","table-striped","table-hover","table-bordered","table-sticky-header","text-center","align-middle","m-0"],[1,"table-warning","backdrop-blur"],[1,"text-nowrap"],[1,"text-nowrap","w-25"],["role","button"],["role","button",3,"click"],["type","radio",1,"form-check-input","me-1",3,"change","name","value","checked"],[1,"w-25"],[1,"d-flex","flex-wrap","justify-content-start","w-100"],[1,"badge","me-1","mb-1",3,"backgroundColor"],[1,"badge","me-1","mb-1"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"span",2),s(3),i(),r(4,"span",3),s(5),i(),r(6,"span",3),s(7,"\u2192"),i(),r(8,"span",4),s(9),i(),r(10,"span",4),s(11),gt(12,"date"),i(),V(13,pn,2,1,"span",5),r(14,"form",6),y("ngSubmit",function(){return n.onSubmit()}),r(15,"label",7),s(16,"\u6642\u9593:"),i(),r(17,"select",8),A(18,mn,2,2,"option",9,Y),i(),r(20,"label",7),s(21,"\u6642"),i(),r(22,"select",10),A(23,un,2,2,"option",9,Y),i(),r(25,"label",7),s(26,"\u5206"),i(),r(27,"select",11)(28,"option",12),s(29,"\u4EE5\u51FA\u767C\u6642\u9593\u67E5\u8A62"),i(),r(30,"option",13),s(31,"\u4EE5\u5230\u9054\u6642\u9593\u67E5\u8A62"),i()(),r(32,"button",14),s(33,"\u67E5\u8A62"),i()()(),r(34,"div",15)(35,"table",16)(36,"thead",17)(37,"tr"),_(38,"th"),r(39,"th",18),s(40,"\u8ECA\u6B21"),i(),r(41,"th",18),s(42,"\u51FA\u767C\u6642\u9593"),i(),r(43,"th",18),s(44,"\u5230\u9054\u6642\u9593"),i(),r(45,"th",18),s(46,"\u884C\u8ECA\u6642\u9593"),i(),r(47,"th",18),s(48,"\u53EF\u552E\u5EA7\u4F4D\u6578"),i(),r(49,"th",18),s(50,"\u512A\u60E0*"),i(),r(51,"th",19),s(52,"\u5C08\u6848*"),i()()(),r(53,"tbody"),A(54,cn,19,9,"tr",20,sn),i()()()()),e&2&&(l(3),b(n.outbound()?"\u53BB\u7A0B\u5217\u8ECA":"\u56DE\u7A0B\u5217\u8ECA"),l(2),b(n.fromStation()),l(4),b(n.toStation()),l(2),b(_t(12,12,n.date(),"MM/dd (EEEEE)","","zh")),l(2),L(n.promotion()?13:-1),l(),c("formGroup",n.form),l(),c("for",n.prefix()+"hour"),l(2),c("id",n.prefix()+"hour"),l(),N(n.hours()),l(2),c("for",n.prefix()+"hour"),l(2),c("id",n.prefix()+"minute"),l(),N(n.minutes()),l(2),c("for",n.prefix()+"minute"),l(2),c("id",n.prefix()+"searchMethod"),l(27),N(n.records()))},dependencies:[H,xt,Q,_e,qe,Oe,Le,be,ge,Z,ye,xe],encapsulation:2})};function fn(a,t){if(a&1){let e=K();r(0,"div",4)(1,"app-timetable",8),$e("indexChange",function(o){k(e);let m=x(2);return Ce(m.inboundIndex,o)||(m.inboundIndex=o),I(o)}),y("search",function(o){k(e);let m=x(2);return I(m.onInboundSearch(o))}),i()()}if(a&2){let e=x(2);l(),c("records",e.inbound())("promotion",e.promotion())("query",e.query()),Me("index",e.inboundIndex),c("outbound",!1)}}function hn(a,t){if(a&1){let e=K();r(0,"div",1)(1,"div",2)(2,"app-timetable",3),$e("indexChange",function(o){k(e);let m=x();return Ce(m.outboundIndex,o)||(m.outboundIndex=o),I(o)}),y("search",function(o){k(e);let m=x();return I(m.onOutboundSearch(o))}),i()(),V(3,fn,2,5,"div",4),r(4,"div",5)(5,"button",6),y("click",function(){k(e);let o=x();return I(o.onConfirm())}),s(6,"\u958B\u59CB\u8A02\u4F4D"),i(),r(7,"button",6),y("click",function(){k(e);let o=x();return I(o.onShowAll())}),s(8),i(),r(9,"button",7),y("click",function(){k(e);let o=x();return I(o.back.emit())}),s(10,"\u91CD\u8A2D\u67E5\u8A62\u689D\u4EF6"),i()()()}if(a&2){let e=x();F("h-100",e.roundTrip()),l(),F("flex-1",e.roundTrip()),l(),c("records",e.outbound())("promotion",e.promotion())("query",e.query()),Me("index",e.outboundIndex),l(),L(e.roundTrip()?3:-1),l(5),X(" ",e.showAll()?"\u50C5\u986F\u793A\u53EF\u552E\u8ECA\u6B21":"\u986F\u793A\u6700\u8FD1\u6240\u6709\u8ECA\u6B21"," ")}}var Ge=class a{confirm=R();back=R();query=de(null);data=de(null);inbound=C(()=>this.data()?.inbound||[]);outbound=C(()=>this.data()?.outbound||[]);promotion=C(()=>this.data()?.promotion||null);showAll=C(()=>this.query()?.allTrain===1);roundTrip=C(()=>!!this.data()?.inbound);outboundIndex=0;inboundIndex=0;loadingService=T(re);destroyRef=T(ie);messageService=T(ae);apiService=T(oe);onOutboundSearch(t){this.query.update(e=>(e.departTime=`${t.hour}:${t.minute}`,e.departSearchMethod=t.searchMethod,ve({},e))),this.updateQuery()}onInboundSearch(t){this.query.update(e=>(e.returnTime=`${t.hour}:${t.minute}`,e.returnSearchMethod=t.searchMethod,ve({},e))),this.updateQuery()}onShowAll(){this.query.update(t=>(t.allTrain=t.allTrain===0?1:0,ve({},t))),this.updateQuery()}onConfirm(){this.loadingService.loading||(this.loadingService.start(),this.apiService.chooseTrain(this.outboundIndex.toString(),(this.inboundIndex||"").toString()).pipe(z(this.destroyRef)).subscribe({next:t=>{this.loadingService.stop(),this.confirm.emit(t.data.trip)},error:t=>{this.loadingService.stop(),this.messageService.handleError(t)},complete:()=>{this.loadingService.stop()}}))}validate(){let t=[],e=this.outbound().find(o=>o.index===this.outboundIndex),n=this.inbound().find(o=>o.index===this.inboundIndex);if(this.roundTrip()&&e.departDate===n.departDate){let o=(0,st.default)(`${e.arrivalDate} ${e.arrivalTime}`,"YYYY/MM/DD HH:mm"),m=(0,st.default)(`${n.departDate} ${n.departTime}`,"YYYY/MM/DD HH:mm");if(m.isBefore(o)||m.isSame(o)){let{departDate:q}=this.query(),W=q.split("/")[0];t.push(`\u56DE\u7A0B\u51FA\u767C\u6642\u9593\u5FC5\u9808\u665A\u65BC\u53BB\u7A0B\u5230\u9054\u6642\u9593\u3002\u53BB\u7A0B\u51FA\u767C(\u5230\u9054)\u6642\u9593${W}/${o.format("MM/DD HH:mm")} - \u56DE\u7A0B\u51FA\u767C\u6642\u9593${W}/${m.format("MM/DD HH:mm")}`)}}return t}updateQuery(){this.loadingService.loading||(this.loadingService.start(),this.apiService.queryTrain(this.query()).pipe(z(this.destroyRef)).subscribe({next:t=>{this.loadingService.stop(),this.data.set(t.data)},error:t=>{this.loadingService.stop(),this.messageService.handleError(t)},complete:()=>{this.loadingService.stop()}}))}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=P({type:a,selectors:[["app-step2"]],inputs:{query:[1,"query"],data:[1,"data"]},outputs:{confirm:"confirm",back:"back",query:"queryChange",data:"dataChange"},decls:1,vars:1,consts:[[1,"d-flex","flex-column","py-2",3,"h-100"],[1,"d-flex","flex-column","py-2"],[1,"border","rounded","shadow-sm","p-0","overflow-hidden"],[3,"indexChange","search","records","promotion","query","index"],[1,"flex-1","border","rounded","shadow-sm","p-0","overflow-hidden","mt-2"],[1,"d-flex","gap-3","justify-content-center","mt-2"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-dark",3,"click"],[3,"indexChange","search","records","promotion","query","index","outbound"]],template:function(e,n){e&1&&V(0,hn,11,10,"div",0),e&2&&L(n.data()?0:-1)},dependencies:[Q,H,He],encapsulation:2})};var le=class a{readonly=j(!1);groupInfo=j(null);form;constructor(t){this.form=t.group({groupName:[this.groupInfo()?.groupName??""],personId:[this.groupInfo()?.personId??""],firstName:[this.groupInfo()?.firstName??""],lastName:[this.groupInfo()?.lastName??""],phoneNumber:[this.groupInfo()?.phoneNumber??""]}),yt(()=>{this.groupInfo()&&this.form.patchValue(this.groupInfo())})}getValues(){return this.form.value}static \u0275fac=function(e){return new(e||a)(St(Ee))};static \u0275cmp=P({type:a,selectors:[["app-group-leader"]],inputs:{readonly:[1,"readonly"],groupInfo:[1,"groupInfo"]},decls:18,vars:16,consts:[[1,"w-100","d-flex","align-items-center",3,"formGroup"],["for","groupName",1,"text-nowrap","m-1"],[1,"m-1"],["id","groupName","formControlName","groupName",1,"form-control","form-control-sm","fs-6",3,"readonly"],["for","personId",1,"text-nowrap","m-1"],["id","personId","formControlName","personId",1,"form-control","form-control-sm","fs-6",3,"readonly"],["for","firstName",1,"text-nowrap","m-1"],[1,"m-1","d-flex"],["id","firstName","placeholder","\u59D3","formControlName","firstName",1,"form-control","form-control-sm","fs-6",3,"readonly"],["id","lastName","placeholder","\u540D","formControlName","lastName",1,"form-control","form-control-sm","fs-6","ms-1",3,"readonly"],["for","phoneNumber",1,"text-nowrap","m-1"],["id","phoneNumber","formControlName","phoneNumber",1,"form-control","form-control-sm","fs-6",3,"readonly"]],template:function(e,n){e&1&&(r(0,"form",0)(1,"label",1),s(2,"\u5718\u9AD4\u540D\u7A31"),i(),r(3,"div",2),_(4,"input",3),i(),r(5,"label",4),s(6,"\u8EAB\u5206\u8B49\u865F/\u5718\u9AD4\u7D71\u7DE8"),i(),r(7,"div",2),_(8,"input",5),i(),r(9,"label",6),s(10,"\u4EE3\u8868\u4EBA\u59D3\u540D"),i(),r(11,"div",7),_(12,"input",8)(13,"input",9),i(),r(14,"label",10),s(15,"\u9023\u7D61\u96FB\u8A71"),i(),r(16,"div",2),_(17,"input",11),i()()),e&2&&(c("formGroup",n.form),l(4),F("disabled",n.readonly()),c("readonly",n.readonly()),l(4),F("disabled",n.readonly()),c("readonly",n.readonly()),l(4),F("disabled",n.readonly()),c("readonly",n.readonly()),l(),F("disabled",n.readonly()),c("readonly",n.readonly()),l(4),F("disabled",n.readonly()),c("readonly",n.readonly()))},dependencies:[Z,_e,Ve,be,ge,ye,xe],encapsulation:2})};function Sn(a,t){a&1&&_(0,"app-group-leader")}function vn(a,t){if(a&1){let e=K();r(0,"div",1),_(1,"app-bound",2),r(2,"app-member-code",3),$e("personalIdChange",function(o){let m=k(e);return Ce(m.membership.personalId,o)||(m.membership.personalId=o),I(o)})("coperateIdChange",function(o){let m=k(e);return Ce(m.membership.coperateId,o)||(m.membership.coperateId=o),I(o)}),i(),V(3,Sn,1,0,"app-group-leader"),r(4,"div",4)(5,"app-passengers",5,0),y("needToCheckChange",function(o){k(e);let m=x();return I(m.needToCheck.set(o))}),i()(),r(7,"div",6)(8,"div"),s(9,"\u4FC3\u92B7\u4EE3\u78BC"),i(),r(10,"div"),s(11),i(),r(12,"div",7),_(13,"input",8),r(14,"label",9),s(15,"\u4FDD\u7559\u7968\u6839\u4F5C\u70BA\u4F9D\u64DA"),i()()(),r(16,"div",10)(17,"button",11),y("click",function(){k(e);let o=x();return I(o.onSubmit())}),s(18,"\u78BA\u8A8D"),i(),r(19,"button",12),y("click",function(){k(e);let o=x();return I(o.onCheck())}),s(20," \u8CC7\u683C\u6AA2\u6838 "),i(),r(21,"button",13),y("click",function(){k(e);let o=x();return I(o.back.emit())}),s(22,"\u91CD\u65B0\u9078\u64C7\u8ECA\u6B21"),i()()()}if(a&2){let e,n,o=t,m=x();l(),c("roundTrip",m.roundTrip())("outbound",m.outbound())("inbound",m.inbound())("passengers",o.passengers)("isShort",!1)("hasCheckbox",!1),l(),Me("personalId",o.membership.personalId)("coperateId",o.membership.coperateId),c("coperateIdDisabled",!(!((e=(e=m.selectedPromotion())==null?null:e.accumulateCorporateMembers)!==null&&e!==void 0)||e))("personalIdDisabled",!(!((n=(n=m.selectedPromotion())==null?null:n.accumulateMembers)!==null&&n!==void 0)||n))("rowStyle",!0),l(),L(o!=null&&o.isGroup?3:-1),l(2),c("roundTrip",m.roundTrip())("passengers",o.passengers)("promotion",m.selectedPromotion())("isSelect",!1)("showRowCheckbox",!1)("showRowMarker",!1),l(6),b(m.promotionCode()),l(6),c("disabled",!m.seatTaken()),l(2),c("disabled",!m.needToCheck())}}var Ye=class a{confirm=R();back=R();promotions=j([]);data=de(null);needToCheck=w(!1);roundTrip=C(()=>this.data()?.tripType===2);promotionCode=C(()=>this.data()?.passengers.find(t=>t.tickets.find(e=>e.promotionCode))?.tickets[0].promotionCode);selectedPromotion=C(()=>this.promotions().find(t=>t.promotionCode===this.promotionCode())||null);seatTaken=C(()=>this.data()?.passengers.every(t=>t.tickets.every(e=>e.car&&e.seatRow&&e.seatCol)));inbound=C(()=>this.data()?.trains.find(t=>t.journey==="INBOUND"));outbound=C(()=>this.data()?.trains.find(t=>t.journey==="OUTBOUND"));loadingService=T(re);apiService=T(oe);messageService=T(ae);destroyRef=T(ie);passengersComponent=Xe(we);groupLeaderComponent=Xe(le);onCheck(){if(this.loadingService.loading)return;this.loadingService.start();let t=this.passengersComponent().getValues(),e=new Set(t.filter(o=>o.profile==="\u611B\u5FC3"&&o.personalId).map(o=>o.personalId)),n={passengers:Array.of(e).map(o=>({personalId:o,profileType:3}))};this.apiService.querySpecialPassenger(n).pipe(z(this.destroyRef)).subscribe({next:o=>{this.loadingService.stop(),this.passengersComponent().setPassengers(o.passengers)},error:o=>{this.loadingService.stop(),this.messageService.handleError(o)},complete:()=>{this.loadingService.stop()}})}onSeatChange(t){this.data.set(t)}onSubmit(){if(this.loadingService.loading)return;this.loadingService.start();let t=this.passengersComponent().getValues(),e=this.groupLeaderComponent()?.getValues(),n=this.data(),o={groupInfo:e,membership:n.membership,passengerInfo:t};this.apiService.generalBooking(o).pipe(z(this.destroyRef)).subscribe({next:m=>{this.loadingService.stop(),this.confirm.emit(m.data.trip)},error:m=>{this.loadingService.stop(),this.messageService.handleError(m)},complete:()=>{this.loadingService.stop()}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=P({type:a,selectors:[["app-step3"]],viewQuery:function(e,n){e&1&&(nt(n.passengersComponent,we,5),nt(n.groupLeaderComponent,le,5)),e&2&&bt(2)},inputs:{promotions:[1,"promotions"],data:[1,"data"]},outputs:{confirm:"confirm",back:"back",data:"dataChange"},decls:1,vars:1,consts:[["passengers",""],[1,"d-flex","flex-column","h-100","py-2"],[3,"roundTrip","outbound","inbound","passengers","isShort","hasCheckbox"],[1,"mt-2",3,"personalIdChange","coperateIdChange","personalId","coperateId","coperateIdDisabled","personalIdDisabled","rowStyle"],[1,"mt-2","overflow-auto"],[3,"needToCheckChange","roundTrip","passengers","promotion","isSelect","showRowCheckbox","showRowMarker"],[1,"d-flex","gap-3","justify-content-start","mt-2"],[1,"ms-auto"],["type","checkbox","id","retain",1,"form-check-input","me-1","fs-6"],["for","retain"],[1,"d-flex","gap-3","justify-content-center","mt-2"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["type","button",1,"btn","btn-dark","ms-auto",3,"click","disabled"],["type","button",1,"btn","btn-dark",3,"click"]],template:function(e,n){if(e&1&&V(0,vn,23,21,"div",1),e&2){let o;L((o=n.data())?0:-1,o)}},dependencies:[Q,H,Re,Z,we,Te,le],encapsulation:2})};function Cn(a,t){if(a&1&&_(0,"app-group-leader",6),a&2){let e=x();c("groupInfo",e.groupInfo)("readonly",!0)}}function bn(a,t){if(a&1&&(r(0,"span"),s(1),i()),a&2){let e=t.$implicit;l(),b(e)}}function gn(a,t){if(a&1){let e=K();r(0,"div",0)(1,"div",1)(2,"div")(3,"span",2),s(4,"\u8A02\u4F4D\u4EE3\u865F"),i(),r(5,"span"),s(6),i()(),r(7,"div",3)(8,"span",2),s(9,"\u4ED8\u6B3E\u671F\u9650"),i(),r(10,"span"),s(11,"\u7ACB\u5373\u4ED8\u6B3E"),i()()(),_(12,"app-bound",4)(13,"app-member-code",5),V(14,Cn,1,2,"app-group-leader",6),r(15,"div",7),_(16,"app-passengers",8),i(),r(17,"div",9)(18,"div",10)(19,"div",11),s(20,"\u7E3D\u4EBA\u6578"),i(),r(21,"div",12),s(22),A(23,bn,2,1,"span",null,Y),s(25," ) "),i()(),r(26,"div",10)(27,"div",11),s(28,"\u7E3D\u7968\u50F9"),i(),r(29,"div",3),s(30),i()()(),r(31,"div",13)(32,"div"),s(33,"\u4FC3\u92B7\u4EE3\u78BC"),i()(),r(34,"div",14)(35,"button",15),y("click",function(){k(e);let o=x();return I(o.onSubmit())}),s(36,"\u4ED8\u6B3E\u53D6\u7968"),i(),r(37,"button",16),y("click",function(){k(e);let o=x();return I(o.onCancel())}),s(38,"\u53D6\u6D88"),i()()()}if(a&2){let e=t,n=x();l(6),b(e.pnrId),l(6),c("roundTrip",n.roundTrip())("outbound",n.outbound())("inbound",n.inbound())("seatSelectable",!1)("isShort",!1)("hasCheckbox",!1),l(),c("personalId",e.membership.personalId)("coperateId",e.membership.coperateId)("readonly",!0)("rowStyle",!0),l(),L(e!=null&&e.isGroup?14:-1),l(2),c("roundTrip",n.roundTrip())("passengers",e.passengers)("readonly",!0)("isSelect",!1)("showRowCheckbox",!1)("showRowMarker",!1),l(6),X(" ",n.totalPeople(),"\u4EBA ( "),l(),N(n.passengerProfiles()),l(7),b(n.totalFare())}}var Qe=class a{confirm=R();cancel=R();data=j(null);roundTrip=C(()=>this.data()?.tripType===2);totalPeople=C(()=>this.data()?.passengers.length||0);passengerProfiles=C(()=>{let t=this.data();if(!t)return[];let e={};for(let n of t.passengers)e[n.profile]=(e[n.profile]||0)+1;return Object.entries(e).map(([n,o])=>`${n} ${o}\u5F35`)});inbound=C(()=>this.data()?.trains.find(t=>t.journey==="INBOUND"));outbound=C(()=>this.data()?.trains.find(t=>t.journey==="OUTBOUND"));totalFare=C(()=>this.data()?.passengers.reduce((t,e)=>t+e.tickets.reduce((n,o)=>n+o.fare,0),0));onSubmit(){this.confirm.emit()}onCancel(){return Pe(this,null,function*(){this.cancel.emit()})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=P({type:a,selectors:[["app-step4"]],inputs:{data:[1,"data"]},outputs:{confirm:"confirm",cancel:"cancel"},decls:1,vars:1,consts:[[1,"d-flex","flex-column","h-100","py-2"],[1,"d-flex","mb-2"],[1,"me-3"],[1,"ms-auto"],[3,"roundTrip","outbound","inbound","seatSelectable","isShort","hasCheckbox"],[1,"mt-2",3,"personalId","coperateId","readonly","rowStyle"],[3,"groupInfo","readonly"],[1,"mt-2","overflow-auto"],[3,"roundTrip","passengers","readonly","isSelect","showRowCheckbox","showRowMarker"],[1,"bg-warning-subtle","mt-2","p-2","w-50"],[1,"d-flex"],[1,"me-5"],[1,"d-flex","gap-2"],[1,"d-flex","gap-3","justify-content-start","mt-2"],[1,"d-flex","gap-3","justify-content-center","mt-2"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-dark",3,"click"]],template:function(e,n){if(e&1&&V(0,gn,39,20,"div",0),e&2){let o;L((o=n.data())?0:-1,o)}},dependencies:[H,Q,Z,Re,we,Te,le],encapsulation:2})};function _n(a,t){if(a&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"strong"),s(5,"\u8A02\u4F4D\u4EE3\u865F\uFF1A"),i(),s(6),i()(),r(7,"div",2)(8,"div")(9,"strong"),s(10,"\u4ED8\u6B3E\u671F\u9650\uFF1A"),i()()()(),r(11,"div",1)(12,"div",2)(13,"div")(14,"strong"),s(15,"\u8A02\u4F4D\u901A\u8DEF\uFF1A"),i(),s(16),i()(),r(17,"div",2)(18,"div")(19,"strong"),s(20,"\u4ED8\u6B3E\u65B9\u5F0F\uFF1A"),i(),s(21," \u5C1A\u672A\u4ED8\u6B3E"),i()()()()),a&2){let e=t;l(6),X(" ",e.pnrId,""),l(10),X(" ",e.bookChanel,"")}}var We=class a{data=j(null);static \u0275fac=function(e){return new(e||a)};static \u0275cmp=P({type:a,selectors:[["app-step4-cancel"]],inputs:{data:[1,"data"]},decls:1,vars:1,consts:[[1,"container","py-3"],[1,"row","mb-2"],[1,"col-6"]],template:function(e,n){if(e&1&&V(0,_n,22,2,"div",0),e&2){let o;L((o=n.data())?0:-1,o)}},encapsulation:2})};var Ue=class a{promotions=w([]);step=w(1);step1Query=w(null);step1Data=w(null);step2Data=w(null);step3Data=w(null);step4CancelData=w(null);mmiService=T(wt);messageService=T(ae);loadingService=T(re);apiService=T(oe);destroyRef=T(ie);router=T(Et);constructor(){this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21"])}onStep1Confirm(t){this.step1Query.set(t.query),this.step1Data.set(t.data),this.step.set(2),this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21"])}onStep2Back(){this.step.set(1),this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21"])}onStep2Confirm(t){this.step2Data.set(t),this.step.set(3),this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21","\u9078\u64C7\u5EA7\u4F4D/\u586B\u5BEB\u4E58\u5BA2\u8CC7\u6599"])}onStep3Confirm(t){this.step3Data.set(t),this.step.set(4),this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21","\u9078\u64C7\u5EA7\u4F4D/\u586B\u5BEB\u4E58\u5BA2\u8CC7\u6599","\u8A02\u4F4D\u5B8C\u6210"])}onStep3Back(){this.step.set(2),this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21"])}onStep4Confirm(){this.step.set(5),this.router.navigate(["/mmi/main/payment"])}onStep4Cancel(){this.cancelBooking()}canDeactiveGuard(){return this.step()===4?(this.cancelBooking(),!1):!0}cancelBooking(){return Pe(this,null,function*(){return(yield this.messageService.show({title:"\u53D6\u6D88\u8A02\u7968",message:"\u78BA\u5B9A\u53D6\u6D88\u8A02\u7968\u7D00\u9304\uFF1F",confirmation:!0,cancelText:"\u5426",confirmText:"\u662F"}).result)?(this.apiService.cancelBooking().pipe(z(this.destroyRef)).subscribe({next:e=>{this.loadingService.stop(),this.step4CancelData.set(e.data),this.messageService.setErrors(["\u53D6\u6D88\u8A02\u4F4D\u6210\u529F\uFF01"]),this.step.set(42)},error:e=>{this.loadingService.stop(),this.messageService.handleError(e)},complete:()=>{this.loadingService.stop()}}),!0):!1})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=P({type:a,selectors:[["app-new"]],decls:6,vars:16,consts:[[3,"confirm","promotions"],[3,"confirm","back","query","data"],[3,"confirm","back","data","promotions"],[3,"confirm","cancel","data"],[3,"data"]],template:function(e,n){e&1&&(_(0,"app-errors"),r(1,"app-step1",0),y("confirm",function(m){return n.onStep1Confirm(m)})("promotions",function(m){return n.promotions.set(m)}),i(),r(2,"app-step2",1),y("confirm",function(m){return n.onStep2Confirm(m)})("back",function(){return n.onStep2Back()}),i(),r(3,"app-step3",2),y("confirm",function(m){return n.onStep3Confirm(m)})("back",function(){return n.onStep3Back()}),i(),r(4,"app-step4",3),y("confirm",function(){return n.onStep4Confirm()})("cancel",function(){return n.onStep4Cancel()}),i(),_(5,"app-step4-cancel",4)),e&2&&(l(),F("d-none",n.step()!==1),l(),F("d-none",n.step()!==2),c("query",n.step1Query())("data",n.step1Data()),l(),F("d-none",n.step()!==3),c("data",n.step2Data())("promotions",n.promotions()),l(),F("d-none",n.step()!==4),c("data",n.step3Data()),l(),F("d-none",n.step()!==42),c("data",n.step4CancelData()))},dependencies:[H,Q,je,Ge,Ye,Qe,We,At],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})};var yn=[{path:"",component:Ue,canDeactivate:[Nt]}],Lt=class a{static \u0275fac=function(e){return new(e||a)};static \u0275mod=vt({type:a});static \u0275inj=ft({imports:[H,Tt.forChild(yn)]})};export{Lt as NewModule};
