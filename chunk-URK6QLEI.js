import{a as Te,b as Ye,c as Ee,d as Lt}from"./chunk-J4QCZN3P.js";import{A as ae,B as se,a as At,b as Re,c as J,d as Ce,e as _e,h as be,i as Ft,j as Bt,k as ge,m as Pt,n as ye,o as je,p as He,q as Ge,r as Vt,s as xe,t as W,u as Z,v as z,w as ce,z as re}from"./chunk-5JAWHIKF.js";import{a as Nt}from"./chunk-SJF4UMRN.js";import{$ as D,Aa as N,Ab as It,Ba as o,Bb as G,Ca as n,D as nt,Da as g,Ea as K,Fa as y,Ga as x,I as _t,Jb as Mt,Ka as at,L as w,Nb as $t,Oa as st,Pa as Tt,Q as bt,R as k,Ra as s,S as I,Sa as b,Ta as X,Ua as Et,V as oe,Va as $e,Wa as ve,Xa as Ne,Y as H,Ya as Le,Z as R,Za as Oe,_a as qe,a as Se,b as vt,ba as p,c as Ut,d as Ct,e as Ve,ea as gt,eb as wt,fa as ot,ga as Me,ha as B,hb as Dt,ia as yt,m as it,ma as P,nb as _,ob as kt,qa as rt,ra as c,sa as xt,ta as V,wa as L,ya as Q,za as $}from"./chunk-H5KATAC4.js";var ut=Ut((lt,mt)=>{"use strict";(function(a,t){typeof lt=="object"&&typeof mt<"u"?mt.exports=t():typeof define=="function"&&define.amd?define(t):(a=typeof globalThis<"u"?globalThis:a||self).dayjs=t()})(lt,function(){"use strict";var a=1e3,t=6e4,e=36e5,i="millisecond",r="second",l="minute",C="hour",O="day",Ae="week",U="month",ct="quarter",ie="year",fe="date",ft="Invalid Date",Gt=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Yt=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Qt={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(h){var d=["th","st","nd","rd"],m=h%100;return"["+h+(d[(m-20)%10]||d[m]||d[0])+"]"}},et=function(h,d,m){var f=String(h);return!f||f.length>=d?h:""+Array(d+1-f.length).join(m)+h},Wt={s:et,z:function(h){var d=-h.utcOffset(),m=Math.abs(d),f=Math.floor(m/60),u=m%60;return(d<=0?"+":"-")+et(f,2,"0")+":"+et(u,2,"0")},m:function h(d,m){if(d.date()<m.date())return-h(m,d);var f=12*(m.year()-d.year())+(m.month()-d.month()),u=d.clone().add(f,U),S=m-u<0,v=d.clone().add(f+(S?-1:1),U);return+(-(f+(m-u)/(S?u-v:v-u))||0)},a:function(h){return h<0?Math.ceil(h)||0:Math.floor(h)},p:function(h){return{M:U,y:ie,w:Ae,d:O,D:fe,h:C,m:l,s:r,ms:i,Q:ct}[h]||String(h||"").toLowerCase().replace(/s$/,"")},u:function(h){return h===void 0}},De="en",me={};me[De]=Qt;var ht="$isDayjsObject",tt=function(h){return h instanceof Be||!(!h||!h[ht])},Fe=function h(d,m,f){var u;if(!d)return De;if(typeof d=="string"){var S=d.toLowerCase();me[S]&&(u=S),m&&(me[S]=m,u=S);var v=d.split("-");if(!u&&v.length>1)return h(v[0])}else{var E=d.name;me[E]=d,u=E}return!f&&u&&(De=u),u||!f&&De},A=function(h,d){if(tt(h))return h.clone();var m=typeof d=="object"?d:{};return m.date=h,m.args=arguments,new Be(m)},T=Wt;T.l=Fe,T.i=tt,T.w=function(h,d){return A(h,{locale:d.$L,utc:d.$u,x:d.$x,$offset:d.$offset})};var Be=function(){function h(m){this.$L=Fe(m.locale,null,!0),this.parse(m),this.$x=this.$x||m.x||{},this[ht]=!0}var d=h.prototype;return d.parse=function(m){this.$d=function(f){var u=f.date,S=f.utc;if(u===null)return new Date(NaN);if(T.u(u))return new Date;if(u instanceof Date)return new Date(u);if(typeof u=="string"&&!/Z$/i.test(u)){var v=u.match(Gt);if(v){var E=v[2]-1||0,M=(v[7]||"0").substring(0,3);return S?new Date(Date.UTC(v[1],E,v[3]||1,v[4]||0,v[5]||0,v[6]||0,M)):new Date(v[1],E,v[3]||1,v[4]||0,v[5]||0,v[6]||0,M)}}return new Date(u)}(m),this.init()},d.init=function(){var m=this.$d;this.$y=m.getFullYear(),this.$M=m.getMonth(),this.$D=m.getDate(),this.$W=m.getDay(),this.$H=m.getHours(),this.$m=m.getMinutes(),this.$s=m.getSeconds(),this.$ms=m.getMilliseconds()},d.$utils=function(){return T},d.isValid=function(){return this.$d.toString()!==ft},d.isSame=function(m,f){var u=A(m);return this.startOf(f)<=u&&u<=this.endOf(f)},d.isAfter=function(m,f){return A(m)<this.startOf(f)},d.isBefore=function(m,f){return this.endOf(f)<A(m)},d.$g=function(m,f,u){return T.u(m)?this[f]:this.set(u,m)},d.unix=function(){return Math.floor(this.valueOf()/1e3)},d.valueOf=function(){return this.$d.getTime()},d.startOf=function(m,f){var u=this,S=!!T.u(f)||f,v=T.p(m),E=function(de,j){var ne=T.w(u.$u?Date.UTC(u.$y,j,de):new Date(u.$y,j,de),u);return S?ne:ne.endOf(O)},M=function(de,j){return T.w(u.toDate()[de].apply(u.toDate("s"),(S?[0,0,0,0]:[23,59,59,999]).slice(j)),u)},F=this.$W,q=this.$M,Y=this.$D,he="set"+(this.$u?"UTC":"");switch(v){case ie:return S?E(1,0):E(31,11);case U:return S?E(1,q):E(0,q+1);case Ae:var ue=this.$locale().weekStart||0,ke=(F<ue?F+7:F)-ue;return E(S?Y-ke:Y+(6-ke),q);case O:case fe:return M(he+"Hours",0);case C:return M(he+"Minutes",1);case l:return M(he+"Seconds",2);case r:return M(he+"Milliseconds",3);default:return this.clone()}},d.endOf=function(m){return this.startOf(m,!1)},d.$set=function(m,f){var u,S=T.p(m),v="set"+(this.$u?"UTC":""),E=(u={},u[O]=v+"Date",u[fe]=v+"Date",u[U]=v+"Month",u[ie]=v+"FullYear",u[C]=v+"Hours",u[l]=v+"Minutes",u[r]=v+"Seconds",u[i]=v+"Milliseconds",u)[S],M=S===O?this.$D+(f-this.$W):f;if(S===U||S===ie){var F=this.clone().set(fe,1);F.$d[E](M),F.init(),this.$d=F.set(fe,Math.min(this.$D,F.daysInMonth())).$d}else E&&this.$d[E](M);return this.init(),this},d.set=function(m,f){return this.clone().$set(m,f)},d.get=function(m){return this[T.p(m)]()},d.add=function(m,f){var u,S=this;m=Number(m);var v=T.p(f),E=function(q){var Y=A(S);return T.w(Y.date(Y.date()+Math.round(q*m)),S)};if(v===U)return this.set(U,this.$M+m);if(v===ie)return this.set(ie,this.$y+m);if(v===O)return E(1);if(v===Ae)return E(7);var M=(u={},u[l]=t,u[C]=e,u[r]=a,u)[v]||1,F=this.$d.getTime()+m*M;return T.w(F,this)},d.subtract=function(m,f){return this.add(-1*m,f)},d.format=function(m){var f=this,u=this.$locale();if(!this.isValid())return u.invalidDate||ft;var S=m||"YYYY-MM-DDTHH:mm:ssZ",v=T.z(this),E=this.$H,M=this.$m,F=this.$M,q=u.weekdays,Y=u.months,he=u.meridiem,ue=function(j,ne,Ie,Pe){return j&&(j[ne]||j(f,S))||Ie[ne].slice(0,Pe)},ke=function(j){return T.s(E%12||12,j,"0")},de=he||function(j,ne,Ie){var Pe=j<12?"AM":"PM";return Ie?Pe.toLowerCase():Pe};return S.replace(Yt,function(j,ne){return ne||function(Ie){switch(Ie){case"YY":return String(f.$y).slice(-2);case"YYYY":return T.s(f.$y,4,"0");case"M":return F+1;case"MM":return T.s(F+1,2,"0");case"MMM":return ue(u.monthsShort,F,Y,3);case"MMMM":return ue(Y,F);case"D":return f.$D;case"DD":return T.s(f.$D,2,"0");case"d":return String(f.$W);case"dd":return ue(u.weekdaysMin,f.$W,q,2);case"ddd":return ue(u.weekdaysShort,f.$W,q,3);case"dddd":return q[f.$W];case"H":return String(E);case"HH":return T.s(E,2,"0");case"h":return ke(1);case"hh":return ke(2);case"a":return de(E,M,!0);case"A":return de(E,M,!1);case"m":return String(M);case"mm":return T.s(M,2,"0");case"s":return String(f.$s);case"ss":return T.s(f.$s,2,"0");case"SSS":return T.s(f.$ms,3,"0");case"Z":return v}return null}(j)||v.replace(":","")})},d.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},d.diff=function(m,f,u){var S,v=this,E=T.p(f),M=A(m),F=(M.utcOffset()-this.utcOffset())*t,q=this-M,Y=function(){return T.m(v,M)};switch(E){case ie:S=Y()/12;break;case U:S=Y();break;case ct:S=Y()/3;break;case Ae:S=(q-F)/6048e5;break;case O:S=(q-F)/864e5;break;case C:S=q/e;break;case l:S=q/t;break;case r:S=q/a;break;default:S=q}return u?S:T.a(S)},d.daysInMonth=function(){return this.endOf(U).$D},d.$locale=function(){return me[this.$L]},d.locale=function(m,f){if(!m)return this.$L;var u=this.clone(),S=Fe(m,f,!0);return S&&(u.$L=S),u},d.clone=function(){return T.w(this.$d,this)},d.toDate=function(){return new Date(this.valueOf())},d.toJSON=function(){return this.isValid()?this.toISOString():null},d.toISOString=function(){return this.$d.toISOString()},d.toString=function(){return this.$d.toUTCString()},h}(),St=Be.prototype;return A.prototype=St,[["$ms",i],["$s",r],["$m",l],["$H",C],["$W",O],["$M",U],["$y",ie],["$D",fe]].forEach(function(h){St[h[1]]=function(d){return this.$g(d,h[0],h[1])}}),A.extend=function(h,d){return h.$i||(h(d,Be,A),h.$i=!0),A},A.locale=Fe,A.isDayjs=tt,A.unix=function(h){return A(1e3*h)},A.en=me[De],A.Ls=me,A.p={},A})});var Ot=a=>a?.canDeactiveGuard();var pt=(e=>(e[e.general=1]="general",e[e.group=2]="group",e))(pt||{});var Qe=class{trip=D(null);promotions=D([]);roundTrip=_(()=>this.trip()?.tripType===2);promotionCode=_(()=>this.trip()?.passengers.find(t=>t.tickets.find(e=>e.promotionCode))?.tickets[0].promotionCode);selectedPromotion=_(()=>this.promotions().find(t=>t.promotionCode===this.promotionCode())||null);seatTaken=_(()=>this.trip()?.passengers.every(t=>t.tickets.every(e=>e.car&&e.seatRow&&e.seatCol)));inbound=_(()=>this.trip()?.trains.find(t=>t.journey==="INBOUND"));outbound=_(()=>this.trip()?.trains.find(t=>t.journey==="OUTBOUND"));promotionTickets=_(()=>{let t=this.trip();if(!t||!this.promotionCode())return null;let e={};t.passengers.forEach(l=>{l.tickets.forEach(C=>{C.promotionCode&&(e[C.promotionCode]=e[C.promotionCode]||{},e[C.promotionCode][l.profile]=e[C.promotionCode][l.profile]||0,++e[C.promotionCode][l.profile])})});let i=this.promotions(),r=[];for(let l of Object.keys(e)){let C=i.find(O=>O.promotionCode===l);if(C)for(let O of Object.keys(e[l]))r.push({profile:O,promotionName:C.projectName,count:e[l][O]})}return{tickets:r,code:this.promotionCode()}});totalPeople=_(()=>this.trip()?.passengers.length||0);passengerProfiles=_(()=>{let t=this.trip();if(!t)return[];let e={};for(let i of t.passengers)e[i.profile]=(e[i.profile]||0)+1;return Object.entries(e).map(([i,r])=>`${i} ${r}\u5F35`)});totalFare=_(()=>this.trip()?.passengers.reduce((t,e)=>t+e.tickets.reduce((i,r)=>i+r.fare,0),0))};var ee=Ct(ut());var Zt=(a,t)=>t.code,Kt=(a,t)=>t.name,Xt=(a,t)=>t.id,ei=(a,t)=>t.promotionCode;function ti(a,t){if(a&1&&(o(0,"option",6),s(1),n()),a&2){let e=t.$implicit;c("value",e),p(),b(e)}}function ii(a,t){if(a&1&&(o(0,"option",6),s(1),n()),a&2){let e=t.$implicit;c("value",e),p(),b(e)}}function ni(a,t){if(a&1&&(o(0,"div",16)(1,"label",52),s(2),n(),g(3,"input",53),n()),a&2){let e=t.$implicit,i=t.$index;p(),c("for","profile-"+e.code),p(),b(e.content),p(),c("id","profile-"+e.code)("formControlName",i)}}function oi(a,t){if(a&1&&(o(0,"div",7),g(1,"input",54),o(2,"label",55),s(3),n()()),a&2){let e=t.$implicit;p(),at("id","classType-",e.value,""),c("formControlName","classType")("value",e.value),rt("disabled",e.disabled?"true":null),p(),at("for","classType-",e.value,""),p(),b(e.name)}}function ri(a,t){if(a&1&&(o(0,"option",6),s(1),n()),a&2){let e=t.$implicit;c("value",e),p(),b(e)}}function ai(a,t){if(a&1&&(o(0,"option",6),s(1),n()),a&2){let e=t.$implicit;c("value",e),p(),b(e)}}function si(a,t){if(a&1&&(o(0,"option",6),s(1),n()),a&2){let e=t.$implicit;c("value",e),p(),b(e)}}function pi(a,t){if(a&1&&(o(0,"option",6),s(1),n()),a&2){let e=t.$implicit;c("value",e),p(),b(e)}}function li(a,t){if(a&1&&(o(0,"div",19),s(1,"\u56DE\u7A0B"),n(),o(2,"div",20)(3,"label",56),s(4,"\u51FA\u767C\u65E5\u671F"),n(),o(5,"div",22),g(6,"input",57),n(),o(7,"div",24)(8,"label",58),s(9,"\u51FA\u767C\u6642\u9593"),n(),o(10,"select",59),$(11,si,2,2,"option",6,Q),n(),o(13,"label",60),s(14,"\u6642"),n(),o(15,"select",61),$(16,pi,2,2,"option",6,Q),n(),o(18,"label",62),s(19,"\u5206"),n()(),o(20,"select",63)(21,"option",31),s(22,"\u4EE5\u51FA\u767C\u6642\u9593\u67E5\u8A62"),n(),o(23,"option",32),s(24,"\u4EE5\u5230\u9054\u6642\u9593\u67E5\u8A62"),n()(),o(25,"label",64),s(26,"\u6307\u5B9A\u8ECA\u6B21"),n(),g(27,"input",65),n()),a&2){let e=x();p(11),N(e.hours()),p(5),N(e.minutes())}}function mi(a,t){if(a&1&&(o(0,"option",6),s(1),n()),a&2){let e=t.$implicit;c("value",e.id),p(),b(e.name)}}function ui(a,t){if(a&1&&(o(0,"option",6),s(1),n()),a&2){let e=t.$implicit;c("value",e.promotionCode),p(),b(e.projectName)}}var qt=[{content:"\u6210\u4EBA",code:"F",isEnable:!0},{content:"\u5B69\u7AE5",code:"H",isEnable:!0},{content:"\u611B\u5FC3",code:"W",isEnable:!0},{content:"\u656C\u8001",code:"E",isEnable:!0},{content:"\u5B78\u751F",code:"P",isEnable:!0},{content:"\u7279\u60E0\u5168",code:"S",isEnable:!0},{content:"\u7279\u60E0\u534A",code:"M",isEnable:!0}],Rt=[{name:"\u6A19\u6E96\u8ECA\u5EC2",value:1,disabled:!1},{name:"\u5546\u52D9\u8ECA\u5EC2",value:2,disabled:!1},{name:"\u8F2A\u6905\u5EA7\u4F4D",value:3,disabled:!1}],We=class a{confirm=H();promotions=H();bookingType=pt;form;profiles=D(qt);departStationList=D([]);arrivalStationList=D([]);totalPeople;classType;classTypes=D(Rt);promotionTypeList=D([]);promotionDataList=D([]);hours=D(Array.from({length:24},(t,e)=>e.toString().padStart(2,"0")));minutes=D(Array.from({length:60},(t,e)=>e.toString().padStart(2,"0")));promotionType;promotionList;roundTrip;personalId=D("");coperateId=D("");selectedPromotion;filteredPromotionDataList=_(()=>{let t=this.promotionType();return this.promotionDataList().filter(e=>e.promotionTypeId===t)});disableGernalBook=_(()=>this.totalPeople()>10);disableGroupBook=_(()=>this.roundTrip()||this.classType()===3||this.selectedPromotion()?.cancel_group_reservation);formBuilder=w(xe);apiService=w(ae);loadingService=w(re);messageService=w(se);destroyRef=w(oe);constructor(){this.form=this.formBuilder.group({profiles:this.formBuilder.array(qt.map(()=>this.formBuilder.control(null))),departStation:[null,J.required],arrivalStation:[null,J.required],classType:[Rt[0].value,J.required],roundTrip:[!1],departDate:[(0,ee.default)().format("YYYY-MM-DD"),J.required],departHour:[(0,ee.default)().format("HH"),J.required],departMinute:[(0,ee.default)().format("mm"),J.required],departSearchMethod:[1],departApointTrainNumber:[null],returnDate:[(0,ee.default)().add(1,"day").format("YYYY-MM-DD"),J.required],returnHour:[(0,ee.default)().format("HH"),J.required],returnMinute:[(0,ee.default)().format("mm"),J.required],returnSearchMethod:[1],returnApointTrainNumber:[null],promotionType:[0],promotionCodeList:[""],promotionCode:[null]}),this.promotionType=ce(this.form.get("promotionType").valueChanges.pipe(it(e=>parseInt(e,10)),nt(()=>this.form.patchValue({promotionCodeList:""}))),{initialValue:0}),this.promotionList=ce(this.form.get("promotionCodeList").valueChanges.pipe(nt(e=>this.form.patchValue({promotionCode:e}))),{initialValue:""}),this.totalPeople=ce(this.form.valueChanges.pipe(it(()=>this.form.get("profiles").controls.reduce((e,i)=>e+(i.value||0),0))),{initialValue:0}),this.roundTrip=ce(this.form.get("roundTrip").valueChanges),this.classType=ce(this.form.get("classType").valueChanges);let t=ce(this.form.get("promotionCode").valueChanges);this.selectedPromotion=_(()=>this.promotionDataList().find(i=>i.promotionCode===t())??null),this.loadingService.start(),this.apiService.startReservation(!1).pipe(z(this.destroyRef)).subscribe({next:e=>{this.loadingService.stop(),this.departStationList.set(e.data.departStationList),this.arrivalStationList.set(e.data.arrivalStationList),this.promotionTypeList.set(e.data.promotionOfProjectData.promotionTypeList),this.promotionDataList.set(e.data.promotionOfProjectData.promotionDataList),this.profiles.set(e.data.profile),this.form.setControl("profiles",this.formBuilder.array(e.data.profile.map(()=>this.formBuilder.control(null)))),this.classTypes.update(i=>(i.forEach(r=>{let l=e.data.classType.find(C=>C===r.name);r.disabled=!l}),i)),this.form.patchValue({departStation:this.departStationList()[0],arrivalStation:this.arrivalStationList()[1]}),this.promotions.emit(e.data.promotionOfProjectData.promotionDataList)},error:e=>{this.loadingService.stop(),this.messageService.handleError(e)},complete:()=>{this.loadingService.stop()}})}swapStation(){let t=this.form.get("departureStation")?.value,e=this.form.get("arrivalStation")?.value;this.form.get("departureStation")?.setValue(e),this.form.get("arrivalStation")?.setValue(t)}onSubmit(t){if(this.loadingService.loading)return;this.loadingService.start();let e=vt(Se({},this.form.value),{bookingType:t});e.tripType=e.roundTrip?2:1,e.profile=this.getProfiles(),e.membership={personalId:e.personalId,coperateId:e.coperateId},e.departDate=e.departDate.replaceAll("-","/"),e.returnDate=e.returnDate.replaceAll("-","/"),e.departTime=`${e.departHour}:${e.departMinute}`,e.returnTime=`${e.returnHour}:${e.returnMinute}`,e.allTrain=0,e.requeryTrain=!1,e.personalId=this.personalId(),e.coperateId=this.coperateId(),["profiles","promotionType","promotionCodeList","roundTrip","departHour","departMinute","returnHour","returnMinute"].forEach(i=>{delete e[i]}),this.apiService.queryTrain(e).pipe(z(this.destroyRef)).subscribe({next:i=>{this.loadingService.stop(),this.confirm.emit({query:e,data:i.data})},error:i=>{this.loadingService.stop(),this.messageService.handleError(i)},complete:()=>{this.loadingService.stop()}})}validate(){let t=[];this.form.get("departStation")?.value===this.form.get("arrivalStation")?.value&&t.push("\u51FA\u767C\u7AD9\u8207\u5230\u9054\u7AD9\u9700\u4E0D\u540C");let e=this.getProfiles();e.length>4&&t.push("\u6700\u591A\u53EA\u80FD\u540C\u6642\u8CFC\u8CB7\u56DB\u7A2E\u8EAB\u5206\u5225"),e.length<1&&t.push("\u81F3\u5C11\u9700\u8F38\u5165\u4E00\u500B\u8EAB\u5206\u5225\u7684\u5F35\u6578");let i=Math.max(...e.map(C=>C.quantity));this.form.get("roundTrip")?.value&&i>5&&t.push("\u4E00\u822C\u8A02\u4F4D\u53BB\u56DE\u7A0B\u6700\u591A\u50C5\u80FD\u9078\u64C75\u5F35\u7968");let r=(0,ee.default)(`${this.form.get("departDate")?.value} ${this.form.get("departHour")?.value}:${this.form.get("departMinute")?.value}`),l=(0,ee.default)(`${this.form.get("returnDate")?.value} ${this.form.get("returnHour")?.value}:${this.form.get("returnMinute")?.value}`);return(l.isBefore(r)||l.isSame(r))&&t.push("\u8A02\u8CFC\u53BB\u56DE\u7A0B\uFF0C\u56DE\u7A0B\u6642\u9593\u65E9\u65BC\u53BB\u7A0B\u6642\u9593"),e.some(C=>C.code==="P")&&this.form.get("classType").value===2&&t.push("\u5B78\u751F\u7968\u4E0D\u9069\u7528\u5546\u52D9\u8ECA\u5EC2\uFF0C\u8ACB\u91CD\u65B0\u9078\u64C7"),t}getProfiles(){let t=this.profiles();return this.form.get("profiles").value.map((e,i)=>({code:t[i].code,quantity:e})).filter(e=>e.quantity)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=B({type:a,selectors:[["app-step1"]],outputs:{confirm:"confirm",promotions:"promotions"},decls:95,vars:11,consts:[[1,"py-2",3,"formGroup"],[1,"border","rounded","p-3","shadow-sm","bg-white","fs-6","m-0","w-100"],[1,"row","mb-2","align-items-center","w-100"],["for","departStation",1,"col-auto"],[1,"col"],["id","departStation","formControlName","departStation",1,"form-select","form-select-sm","fs-6"],[3,"value"],[1,"col-auto"],["href","javascript:;",3,"click"],[1,"fa-solid","fa-right-left"],["for","arrivalStation",1,"col-auto"],["id","arrivalStation","formControlName","arrivalStation",1,"form-select","form-select-sm","fs-6"],["type","checkbox","id","roundTrip","formControlName","roundTrip",1,"form-check-input","me-1","fs-6"],["for","roundTrip",1,"form-check-label"],[1,"col-auto","text-end","text-warning"],["formArrayName","profiles",1,"row","mb-2","align-items-center","w-100"],[1,"col","d-flex","align-items-center","p-0","me-3"],[1,"row","mb-2","w-100"],[3,"personalIdChange","coperateIdChange","coperateIdDisabled","personalIdDisabled","rowStyle"],[1,"w-100","border","rounded-top","bg-warning-subtle","mt-2","p-1"],[1,"border","p-3","shadow-sm","fs-6","m-0","w-100","d-flex","align-items-center"],["for","departDate",1,"text-nowrap","m-1"],[1,"w-25","d-flex","align-items-center","justify-content-start"],["type","date","id","departDate","formControlName","departDate",1,"form-control","fs-6"],[1,"d-flex","align-items-center"],["for","departHour",1,"text-nowrap","m-1"],["id","departHour","formControlName","departHour",1,"form-select","form-select-sm","fs-6","w-auto"],["for","departHour",1,"m-1"],["id","departMinute","formControlName","departMinute",1,"form-select","form-select-sm","fs-6","w-auto"],["for","departMinute",1,"m-1"],["formControlName","departSearchMethod",1,"form-select","form-select-sm","fs-6"],["value","1"],["value","2"],["for","departApointTrainNumber",1,"text-center","m-1","text-nowrap"],["type","text","id","departApointTrainNumber","formControlName","departApointTrainNumber",1,"fs-6","form-control","form-control-sm","flex-grow-1"],[1,"border","rounded","shadow-sm","mt-2","p-3","fs-6"],[1,"d-flex","flex-wrap","align-items-center","justify-content-between"],[1,"border","rounded","d-flex","align-items-center","px-2","py-1","flex-grow-1","me-2"],[1,"d-flex","align-items-center","me-3","w-50"],["for","promotionType",1,"me-2","text-nowrap"],["id","promotionType","formControlName","promotionType",1,"form-select","form-select-sm","w-100"],[1,"d-flex","align-items-center","w-50"],["for","promotionCodeList",1,"me-2","text-nowrap"],["id","promotionCodeList","formControlName","promotionCodeList",1,"form-select","form-select-sm","w-100"],["value",""],[1,"mx-2"],[1,"border","rounded","d-flex","align-items-center","px-2","py-1",2,"min-width","250px"],["for","promotionCode",1,"me-2","text-nowrap"],["type","text","id","promotionCode","formControlName","promotionCode",1,"form-control","form-control-sm"],[1,"d-flex","align-items-center","gap-2","fs-6","w-100","justify-content-center","mt-2"],["type","button",1,"btn","bg-primary","text-white","px-4",3,"click","disabled"],["type","button",1,"btn","btn-secondary","px-4",3,"click","disabled"],[1,"text-center","text-nowrap","me-1",3,"for"],["type","number","min","0",1,"fs-6","form-control","form-control-sm",3,"id","formControlName"],["type","radio",1,"form-check-input","me-1",3,"id","formControlName","value"],[1,"form-check-label",3,"for"],["for","returnDate",1,"text-nowrap","m-1"],["type","date","id","returnDate","formControlName","returnDate",1,"form-control","fs-6"],["for","returnHour",1,"text-nowrap","m-1"],["id","returnHour","formControlName","returnHour",1,"form-select","form-select-sm","fs-6","w-auto"],["for","returnHour",1,"m-1"],["id","returnMinute","formControlName","returnMinute",1,"form-select","form-select-sm","fs-6","w-auto"],["for","returnMinute",1,"m-1"],["formControlName","returnSearchMethod",1,"form-select","form-select-sm","fs-6"],["for","returnApointTrainNumber",1,"text-center","m-1","text-nowrap"],["type","text","id","returnApointTrainNumber","formControlName","returnApointTrainNumber",1,"fs-6","form-control","form-control-sm","flex-grow-1"]],template:function(e,i){if(e&1&&(o(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),s(4,"\u51FA\u767C\u7AD9"),n(),o(5,"div",4)(6,"select",5),$(7,ti,2,2,"option",6,Q),n()(),o(9,"div",7)(10,"a",8),y("click",function(){return i.swapStation()}),g(11,"i",9),n()(),o(12,"label",10),s(13,"\u5230\u9054\u7AD9"),n(),o(14,"div",4)(15,"select",11),$(16,ii,2,2,"option",6,Q),n()(),o(18,"div",7),g(19,"input",12),o(20,"label",13),s(21,"\u53BB\u56DE\u7968"),n()(),o(22,"div",14)(23,"span"),s(24,"\u7E3D\u4EBA\u6578 "),n(),o(25,"strong"),s(26),n()()(),o(27,"div",15)(28,"div",4),s(29,"\u8EAB\u5206\u5225/\u5F35\u6578"),n(),$(30,ni,4,4,"div",16,Zt),n(),o(32,"div",17)(33,"div",7),s(34,"\u8ECA\u5EC2\u7A2E\u985E"),n(),$(35,oi,4,8,"div",7,Kt),n(),o(37,"app-member-code",18),y("personalIdChange",function(l){return i.personalId.set(l)})("coperateIdChange",function(l){return i.coperateId.set(l)}),n()(),o(38,"div",19),s(39,"\u53BB\u7A0B"),n(),o(40,"div",20)(41,"label",21),s(42,"\u51FA\u767C\u65E5\u671F"),n(),o(43,"div",22),g(44,"input",23),n(),o(45,"div",24)(46,"label",25),s(47,"\u51FA\u767C\u6642\u9593"),n(),o(48,"select",26),$(49,ri,2,2,"option",6,Q),n(),o(51,"label",27),s(52,"\u6642"),n(),o(53,"select",28),$(54,ai,2,2,"option",6,Q),n(),o(56,"label",29),s(57,"\u5206"),n()(),o(58,"select",30)(59,"option",31),s(60,"\u4EE5\u51FA\u767C\u6642\u9593\u67E5\u8A62"),n(),o(61,"option",32),s(62,"\u4EE5\u5230\u9054\u6642\u9593\u67E5\u8A62"),n()(),o(63,"label",33),s(64,"\u6307\u5B9A\u8ECA\u6B21"),n(),g(65,"input",34),n(),P(66,li,28,0),o(67,"div",35)(68,"div",36)(69,"div",37)(70,"div",38)(71,"label",39),s(72,"\u5C08\u6848\u5206\u985E"),n(),o(73,"select",40),$(74,mi,2,2,"option",6,Xt),n()(),o(76,"div",41)(77,"label",42),s(78,"\u4FC3\u92B7\u4EE3\u78BC"),n(),o(79,"select",43)(80,"option",44),s(81,"\u8ACB\u9078\u64C7"),n(),$(82,ui,2,2,"option",6,ei),n()()(),o(84,"span",45),s(85,"\u6216"),n(),o(86,"div",46)(87,"label",47),s(88,"\u4FC3\u92B7\u4EE3\u78BC"),n(),g(89,"input",48),n()()(),o(90,"div",49)(91,"button",50),y("click",function(){return i.onSubmit(i.bookingType.general)}),s(92," \u4E00\u822C\u8A02\u4F4D "),n(),o(93,"button",51),y("click",function(){return i.onSubmit(i.bookingType.group)}),s(94," \u5718\u9AD4\u8A02\u4F4D "),n()()()),e&2){let r,l;c("formGroup",i.form),p(7),N(i.departStationList()),p(9),N(i.arrivalStationList()),p(10),b(i.totalPeople()),p(4),N(i.profiles()),p(5),N(i.classTypes()),p(2),c("coperateIdDisabled",!(!((r=(r=i.selectedPromotion())==null?null:r.accumulateCorporateMembers)!==null&&r!==void 0)||r))("personalIdDisabled",!(!((l=(l=i.selectedPromotion())==null?null:l.accumulateMembers)!==null&&l!==void 0)||l))("rowStyle",!0),p(12),N(i.hours()),p(5),N(i.minutes()),p(12),L(i.roundTrip()?66:-1),p(8),N(i.promotionTypeList()),p(8),N(i.filteredPromotionDataList()),p(7),V("disabled",i.promotionList()),rt("readonly",i.promotionList()?"true":null),p(2),c("disabled",i.disableGernalBook()),p(2),c("disabled",i.disableGroupBook())}},dependencies:[G,W,be,He,Ge,Re,Ft,At,je,Bt,Ce,_e,Vt,Z,ge,ye,Pt,Te],encapsulation:2})};var dt=Ct(ut());var di=(a,t)=>t.index,ci=(a,t)=>t.name;function fi(a,t){if(a&1&&(o(0,"span",5),s(1),n()),a&2){let e=x();p(),b(e.promotionText())}}function hi(a,t){if(a&1&&(o(0,"option",9),s(1),n()),a&2){let e=t.$implicit;c("value",e),p(),b(e)}}function Si(a,t){if(a&1&&(o(0,"option",9),s(1),n()),a&2){let e=t.$implicit;c("value",e),p(),b(e)}}function vi(a,t){if(a&1&&(o(0,"span",26),s(1),n()),a&2){let e=t.$implicit;xt("background-color","#"+e.colorCode),p(),X(" ",e==null?null:e.name," ")}}function Ci(a,t){if(a&1){let e=K();o(0,"tr",21),y("click",function(){let r=k(e).$implicit,l=x();return I(l.index.set(r.index))}),o(1,"td")(2,"input",22),y("change",function(){let r=k(e).$implicit,l=x();return I(l.index.set(r.index))}),n()(),o(3,"td"),s(4),n(),o(5,"td"),s(6),n(),o(7,"td"),s(8),n(),o(9,"td"),s(10),n(),o(11,"td"),s(12),n(),o(13,"td"),s(14),n(),o(15,"td",23)(16,"div",24),$(17,vi,2,3,"span",25,ci),n()()()}if(a&2){let e=t.$implicit,i=x();p(2),c("name",i.prefix()+"shift-index")("value",e.index)("checked",i.index()===e.index),p(2),b(e.trainNumber),p(2),b(e.departTime),p(2),b(e.arrivalTime),p(2),b(e.elapseTime),p(2),b(e.aVLSeatCount),p(2),b(e.trainDiscount),p(3),N(e.projects)}}var Ue=class a{search=H();query=R(null);records=R([]);outbound=R(!0);promotion=R(null);index=Me(0);hours=D(Array.from({length:24},(t,e)=>e.toString().padStart(2,"0")));minutes=D(Array.from({length:60},(t,e)=>e.toString().padStart(2,"0")));prefix=_(()=>this.outbound()?"outbound":"inbound");queryObj=_(()=>this.query()||{});fromStation=_(()=>this.queryObj()[this.outbound()?"departStation":"arrivalStation"]);toStation=_(()=>this.queryObj()[this.outbound()?"arrivalStation":"departStation"]);date=_(()=>new Date(this.queryObj()[this.outbound()?"departDate":"returnDate"]||0));time=_(()=>(this.queryObj()[this.outbound()?"departTime":"returnTime"]||"").split(":"));searchMethod=_(()=>this.queryObj()[this.outbound()?"departSearchMethod":"returnSearchMethod"]||1);hour=_(()=>this.time()[0]);minute=_(()=>this.time()[1]);promotionText=_(()=>{let t=this.promotion();if(!t)return"";let e=parseFloat(t.projectDiscount)>0?`\u6298\u6263\u7387${t.projectDiscount}%`:`\u6298\u50F9${t.projectDiscount}`;return`${t.code} - ${t.projectName} ${e}`});form;formBuilder=w(xe);constructor(){this.form=this.formBuilder.group({hour:[this.hour()],minute:[this.minute()],searchMethod:[this.searchMethod()]})}ngOnChanges(t){if(t.query&&this.form.patchValue({hour:this.hour(),minute:this.minute(),searchMethod:this.searchMethod()}),t.records){let e=this.records();e.length&&setTimeout(()=>{this.index.set(e[0].index)},0)}}onSubmit(){this.search.emit(this.form.value)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=B({type:a,selectors:[["app-timetable"]],inputs:{query:[1,"query"],records:[1,"records"],outbound:[1,"outbound"],promotion:[1,"promotion"],index:[1,"index"]},outputs:{search:"search",index:"indexChange"},features:[bt],decls:56,vars:17,consts:[[1,"d-flex","flex-column","h-100"],[1,"d-flex","align-items-center","mb-1","fw-bold","p-2"],[1,"me-1","text-danger"],[1,"me-1"],[1,"me-2"],[1,"fw-bold","text-danger","me-1"],[1,"d-flex","align-items-center","flex-wrap","gap-2","ms-auto",3,"ngSubmit","formGroup"],[3,"for"],["formControlName","hour",1,"form-select","form-select-sm","w-auto",3,"id"],[3,"value"],["formControlName","minute",1,"form-select","form-select-sm","w-auto",3,"id"],["formControlName","searchMethod",1,"form-select","form-select-sm","w-auto","me-1","fw-bold",3,"id"],["value","1"],["value","2"],[1,"btn","btn-sm","btn-primary","fw-bold"],[1,"flex-1","overflow-auto"],[1,"table","table-sm","table-striped","table-hover","table-bordered","table-sticky-header","text-center","align-middle","m-0"],[1,"table-warning","backdrop-blur"],[1,"text-nowrap"],[1,"text-nowrap","w-25"],["role","button"],["role","button",3,"click"],["type","radio",1,"form-check-input","me-1",3,"change","name","value","checked"],[1,"w-25"],[1,"d-flex","flex-wrap","justify-content-start","w-100"],[1,"badge","me-1","mb-1",3,"backgroundColor"],[1,"badge","me-1","mb-1"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"span",2),s(3),n(),o(4,"span",3),s(5),n(),o(6,"span",3),s(7,"\u2192"),n(),o(8,"span",4),s(9),n(),o(10,"span",4),s(11),wt(12,"date"),n(),P(13,fi,2,1,"span",5),o(14,"form",6),y("ngSubmit",function(){return i.onSubmit()}),o(15,"label",7),s(16,"\u6642\u9593:"),n(),o(17,"select",8),$(18,hi,2,2,"option",9,Q),n(),o(20,"label",7),s(21,"\u6642"),n(),o(22,"select",10),$(23,Si,2,2,"option",9,Q),n(),o(25,"label",7),s(26,"\u5206"),n(),o(27,"select",11)(28,"option",12),s(29,"\u4EE5\u51FA\u767C\u6642\u9593\u67E5\u8A62"),n(),o(30,"option",13),s(31,"\u4EE5\u5230\u9054\u6642\u9593\u67E5\u8A62"),n()(),o(32,"button",14),s(33,"\u67E5\u8A62"),n()()(),o(34,"div",15)(35,"table",16)(36,"thead",17)(37,"tr"),g(38,"th"),o(39,"th",18),s(40,"\u8ECA\u6B21"),n(),o(41,"th",18),s(42,"\u51FA\u767C\u6642\u9593"),n(),o(43,"th",18),s(44,"\u5230\u9054\u6642\u9593"),n(),o(45,"th",18),s(46,"\u884C\u8ECA\u6642\u9593"),n(),o(47,"th",18),s(48,"\u53EF\u552E\u5EA7\u4F4D\u6578"),n(),o(49,"th",18),s(50,"\u512A\u60E0*"),n(),o(51,"th",19),s(52,"\u5C08\u6848*"),n()()(),o(53,"tbody"),$(54,Ci,19,9,"tr",20,di),n()()()()),e&2&&(p(3),b(i.outbound()?"\u53BB\u7A0B\u5217\u8ECA":"\u56DE\u7A0B\u5217\u8ECA"),p(2),b(i.fromStation()),p(4),b(i.toStation()),p(2),b(Dt(12,12,i.date(),"MM/dd (EEEEE)","","zh")),p(2),L(i.promotion()?13:-1),p(),c("formGroup",i.form),p(),c("for",i.prefix()+"hour"),p(2),c("id",i.prefix()+"hour"),p(),N(i.hours()),p(2),c("for",i.prefix()+"hour"),p(2),c("id",i.prefix()+"minute"),p(),N(i.minutes()),p(2),c("for",i.prefix()+"minute"),p(2),c("id",i.prefix()+"searchMethod"),p(27),N(i.records()))},dependencies:[G,It,W,be,He,Ge,je,Ce,_e,Z,ge,ye],encapsulation:2})};function _i(a,t){if(a&1){let e=K();o(0,"div",4)(1,"app-timetable",8),Ne("indexChange",function(r){k(e);let l=x(2);return ve(l.inboundIndex,r)||(l.inboundIndex=r),I(r)}),y("search",function(r){k(e);let l=x(2);return I(l.onInboundSearch(r))}),n()()}if(a&2){let e=x(2);p(),c("records",e.inbound())("promotion",e.promotion())("query",e.query()),$e("index",e.inboundIndex),c("outbound",!1)}}function bi(a,t){if(a&1){let e=K();o(0,"div",1)(1,"div",2)(2,"app-timetable",3),Ne("indexChange",function(r){k(e);let l=x();return ve(l.outboundIndex,r)||(l.outboundIndex=r),I(r)}),y("search",function(r){k(e);let l=x();return I(l.onOutboundSearch(r))}),n()(),P(3,_i,2,5,"div",4),o(4,"div",5)(5,"button",6),y("click",function(){k(e);let r=x();return I(r.onConfirm())}),s(6,"\u958B\u59CB\u8A02\u4F4D"),n(),o(7,"button",6),y("click",function(){k(e);let r=x();return I(r.onShowAll())}),s(8),n(),o(9,"button",7),y("click",function(){k(e);let r=x();return I(r.back.emit())}),s(10,"\u91CD\u8A2D\u67E5\u8A62\u689D\u4EF6"),n()()()}if(a&2){let e=x();V("h-100",e.roundTrip()),p(),V("flex-1",e.roundTrip()),p(),c("records",e.outbound())("promotion",e.promotion())("query",e.query()),$e("index",e.outboundIndex),p(),L(e.roundTrip()?3:-1),p(5),X(" ",e.showAll()?"\u50C5\u986F\u793A\u53EF\u552E\u8ECA\u6B21":"\u986F\u793A\u6700\u8FD1\u6240\u6709\u8ECA\u6B21"," ")}}var ze=class a{confirm=H();back=H();query=Me(null);data=Me(null);inbound=_(()=>this.data()?.inbound||[]);outbound=_(()=>this.data()?.outbound||[]);promotion=_(()=>this.data()?.promotion||null);showAll=_(()=>this.query()?.allTrain===1);roundTrip=_(()=>!!this.data()?.inbound);outboundIndex=0;inboundIndex=0;loadingService=w(re);destroyRef=w(oe);messageService=w(se);apiService=w(ae);onOutboundSearch(t){this.query.update(e=>(e.departTime=`${t.hour}:${t.minute}`,e.departSearchMethod=t.searchMethod,Se({},e))),this.updateQuery()}onInboundSearch(t){this.query.update(e=>(e.returnTime=`${t.hour}:${t.minute}`,e.returnSearchMethod=t.searchMethod,Se({},e))),this.updateQuery()}onShowAll(){this.query.update(t=>(t.allTrain=t.allTrain===0?1:0,Se({},t))),this.updateQuery()}onConfirm(){this.loadingService.loading||(this.loadingService.start(),this.apiService.chooseTrain(this.outboundIndex.toString(),(this.inboundIndex||"").toString()).pipe(z(this.destroyRef)).subscribe({next:t=>{this.loadingService.stop(),this.confirm.emit(t.data.trip)},error:t=>{this.loadingService.stop(),this.messageService.handleError(t)},complete:()=>{this.loadingService.stop()}}))}validate(){let t=[],e=this.outbound().find(r=>r.index===this.outboundIndex),i=this.inbound().find(r=>r.index===this.inboundIndex);if(this.roundTrip()&&e.departDate===i.departDate){let r=(0,dt.default)(`${e.arrivalDate} ${e.arrivalTime}`,"YYYY/MM/DD HH:mm"),l=(0,dt.default)(`${i.departDate} ${i.departTime}`,"YYYY/MM/DD HH:mm");if(l.isBefore(r)||l.isSame(r)){let{departDate:C}=this.query(),O=C.split("/")[0];t.push(`\u56DE\u7A0B\u51FA\u767C\u6642\u9593\u5FC5\u9808\u665A\u65BC\u53BB\u7A0B\u5230\u9054\u6642\u9593\u3002\u53BB\u7A0B\u51FA\u767C(\u5230\u9054)\u6642\u9593${O}/${r.format("MM/DD HH:mm")} - \u56DE\u7A0B\u51FA\u767C\u6642\u9593${O}/${l.format("MM/DD HH:mm")}`)}}return t}updateQuery(){this.loadingService.loading||(this.loadingService.start(),this.apiService.queryTrain(this.query()).pipe(z(this.destroyRef)).subscribe({next:t=>{this.loadingService.stop(),this.data.set(t.data)},error:t=>{this.loadingService.stop(),this.messageService.handleError(t)},complete:()=>{this.loadingService.stop()}}))}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=B({type:a,selectors:[["app-step2"]],inputs:{query:[1,"query"],data:[1,"data"]},outputs:{confirm:"confirm",back:"back",query:"queryChange",data:"dataChange"},decls:1,vars:1,consts:[[1,"d-flex","flex-column","py-2",3,"h-100"],[1,"d-flex","flex-column","py-2"],[1,"border","rounded","shadow-sm","p-0","overflow-hidden"],[3,"indexChange","search","records","promotion","query","index"],[1,"flex-1","border","rounded","shadow-sm","p-0","overflow-hidden","mt-2"],[1,"d-flex","gap-3","justify-content-center","mt-2"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-dark",3,"click"],[3,"indexChange","search","records","promotion","query","index","outbound"]],template:function(e,i){e&1&&P(0,bi,11,10,"div",0),e&2&&L(i.data()?0:-1)},dependencies:[W,G,Ue],encapsulation:2})};var le=class a{readonly=R(!1);groupInfo=R(null);form;constructor(t){this.form=t.group({groupName:[this.groupInfo()?.groupName??""],personId:[this.groupInfo()?.personId??""],firstName:[this.groupInfo()?.firstName??""],lastName:[this.groupInfo()?.lastName??""],phoneNumber:[this.groupInfo()?.phoneNumber??""]}),kt(()=>{this.groupInfo()&&this.form.patchValue(this.groupInfo())})}getValues(){return this.form.value}static \u0275fac=function(e){return new(e||a)(gt(xe))};static \u0275cmp=B({type:a,selectors:[["app-group-leader"]],inputs:{readonly:[1,"readonly"],groupInfo:[1,"groupInfo"]},decls:18,vars:16,consts:[[1,"w-100","d-flex","align-items-center",3,"formGroup"],["for","groupName",1,"text-nowrap","m-1"],[1,"m-1"],["id","groupName","formControlName","groupName",1,"form-control","form-control-sm","fs-6",3,"readonly"],["for","personId",1,"text-nowrap","m-1"],["id","personId","formControlName","personId",1,"form-control","form-control-sm","fs-6",3,"readonly"],["for","firstName",1,"text-nowrap","m-1"],[1,"m-1","d-flex"],["id","firstName","placeholder","\u59D3","formControlName","firstName",1,"form-control","form-control-sm","fs-6",3,"readonly"],["id","lastName","placeholder","\u540D","formControlName","lastName",1,"form-control","form-control-sm","fs-6","ms-1",3,"readonly"],["for","phoneNumber",1,"text-nowrap","m-1"],["id","phoneNumber","formControlName","phoneNumber",1,"form-control","form-control-sm","fs-6",3,"readonly"]],template:function(e,i){e&1&&(o(0,"form",0)(1,"label",1),s(2,"\u5718\u9AD4\u540D\u7A31"),n(),o(3,"div",2),g(4,"input",3),n(),o(5,"label",4),s(6,"\u8EAB\u5206\u8B49\u865F/\u5718\u9AD4\u7D71\u7DE8"),n(),o(7,"div",2),g(8,"input",5),n(),o(9,"label",6),s(10,"\u4EE3\u8868\u4EBA\u59D3\u540D"),n(),o(11,"div",7),g(12,"input",8)(13,"input",9),n(),o(14,"label",10),s(15,"\u9023\u7D61\u96FB\u8A71"),n(),o(16,"div",2),g(17,"input",11),n()()),e&2&&(c("formGroup",i.form),p(4),V("disabled",i.readonly()),c("readonly",i.readonly()),p(4),V("disabled",i.readonly()),c("readonly",i.readonly()),p(4),V("disabled",i.readonly()),c("readonly",i.readonly()),p(),V("disabled",i.readonly()),c("readonly",i.readonly()),p(4),V("disabled",i.readonly()),c("readonly",i.readonly()))},dependencies:[Z,be,Re,Ce,_e,ge,ye],encapsulation:2})};var gi=(a,t)=>t.profile;function yi(a,t){if(a&1&&(o(0,"div",4),s(1),n()),a&2){let e=t.$implicit;p(),Et("(",e.promotionName,"V ",e.profile," ",e.count,"\u5F35)")}}function xi(a,t){if(a&1&&(o(0,"div",1)(1,"div",2),s(2),n(),o(3,"div",3),$(4,yi,2,3,"div",4,gi),n()()),a&2){let e=t;p(2),b(e.code),p(2),N(e.tickets)}}var we=class a{promotionTickets=R(null);static \u0275fac=function(e){return new(e||a)};static \u0275cmp=B({type:a,selectors:[["app-promotion-tickets"]],inputs:{promotionTickets:[1,"promotionTickets"]},decls:4,vars:1,consts:[[1,"d-flex"],[1,"d-flex","flex-1","ms-5"],[1,"me-2"],[1,"text-danger"],[1,"float-start","me-1"]],template:function(e,i){if(e&1&&(o(0,"div",0)(1,"div"),s(2,"\u4FC3\u92B7\u4EE3\u78BC"),n(),P(3,xi,6,1,"div",1),n()),e&2){let r;p(3),L((r=i.promotionTickets())?3:-1,r)}},encapsulation:2})};function Ti(a,t){a&1&&g(0,"app-group-leader")}function Ei(a,t){if(a&1){let e=K();o(0,"div",1)(1,"app-bound",2),y("seatChange",function(r){k(e);let l=x();return I(l.onSeatChange(r))}),n(),o(2,"app-member-code",3),Ne("personalIdChange",function(r){let l=k(e);return ve(l.membership.personalId,r)||(l.membership.personalId=r),I(r)})("coperateIdChange",function(r){let l=k(e);return ve(l.membership.coperateId,r)||(l.membership.coperateId=r),I(r)}),n(),P(3,Ti,1,0,"app-group-leader"),o(4,"div",4)(5,"app-passengers",5,0),y("needToCheckChange",function(r){k(e);let l=x();return I(l.needToCheck.set(r))}),n()(),o(7,"div",6),g(8,"app-promotion-tickets",7),o(9,"div",8),g(10,"input",9),o(11,"label",10),s(12,"\u4FDD\u7559\u7968\u6839\u4F5C\u70BA\u4F9D\u64DA"),n()()(),o(13,"div",11)(14,"button",12),y("click",function(){k(e);let r=x();return I(r.onSubmit())}),s(15,"\u78BA\u8A8D"),n(),o(16,"button",13),y("click",function(){k(e);let r=x();return I(r.onCheck())}),s(17," \u8CC7\u683C\u6AA2\u6838 "),n(),o(18,"button",14),y("click",function(){k(e);let r=x();return I(r.back.emit())}),s(19,"\u91CD\u65B0\u9078\u64C7\u8ECA\u6B21"),n()()()}if(a&2){let e,i,r=t,l=x(),C=qe(0);p(),c("roundTrip",C.roundTrip())("outbound",C.outbound())("inbound",C.inbound())("passengers",r.passengers)("isShort",!1)("hasCheckbox",!1),p(),$e("personalId",r.membership.personalId)("coperateId",r.membership.coperateId),c("coperateIdDisabled",!(!((e=(e=C.selectedPromotion())==null?null:e.accumulateCorporateMembers)!==null&&e!==void 0)||e))("personalIdDisabled",!(!((i=(i=C.selectedPromotion())==null?null:i.accumulateMembers)!==null&&i!==void 0)||i))("rowStyle",!0),p(),L(r!=null&&r.isGroup?3:-1),p(2),c("roundTrip",C.roundTrip())("passengers",r.passengers)("promotion",C.selectedPromotion())("isSelect",!1)("showRowCheckbox",!1)("showRowMarker",!1),p(3),c("promotionTickets",C.promotionTickets()),p(6),c("disabled",!C.seatTaken()),p(2),c("disabled",!l.needToCheck())}}var Je=class a{confirm=H();back=H();order=R();needToCheck=D(!1);loadingService=w(re);apiService=w(ae);messageService=w(se);destroyRef=w(oe);passengersComponent=ot(Ee);groupLeaderComponent=ot(le);onCheck(){if(this.loadingService.loading)return;this.loadingService.start();let t=this.passengersComponent().getValues(),e=new Set(t.filter(r=>r.profile==="\u611B\u5FC3"&&r.personalId).map(r=>r.personalId)),i={passengers:Array.of(e).map(r=>({personalId:r,profileType:3}))};this.apiService.querySpecialPassenger(i).pipe(z(this.destroyRef)).subscribe({next:r=>{this.loadingService.stop(),this.passengersComponent().setPassengers(r.passengers)},error:r=>{this.loadingService.stop(),this.messageService.handleError(r)},complete:()=>{this.loadingService.stop()}})}onSeatChange(t){this.order().trip.set(t)}onSubmit(){if(this.loadingService.loading)return;this.loadingService.start();let t=this.passengersComponent().getValues(),e=this.groupLeaderComponent()?.getValues(),i=this.order().trip(),r={groupInfo:e,membership:i.membership,passengerInfo:t};this.apiService.generalBooking(r).pipe(z(this.destroyRef)).subscribe({next:l=>{this.loadingService.stop(),this.confirm.emit(l.data.trip)},error:l=>{this.loadingService.stop(),this.messageService.handleError(l)},complete:()=>{this.loadingService.stop()}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=B({type:a,selectors:[["app-step3"]],viewQuery:function(e,i){e&1&&(st(i.passengersComponent,Ee,5),st(i.groupLeaderComponent,le,5)),e&2&&Tt(2)},inputs:{order:[1,"order"]},outputs:{confirm:"confirm",back:"back"},decls:2,vars:2,consts:[["passengers",""],[1,"d-flex","flex-column","h-100","py-2"],[3,"seatChange","roundTrip","outbound","inbound","passengers","isShort","hasCheckbox"],[1,"mt-2",3,"personalIdChange","coperateIdChange","personalId","coperateId","coperateIdDisabled","personalIdDisabled","rowStyle"],[1,"mt-2","overflow-auto"],[3,"needToCheckChange","roundTrip","passengers","promotion","isSelect","showRowCheckbox","showRowMarker"],[1,"d-flex","gap-3","justify-content-start","mt-2"],[1,"w-50",3,"promotionTickets"],[1,"ms-auto"],["type","checkbox","id","retain",1,"form-check-input","me-1","fs-6"],["for","retain"],[1,"d-flex","gap-3","justify-content-center","mt-2"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["type","button",1,"btn","btn-dark","ms-auto",3,"click","disabled"],["type","button",1,"btn","btn-dark",3,"click"]],template:function(e,i){if(e&1&&(Le(0),P(1,Ei,20,21,"div",1)),e&2){let r,l=Oe(i.order());p(),L((r=l.trip())?1:-1,r)}},dependencies:[W,G,Ye,Z,Ee,Te,le,we],encapsulation:2})};function wi(a,t){if(a&1&&g(0,"app-group-leader",6),a&2){let e=x();c("groupInfo",e.groupInfo)("readonly",!0)}}function Di(a,t){if(a&1&&(o(0,"span"),s(1),n()),a&2){let e=t.$implicit;p(),b(e)}}function ki(a,t){if(a&1){let e=K();o(0,"div",0)(1,"div",1)(2,"div")(3,"span",2),s(4,"\u8A02\u4F4D\u4EE3\u865F"),n(),o(5,"span"),s(6),n()(),o(7,"div",3)(8,"span",2),s(9,"\u4ED8\u6B3E\u671F\u9650"),n(),o(10,"span"),s(11,"\u7ACB\u5373\u4ED8\u6B3E"),n()()(),g(12,"app-bound",4)(13,"app-member-code",5),P(14,wi,1,2,"app-group-leader",6),o(15,"div",7),g(16,"app-passengers",8),n(),o(17,"div",9)(18,"div",10)(19,"div",11),s(20,"\u7E3D\u4EBA\u6578"),n(),o(21,"div",12),s(22),$(23,Di,2,1,"span",null,Q),s(25," ) "),n()(),o(26,"div",10)(27,"div",11),s(28,"\u7E3D\u7968\u50F9"),n(),o(29,"div",3),s(30),n()()(),g(31,"app-promotion-tickets",13),o(32,"div",14)(33,"button",15),y("click",function(){k(e);let r=x();return I(r.onSubmit())}),s(34,"\u4ED8\u6B3E\u53D6\u7968"),n(),o(35,"button",16),y("click",function(){k(e);let r=x();return I(r.onCancel())}),s(36,"\u53D6\u6D88"),n()()()}if(a&2){let e=t;x();let i=qe(0);p(6),b(e.pnrId),p(6),c("roundTrip",i.roundTrip())("outbound",i.outbound())("inbound",i.inbound())("seatSelectable",!1)("isShort",!1)("hasCheckbox",!1),p(),c("personalId",e.membership.personalId)("coperateId",e.membership.coperateId)("readonly",!0)("rowStyle",!0),p(),L(e!=null&&e.isGroup?14:-1),p(2),c("roundTrip",i.roundTrip())("passengers",e.passengers)("readonly",!0)("isSelect",!1)("showRowCheckbox",!1)("showRowMarker",!1),p(6),X(" ",i.totalPeople(),"\u4EBA ( "),p(),N(i.passengerProfiles()),p(7),b(i.totalFare()),p(),c("promotionTickets",i.promotionTickets())}}var Ze=class a{confirm=H();cancel=H();order=R();onSubmit(){this.confirm.emit()}onCancel(){return Ve(this,null,function*(){this.cancel.emit()})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=B({type:a,selectors:[["app-step4"]],inputs:{order:[1,"order"]},outputs:{confirm:"confirm",cancel:"cancel"},decls:2,vars:2,consts:[[1,"d-flex","flex-column","h-100","py-2"],[1,"d-flex","mb-2"],[1,"me-3"],[1,"ms-auto"],[3,"roundTrip","outbound","inbound","seatSelectable","isShort","hasCheckbox"],[1,"mt-2",3,"personalId","coperateId","readonly","rowStyle"],[3,"groupInfo","readonly"],[1,"mt-2","overflow-auto"],[3,"roundTrip","passengers","readonly","isSelect","showRowCheckbox","showRowMarker"],[1,"bg-warning-subtle","mt-2","p-2","w-50"],[1,"d-flex"],[1,"me-5"],[1,"d-flex","gap-2"],[1,"w-50",3,"promotionTickets"],[1,"d-flex","gap-3","justify-content-center","mt-2"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-dark",3,"click"]],template:function(e,i){if(e&1&&(Le(0),P(1,ki,37,21,"div",0)),e&2){let r,l=Oe(i.order());p(),L((r=l.trip())?1:-1,r)}},dependencies:[G,W,Z,Ye,Ee,Te,le,we],encapsulation:2})};function Ii(a,t){if(a&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"strong"),s(5,"\u8A02\u4F4D\u4EE3\u865F\uFF1A"),n(),s(6),n()(),o(7,"div",2)(8,"div")(9,"strong"),s(10,"\u4ED8\u6B3E\u671F\u9650\uFF1A"),n()()()(),o(11,"div",1)(12,"div",2)(13,"div")(14,"strong"),s(15,"\u8A02\u4F4D\u901A\u8DEF\uFF1A"),n(),s(16),n()(),o(17,"div",2)(18,"div")(19,"strong"),s(20,"\u4ED8\u6B3E\u65B9\u5F0F\uFF1A"),n(),s(21," \u5C1A\u672A\u4ED8\u6B3E"),n()()()()),a&2){let e=t;p(6),X(" ",e.pnrId,""),p(10),X(" ",e.bookChanel,"")}}var Ke=class a{data=R(null);static \u0275fac=function(e){return new(e||a)};static \u0275cmp=B({type:a,selectors:[["app-step4-cancel"]],inputs:{data:[1,"data"]},decls:1,vars:1,consts:[[1,"container","py-3"],[1,"row","mb-2"],[1,"col-6"]],template:function(e,i){if(e&1&&P(0,Ii,22,2,"div",0),e&2){let r;L((r=i.data())?0:-1,r)}},encapsulation:2})};var Xe=class a{step=D(1);step1Query=D(null);step1Data=D(null);step4CancelData=D(null);order=new Qe;mmiService=w(Nt);messageService=w(se);loadingService=w(re);apiService=w(ae);destroyRef=w(oe);router=w(Mt);constructor(){this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21"])}onStep1Confirm(t){this.step1Query.set(t.query),this.step1Data.set(t.data),this.step.set(2),this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21"])}onStep2Back(){this.step.set(1),this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21"])}onStep2Confirm(t){this.order.trip.set(t),this.step.set(3),this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21","\u9078\u64C7\u5EA7\u4F4D/\u586B\u5BEB\u4E58\u5BA2\u8CC7\u6599"])}onStep3Confirm(t){this.order.trip.set(t),this.step.set(4),this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21","\u9078\u64C7\u5EA7\u4F4D/\u586B\u5BEB\u4E58\u5BA2\u8CC7\u6599","\u8A02\u4F4D\u5B8C\u6210"])}onStep3Back(){this.step.set(2),this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21"])}onStep4Confirm(){this.step.set(5),this.router.navigate(["/mmi/main/payment"])}onStep4Cancel(){this.cancelBooking()}canDeactiveGuard(){return this.step()===4?(this.cancelBooking(),!1):!0}cancelBooking(){return Ve(this,null,function*(){return(yield this.messageService.show({title:"\u53D6\u6D88\u8A02\u7968",message:"\u78BA\u5B9A\u53D6\u6D88\u8A02\u7968\u7D00\u9304\uFF1F",confirmation:!0,cancelText:"\u5426",confirmText:"\u662F"}).result)?(this.apiService.cancelBooking().pipe(z(this.destroyRef)).subscribe({next:e=>{this.loadingService.stop(),this.step4CancelData.set(e.data),this.messageService.setErrors(["\u53D6\u6D88\u8A02\u4F4D\u6210\u529F\uFF01"]),this.step.set(42)},error:e=>{this.loadingService.stop(),this.messageService.handleError(e)},complete:()=>{this.loadingService.stop()}}),!0):!1})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=B({type:a,selectors:[["app-new"]],decls:6,vars:15,consts:[[3,"confirm","promotions"],[3,"confirm","back","query","data"],[3,"confirm","back","order"],[3,"confirm","cancel","order"],[3,"data"]],template:function(e,i){e&1&&(g(0,"app-errors"),o(1,"app-step1",0),y("confirm",function(l){return i.onStep1Confirm(l)})("promotions",function(l){return i.order.promotions.set(l)}),n(),o(2,"app-step2",1),y("confirm",function(l){return i.onStep2Confirm(l)})("back",function(){return i.onStep2Back()}),n(),o(3,"app-step3",2),y("confirm",function(l){return i.onStep3Confirm(l)})("back",function(){return i.onStep3Back()}),n(),o(4,"app-step4",3),y("confirm",function(){return i.onStep4Confirm()})("cancel",function(){return i.onStep4Cancel()}),n(),g(5,"app-step4-cancel",4)),e&2&&(p(),V("d-none",i.step()!==1),p(),V("d-none",i.step()!==2),c("query",i.step1Query())("data",i.step1Data()),p(),V("d-none",i.step()!==3),c("order",i.order),p(),V("d-none",i.step()!==4),c("order",i.order),p(),V("d-none",i.step()!==42),c("data",i.step4CancelData()))},dependencies:[G,W,We,ze,Je,Ze,Ke,Lt],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})};var Mi=[{path:"",component:Xe,canDeactivate:[Ot]}],Ht=class a{static \u0275fac=function(e){return new(e||a)};static \u0275mod=yt({type:a});static \u0275inj=_t({imports:[G,$t.forChild(Mi)]})};export{Ht as NewModule};
