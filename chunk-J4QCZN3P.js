import{A as O,B as D,a as xe,b as H,c as $,d as q,e as Ce,g as J,h as ge,j as be,k as ve,l as Se,m as he,n as ye,o as Ee,p as K,q as Q,s as Ie,t as N,u as X,v as A,x as we,y as Te,z as V}from"./chunk-5JAWHIKF.js";import{$ as M,Aa as E,Ba as o,Bb as F,Ca as n,Da as f,Ea as T,Fa as v,Ga as m,L as x,Q as Y,R as S,Ra as l,S as h,Sa as u,Ta as g,Ua as U,V as k,Y as pe,Ya as ie,Z as C,Za as oe,_ as ue,_a as ae,a as de,b as me,ba as s,cb as z,db as re,e as ce,eb as le,fb as se,ga as G,ha as I,ka as _e,ma as p,nb as B,ob as fe,ra as _,sb as W,ta as P,wa as c,ya as w,za as y}from"./chunk-H5KATAC4.js";function Be(t,a){if(t&1&&(o(0,"div",1),f(1,"i",2),l(2),n()),t&2){let e=a.$implicit;s(2),g(" ",e,"")}}function $e(t,a){if(t&1&&(o(0,"div",0),y(1,Be,3,1,"div",1,w),n()),t&2){let e=m();s(),E(e.errors())}}var De=class t{errors=M([]);messageService=x(D);elementRef=x(ue);constructor(){this.messageService.errorComponent=this}focus(){setTimeout(()=>{this.elementRef.nativeElement.scrollIntoView()})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-errors"]],decls:1,vars:1,consts:[[1,"d-flex","flex-column","gap-2","pt-2"],[1,"alert","alert-danger","mb-0","p-2"],[1,"fas","fa-exclamation-circle"]],template:function(e,i){e&1&&p(0,$e,3,0,"div",0),e&2&&c(i.errors().length>0?0:-1)},encapsulation:2})};var ke=(t,a)=>({"d-flex flex-column justify-content-start":t,"d-flex align-items-center":a}),Ve=(t,a)=>({"d-flex flex-column justify-content-start mt-4 pt-2":t,"d-flex align-items-center":a}),Me=class t{readonly=C(!1);personalIdDisabled=C(!1);coperateIdDisabled=C(!1);personalId=G("");coperateId=G("");showing=M(!1);rowStyle=C(!1);enabledPidCheck=B(()=>this.personalId()||this.coperateId());loadingService=x(V);messageService=x(D);destroyRef=x(k);apiService=x(O);constructor(){fe(()=>{if(this.coperateIdDisabled()&&this.coperateId()&&(this.coperateId.set(""),this.hidePid()),this.personalIdDisabled()){let a=this.coperateIdDisabled()?"0":"";this.personalId()!==a&&(this.personalId.set(a),this.hidePid())}})}onPidCheck(){this.showing()?this.hidePid():this.check()}hidePid(){this.showing()&&this.showing.set(!1)}check(){if(this.loadingService.loading)return;this.loadingService.start();let a={membership:{personalId:this.personalId(),coperateId:this.coperateId()}};this.apiService.queryMembership(a).pipe(A(this.destroyRef)).subscribe({next:e=>{this.loadingService.stop();let i="",r="";this.coperateId()?(i="\u4F01\u696D\u6703\u54E1",r=e.corporateMember.companyName):(i=`\u500B\u4EBA\u6703\u54E1-${e.individualMember.membeLevel}`,r=`${e.individualMember.memberName} ${e.individualMember.memberGender}`),this.messageService.show({title:i,message:r}),this.showing.set(!0)},error:e=>{this.loadingService.stop(),this.messageService.handleError(e)},complete:()=>{this.loadingService.stop()}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-member-code"]],inputs:{readonly:[1,"readonly"],personalIdDisabled:[1,"personalIdDisabled"],coperateIdDisabled:[1,"coperateIdDisabled"],personalId:[1,"personalId"],coperateId:[1,"coperateId"],rowStyle:[1,"rowStyle"]},outputs:{personalId:"personalIdChange",coperateId:"coperateIdChange"},decls:15,vars:18,consts:[[1,"w-100","d-flex","align-items-center"],[3,"ngClass"],["for","coperateId",1,"text-nowrap","m-1"],[1,"m-1"],["id","coperateId",1,"form-control","form-control-sm","fs-6",3,"ngModelChange","ngModel","disabled"],["for","personalId",1,"text-nowrap","m-1"],["id","personalId",1,"form-control","form-control-sm","fs-6",3,"ngModelChange","ngModel","disabled"],[1,"mb-1","me-1"],["type","button",1,"btn","btn-secondary","btn-sm","fs-6",3,"click","disabled"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"label",2),l(3,"\u4F01\u696D\u6703\u54E1\u7DE8\u865F"),n(),o(4,"div",3)(5,"input",4),v("ngModelChange",function(d){return i.coperateId.set(d)}),n()()(),o(6,"div",1)(7,"label",5),l(8,"\u500B\u4EBA\u6703\u54E1\u7DE8\u865F"),n(),o(9,"div",3)(10,"input",6),v("ngModelChange",function(d){return i.personalId.set(d)}),n()()(),o(11,"div",1)(12,"div",7)(13,"button",8),v("click",function(){return i.onPidCheck()}),l(14),n()()()()),e&2&&(s(),_("ngClass",z(9,ke,!i.rowStyle(),i.rowStyle())),s(4),_("ngModel",i.coperateId())("disabled",i.readonly()||i.coperateIdDisabled()||!!i.personalId()),s(),_("ngClass",z(12,ke,!i.rowStyle(),i.rowStyle())),s(4),_("ngModel",i.personalId())("disabled",i.readonly()||i.personalIdDisabled()||!!i.coperateId()),s(),_("ngClass",z(15,Ve,!i.rowStyle(),i.rowStyle())),s(2),_("disabled",!i.enabledPidCheck()),s(),g(" ",i.showing()?"\u986F\u793A\u4E2D":"PID\u6703\u54E1\u8CC7\u6599\u6AA2\u6838/\u986F\u793A"," "))},dependencies:[F,W,N,H,q,J],encapsulation:2})};var ee=class t{transform([a,e,i,r]){return i.find(d=>d.carNumber===parseInt(r,10)&&d.col===e&&d.row===parseInt(a,10))}static \u0275fac=function(e){return new(e||t)};static \u0275pipe=_e({name:"seatPassenger",type:t,pure:!0})};var Fe=(t,a,e,i)=>[t,a,e,i],Oe=(t,a)=>a.passengerIndex;function je(t,a){if(t&1&&(o(0,"div",34),l(1),n()),t&2){let e=a.$implicit;s(),g(" ",e," ")}}function Ge(t,a){if(t&1){let e=T();ie(0),le(1,"seatPassenger"),o(2,"a",39),v("click",function(){let r=S(e),d=r.$implicit,b=r.$index,R=ae(0),j=m().$implicit,ne=m(3);return h(ne.selectSeat(j[0],d,j[b+1],R))}),f(3,"i",16)(4,"i",25),l(5),n()}if(t&2){let e=a.$implicit,i=a.$index,r=m().$implicit,d=m(3),b=oe(se(1,4,re(7,Fe,r[0],e,d.passengers(),d.carNumber())));s(2),P("selected",b),_("ngClass",d.seatStatus[r[i+1]].class),s(3),g(" ",b==null?null:b.passengerIndex," ")}}function Ue(t,a){if(t&1&&(o(0,"div",35)(1,"div",37),l(2),n(),y(3,Ge,6,12,"a",38,w),n()),t&2){let e=a.$implicit,i=m();s(2),u(e[0]),s(),E(i.columnName.slice(0,2))}}function Le(t,a){if(t&1&&(o(0,"div",34),l(1),n()),t&2){let e=a.$implicit;s(),g(" ",e," ")}}function Ye(t,a){if(t&1){let e=T();ie(0),le(1,"seatPassenger"),o(2,"a",39),v("click",function(){let r=S(e),d=r.$implicit,b=r.$index,R=ae(0),j=m().$implicit,ne=m(3);return h(ne.selectSeat(j[0],d,j[b+3],R))}),f(3,"i",16)(4,"i",25),l(5),n()}if(t&2){let e=a.$implicit,i=a.$index,r=m().$implicit,d=m(3),b=oe(se(1,4,re(7,Fe,r[0],e,d.passengers(),d.carNumber())));s(2),P("selected",b),_("ngClass",d.seatStatus[r[i+3]].class),s(3),g(" ",b==null?null:b.passengerIndex," ")}}function ze(t,a){if(t&1&&(o(0,"div",35),y(1,Ye,6,12,"a",38,w),o(3,"div",37),l(4),n()()),t&2){let e=a.$implicit,i=m();s(),E(i.columnName.slice(2)),s(3),u(e[0])}}function We(t,a){if(t&1&&(o(0,"div",7)(1,"div",31)(2,"div",32),f(3,"div",33),y(4,je,2,1,"div",34,w),n(),y(6,Ue,5,1,"div",35,w),n(),o(8,"div",36),l(9," \u8D70\u9053 "),n(),o(10,"div",31)(11,"div",32),y(12,Le,2,1,"div",34,w),n(),y(14,ze,5,1,"div",35,w),n()()),t&2){let e=a;s(4),E(e.columnName.slice(0,2)),s(2),E(e.value),s(6),E(e.columnName.slice(2)),s(2),E(e.value)}}function He(t,a){if(t&1&&(o(0,"option",12),l(1),n()),t&2){let e=a.$implicit;_("value",e),s(),g(" ",e," ")}}function Je(t,a){if(t&1&&(o(0,"div",9)(1,"span",40),l(2,"\u8ECA\u5EC2\u7A2E\u985E:"),n(),o(3,"span",41),l(4),n()(),o(5,"div",9)(6,"span",42),l(7,"\u5168\u8ECA\u5EA7\u4F4D\u6578:"),n(),o(8,"span"),l(9),n()(),o(10,"div",9)(11,"span",42),l(12,"\u672C\u8ECA\u5EC2\u5EA7\u4F4D:"),n(),o(13,"span"),l(14),n()()),t&2){let e=a;s(4),u(e.classType),s(5),u(e.regSeat),s(5),u(e.totalSeats)}}function Ke(t,a){if(t&1&&(o(0,"tr")(1,"td",30),l(2),n(),o(3,"td",30),l(4),n(),o(5,"td",30),l(6),n()()),t&2){let e,i=a.$implicit;s(2),u(i.passengerIndex),s(2),u(i.profile),s(2),U(" ",i.carNumber==null||(e=i.carNumber.toString())==null?null:e.padStart(2,"0"),"/",i.col,"",i.row," ")}}function Qe(t,a){if(t&1){let e=T();o(0,"div",0)(1,"p",1),l(2,"\u5EA7\u4F4D\u8868"),n(),o(3,"button",2),v("click",function(){S(e);let r=m();return h(r.ngbActiveModal.close(null))}),n()(),o(4,"div",3)(5,"div",4)(6,"div",5)(7,"span",6),l(8," \u65E5\u671F: "),o(9,"span"),l(10),n()(),o(11,"span",6),l(12),n(),o(13,"span",6),l(14),n(),o(15,"span",6),l(16),n()(),p(17,We,16,0,"div",7),n(),o(18,"div",8)(19,"div",9)(20,"span",10),l(21,"\u8ECA\u5EC2:"),n(),o(22,"select",11),v("ngModelChange",function(r){S(e);let d=m();return h(d.carNumber.set(r))}),y(23,He,2,2,"option",12,w),n()(),p(25,Je,15,3),o(26,"ul",13)(27,"li",9)(28,"span",14),l(29,"\u4E00\u822C\u5EA7\u4F4D"),n(),o(30,"div",15),f(31,"i",16),n(),o(32,"div",17),l(33," N "),n()(),o(34,"li",9)(35,"span",14),l(36,"\u4FDD\u7559\u5EA7\u4F4D"),n(),o(37,"div",18),f(38,"i",16),n(),f(39,"div",19),n(),o(40,"li",9)(41,"span",14),l(42,"\u656C\u8001\u611B\u5FC3\u5EA7"),n(),o(43,"div",20),f(44,"i",16),n(),o(45,"div",21),l(46," N "),n()(),o(47,"li",9)(48,"span",14),l(49,"\u7121\u969C\u7919\u5EA7\u4F4D"),n(),o(50,"div",22),f(51,"i",16),n(),o(52,"div",23),l(53," N "),n()(),o(54,"li",9)(55,"span",14),l(56,"\u5DF2\u88AB\u5360\u7528\u5EA7"),n(),o(57,"div",24),f(58,"i",25),n(),f(59,"div",19),n()(),o(60,"button",26),v("click",function(){S(e);let r=m();return h(r.reset())}),l(61,"\u5EA7\u4F4D\u91CD\u8A2D"),n(),o(62,"button",27),v("click",function(){S(e);let r=m();return h(r.confirm())}),l(63,"\u5EA7\u4F4D\u78BA\u8A8D"),n(),o(64,"table",28)(65,"thead",29)(66,"tr")(67,"th",30),l(68,"\u7DE8\u865F"),n(),o(69,"th",30),l(70,"\u8EAB\u5206\u5225"),n(),o(71,"th",30),l(72,"\u8ECA\u5EC2/\u5EA7\u4F4D"),n()()(),o(73,"tbody"),y(74,Ke,7,5,"tr",null,Oe),n()()()()}if(t&2){let e,i,r=a,d=m();s(10),g("",r.date," "),s(2),g("\u8ECA\u6B21: ",r.trainNumber,""),s(2),g("\u51FA\u767C\u7AD9: ",r.departStation,""),s(2),g("\u5230\u9054\u7AD9: ",r.arrivalStation,""),s(),c((e=d.seat())?17:-1,e),s(5),_("ngModel",d.carNumber()),s(),E(d.carNumbers()),s(2),c((i=d.seat())?25:-1,i),s(37),_("disabled",!d.allSelected()),s(12),E(d.passengers())}}var Ne={};[{symbol:"",class:"invisible"},{symbol:"V",class:"seat-reserved"},{symbol:"$",class:"seat-taken"},{symbol:"@",class:"seat-available"},{symbol:"@C",class:"seat-priority"},{symbol:"@W",class:"seat-accessibility"}].forEach(t=>{Ne[t.symbol]=t});var te=class t{seatStatus=Ne;seatData=M(null);passengers=M([]);carNumber=M("");carNumbers=B(()=>this.seatData()?.seats.map(a=>a.carNumber)||[]);seat=B(()=>{let a=this.seatData()?.seats||[],e=this.carNumber();return a.find(r=>r.carNumber===e)});allSelected=B(()=>this.passengers().every(a=>a.col&&a.row));ngbActiveModal=x(we);loadingService=x(V);apiService=x(O);messageService=x(D);destroyRef=x(k);ngOnInit(){this.setCarNumber()}ngOnChanges(){this.setCarNumber()}selectSeat(a,e,i,r){if(r){r.col=void 0,r.row=void 0,r.carNumber=void 0,this.passengers.set([...this.passengers()]);return}i==="$"||i==="V"||(r=this.passengers().find(d=>!d.carNumber),r&&(r.col=e,r.row=parseInt(a,10),r.carNumber=parseInt(this.carNumber(),10),this.passengers.set([...this.passengers()])))}reset(){this.passengers.update(a=>a.map(e=>me(de({},e),{col:void 0,row:void 0,carNumber:void 0})))}confirm(){if(this.loadingService.loading)return;this.loadingService.start();let a={pnrId:"",trainNumber:this.seatData()?.trainNumber,newSeats:this.toRequestSeats(this.passengers())};this.apiService.bookSetSeat(a).pipe(A(this.destroyRef)).subscribe({next:e=>{this.loadingService.stop(),this.ngbActiveModal.close(e.data.trip)},error:e=>{this.loadingService.stop(),this.messageService.handleError(e)},complete:()=>{this.loadingService.stop()}})}toRequestSeats(a){return a.map(e=>({passengerIndex:e.passengerIndex,carNumber:e.carNumber,row:e.row,col:e.col}))}setCarNumber(){let a=!1,e=this.passengers()[0];e?.carNumber&&(this.carNumber.set(e.carNumber.toString()),a=!0),a||this.carNumber.set(this.carNumbers()[0])}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-seat-modal"]],features:[Y],decls:1,vars:1,consts:[[1,"modal-header","bg-warning-subtle","align-items-center","justify-content-between"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body","d-flex","align-items-start"],[1,"flex-grow-1"],[1,"fs-6"],[1,"ms-3"],[1,"d-flex","justify-content-start","ms-5"],[1,"mx-4","fs-6","w-30"],[1,"d-flex","text-nowrap","align-items-center","m-2","justify-content-between"],[1,"me-2"],[1,"form-select","form-select-sm","fs-7","ml-2",3,"ngModelChange","ngModel"],[3,"value"],[1,"list-unstyled"],[1,"legend-box"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","ms-auto"],[1,"fas","fa-chair"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-available","selected"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-reserved","ms-auto"],[1,"m-1","w-30-px"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-priority","ms-auto"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-priority","selected"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-accessibility","ms-auto"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-accessibility","selected"],[1,"d-flex","align-items-center","justify-content-center","m-1","border","w-30-px","seat","seat-taken","ms-auto"],[1,"fas","fa-ban"],[1,"btn","btn-secondary","btn-sm","me-1",3,"click"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],[1,"table","mt-3","table-bordered","text-center","align-middle"],[1,"table-light"],[1,"text-nowrap"],[1,"mt-3"],[1,"d-flex","gap-3","mb-1"],[1,"text-center","fw-bold","w-30-px"],[1,"text-center","fw-bold","bg-warning-subtle","w-30-px"],[1,"d-flex","align-items-center","gap-3","mb-1"],[1,"w-5","container","my-3","mx-3","d-flex","align-items-center","justify-content-center","flex-column","bg-warning-subtle"],[1,"text-center","bg-warning-subtle","w-30-px"],["href","javascript:;",1,"d-flex","align-items-center","justify-content-center","border","w-30-px","seat","text-decoration-none",3,"ngClass","selected"],["href","javascript:;",1,"d-flex","align-items-center","justify-content-center","border","w-30-px","seat","text-decoration-none",3,"click","ngClass"],[1,"me-1","text-end"],[1,"text-start"],[1,"me-1"]],template:function(e,i){if(e&1&&p(0,Qe,76,8),e&2){let r;c((r=i.seatData())?0:-1,r)}},dependencies:[F,W,N,K,Q,Ee,q,J,ee],styles:[".seat[_ngcontent-%COMP%]{height:30px;border-radius:4px}.seat[_ngcontent-%COMP%]   .fa-ban[_ngcontent-%COMP%], .seat.selected[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]{display:none}.seat-reserved[_ngcontent-%COMP%]{color:#0dcaf0}.seat-priority[_ngcontent-%COMP%]{color:#ffc107}.seat-priority.selected[_ngcontent-%COMP%]{background-color:#ffc107;color:#000}.seat-accessibility[_ngcontent-%COMP%]{color:#0d6efd}.seat-accessibility.selected[_ngcontent-%COMP%]{background-color:#0d6efd;color:#000}.seat-available[_ngcontent-%COMP%]{color:#000}.seat-available.selected[_ngcontent-%COMP%]{background-color:#d63384}.seat-taken[_ngcontent-%COMP%]{color:#000}.seat-taken[_ngcontent-%COMP%]   .fa-ban[_ngcontent-%COMP%]{display:inline}.seat-taken[_ngcontent-%COMP%]   .fa-chair[_ngcontent-%COMP%]{display:none}"]})};function Xe(t,a){t&1&&f(0,"th",2)}function Ze(t,a){t&1&&(o(0,"th",2),l(1,"\u5EA7\u4F4D\u9078\u64C7"),n())}function et(t,a){t&1&&(o(0,"td"),f(1,"input",3),n())}function tt(t,a){t&1&&(o(0,"td"),l(1,"\u53BB"),n())}function nt(t,a){t&1&&(o(0,"td"),l(1,"\u53BB\u7A0B\u5217\u8ECA"),n())}function it(t,a){if(t&1){let e=T();o(0,"td")(1,"button",4),v("click",function(){S(e);let r=m(2);return h(r.selectSeat(!0))}),l(2,"\u5EA7\u4F4D\u8868"),n()()}}function ot(t,a){if(t&1&&(o(0,"tr"),p(1,et,2,0,"td")(2,tt,2,0,"td")(3,nt,2,0,"td"),o(4,"td"),l(5),n(),o(6,"td"),l(7),n(),o(8,"td"),l(9),n(),o(10,"td"),l(11),n(),o(12,"td"),l(13),n(),o(14,"td"),l(15),n(),o(16,"td"),l(17),n(),o(18,"td"),l(19),n(),o(20,"td"),l(21),n(),p(22,it,3,0,"td"),n()),t&2){let e=a,i=m();s(),c(i.hasCheckbox()?1:-1),s(),c(i.isShort()?2:-1),s(),c(i.isShort()?-1:3),s(2),u(e.discount),s(2),u(e.trainNumber),s(2),u(e.departStation),s(2),u(e.arrivalStation),s(2),u(e.departDate),s(2),u(e.departTime),s(2),u(e.arrivalTime),s(2),u(e.elapseTime),s(2),u(e.carriage),s(),c(i.seatSelectable()?22:-1)}}function at(t,a){t&1&&(o(0,"td"),f(1,"input",3),n())}function rt(t,a){t&1&&(o(0,"td"),l(1,"\u56DE"),n())}function lt(t,a){t&1&&(o(0,"td"),l(1,"\u56DE\u7A0B\u5217\u8ECA"),n())}function st(t,a){if(t&1){let e=T();o(0,"td")(1,"button",4),v("click",function(){S(e);let r=m(3);return h(r.selectSeat(!1))}),l(2,"\u5EA7\u4F4D\u8868"),n()()}}function dt(t,a){if(t&1&&(o(0,"tr"),p(1,at,2,0,"td")(2,rt,2,0,"td")(3,lt,2,0,"td"),o(4,"td"),l(5),n(),o(6,"td"),l(7),n(),o(8,"td"),l(9),n(),o(10,"td"),l(11),n(),o(12,"td"),l(13),n(),o(14,"td"),l(15),n(),o(16,"td"),l(17),n(),o(18,"td"),l(19),n(),o(20,"td"),l(21),n(),p(22,st,3,0,"td"),n()),t&2){let e=a,i=m(2);s(),c(i.hasCheckbox()?1:-1),s(),c(i.isShort()?2:-1),s(),c(i.isShort()?-1:3),s(2),u(e.discount),s(2),u(e.trainNumber),s(2),u(e.departStation),s(2),u(e.arrivalStation),s(2),u(e.departDate),s(2),u(e.departTime),s(2),u(e.arrivalTime),s(2),u(e.elapseTime),s(2),u(e.carriage),s(),c(i.seatSelectable()?22:-1)}}function mt(t,a){if(t&1&&p(0,dt,23,13,"tr"),t&2){let e,i=m();c((e=i.inbound())?0:-1,e)}}var Ae=class t{outbound=C();inbound=C();seatSelectable=C(!0);roundTrip=C(!1);passengers=C();isShort=C(!0);hasCheckbox=C(!0);seatChange=pe();ngbModal=x(Te);loadingService=x(V);apiService=x(O);messageService=x(D);destroyRef=x(k);data=null;selectSeat(a){if(this.loadingService.loading)return;this.loadingService.start();let e=a?this.outbound():this.inbound(),i=this.getPassengers(a),r={pnrId:"",trainNumber:e?.trainNumber,classType:e?.carriage==="\u6A19\u6E96\u8ECA\u5EC2"?"Y":"N",originalSeats:this.toRequestSeats(i)};this.apiService.bookSeatMap(r).pipe(A(this.destroyRef)).subscribe({next:d=>{this.loadingService.stop(),this.data=d.data,this.openSeatModal(i)},error:d=>{this.loadingService.stop(),this.messageService.handleError(d)},complete:()=>{this.loadingService.stop()}})}openSeatModal(a){return ce(this,null,function*(){let e=this.ngbModal.open(te,{size:"lg",centered:!0,scrollable:!0,backdrop:"static"});e.componentInstance.seatData.set(this.data),e.componentInstance.passengers.set(a);let i=yield e.result;i&&this.seatChange.emit(i)})}getPassengers(a){return(this.passengers()||[]).map(e=>{let i=a?"OUTBOUND":"INBOUND",r=e.tickets.find(d=>d.journey===i);return{profile:e.profile,passengerIndex:e.index,carNumber:r.car,row:r.seatRow,col:r.seatCol}})}toRequestSeats(a){return a.map(e=>({passengerIndex:e.passengerIndex,carNumber:e.carNumber,row:e.row,col:e.col}))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-bound"]],inputs:{outbound:[1,"outbound"],inbound:[1,"inbound"],seatSelectable:[1,"seatSelectable"],roundTrip:[1,"roundTrip"],passengers:[1,"passengers"],isShort:[1,"isShort"],hasCheckbox:[1,"hasCheckbox"]},outputs:{seatChange:"seatChange"},decls:27,vars:4,consts:[[1,"table","table-sm","table-striped","table-hover","table-bordered","table-sticky-header","text-center","align-middle","m-0"],[1,"table-warning","backdrop-blur"],[1,"text-nowrap"],["type","checkbox",1,"form-check-input","me-1","flex-grow-1"],[1,"btn","btn-primary",3,"click"]],template:function(e,i){if(e&1&&(o(0,"table",0)(1,"thead",1)(2,"tr"),p(3,Xe,1,0,"th",2),f(4,"th",2),o(5,"th",2),l(6,"\u512A\u60E0*"),n(),o(7,"th",2),l(8,"\u8ECA\u6B21"),n(),o(9,"th",2),l(10,"\u51FA\u767C\u7AD9"),n(),o(11,"th",2),l(12,"\u5230\u9054\u7AD9"),n(),o(13,"th",2),l(14,"\u51FA\u767C\u65E5\u671F"),n(),o(15,"th",2),l(16,"\u51FA\u767C\u6642\u9593"),n(),o(17,"th",2),l(18,"\u5230\u9054\u6642\u9593"),n(),o(19,"th",2),l(20,"\u884C\u8ECA\u6642\u9593"),n(),o(21,"th",2),l(22,"\u5EC2\u7B49"),n(),p(23,Ze,2,0,"th",2),n()(),o(24,"tbody"),p(25,ot,23,13,"tr")(26,mt,1,1),n()()),e&2){let r;s(3),c(i.hasCheckbox()?3:-1),s(20),c(i.seatSelectable()?23:-1),s(2),c((r=i.outbound())?25:-1,r),s(),c(i.roundTrip()?26:-1)}},dependencies:[N,F,X],encapsulation:2})};var ct=(t,a)=>a.index;function pt(t,a){t&1&&f(0,"th",3)}function ut(t,a){t&1&&(o(0,"th",3),l(1,"\u8A3B\u8A18"),n())}function _t(t,a){t&1&&(o(0,"td"),f(1,"input",23),n())}function ft(t,a){if(t&1&&(o(0,"td")(1,"select",24)(2,"option"),l(3),n()()()),t&2){let e=m().$implicit;s(3),u(e.profile)}}function xt(t,a){if(t&1&&(o(0,"td"),l(1),n()),t&2){let e=m().$implicit;s(),u(e.profile)}}function Ct(t,a){if(t&1&&l(0),t&2){let e=m().$implicit;g(" ",e.personalId," ")}}function gt(t,a){t&1&&(o(0,"span",12),l(1,"*"),n())}function bt(t,a){if(t&1){let e=T();o(0,"input",25),v("change",function(){S(e);let r=m().$index,d=m();return h(d.onPersonalIdChange(r))}),n(),p(1,gt,2,0,"span",12),f(2,"input",26)}if(t&2){let e=m(),i=e.$implicit,r=e.$index;P("invisible",r===0),_("id","personalIdCheck-"+i.index),s(),c(i.personalIdRequired?1:-1),s(),_("id","personalId-"+i.index)}}function vt(t,a){if(t&1&&l(0),t&2){let e=m().$implicit;g(" ",e.expiryDate," ")}}function St(t,a){t&1&&(o(0,"span",12),l(1,"*"),n())}function ht(t,a){if(t&1&&(p(0,St,2,0,"span",12),f(1,"input",27)),t&2){let e=m().$implicit;c(e!=null&&e.expiryDateRequired?0:-1),s(),_("id","expiryDate-"+e.index)}}function yt(t,a){t&1&&(o(0,"span",12),l(1,"*"),n())}function Et(t,a){if(t&1&&(o(0,"label",19),l(1,"\u53BB:"),n()),t&2){let e=m().$implicit;_("for","outboundCoupon-"+e.index)}}function It(t,a){if(t&1&&l(0),t&2){let e=m().$implicit;g(" ",e.outbound==null?null:e.outbound.coupon," ")}}function wt(t,a){t&1&&(o(0,"span",12),l(1,"*"),n())}function Tt(t,a){if(t&1&&(p(0,wt,2,0,"span",12),f(1,"input",28)),t&2){let e=m().$implicit;c(e.outboundCouponRequired?0:-1),s(),_("id","outboundCoupon-"+e.index)}}function Dt(t,a){if(t&1&&l(0),t&2){let e=m(2).$implicit;g(" ",e.inbound==null?null:e.inbound.coupon," ")}}function kt(t,a){t&1&&(o(0,"span",12),l(1,"*"),n())}function Mt(t,a){if(t&1&&(p(0,kt,2,0,"span",12),f(1,"input",29)),t&2){let e=m(2).$implicit;c(e.inboundCouponRequired?0:-1),s(),_("id","inboundCoupon-"+e.index)}}function Pt(t,a){if(t&1&&(o(0,"div",20)(1,"label",19),l(2,"\u56DE:"),n(),p(3,Dt,1,1)(4,Mt,2,2),n()),t&2){let e=m().$implicit,i=m();s(),_("for","inboundCoupon-"+e.index),s(2),c(i.readonly()?3:4)}}function Ft(t,a){if(t&1&&(o(0,"span",22)(1,"span"),l(2,"NT$"),n(),l(3),n()),t&2){let e=m().$implicit;s(3),u(e==null||e.inbound==null?null:e.inbound.fare)}}function Nt(t,a){if(t&1&&(o(0,"span",22),l(1),n()),t&2){let e,i=m().$implicit;s(),U("",i.inbound==null||i.inbound.car==null||(e=i.inbound.car.toString())==null?null:e.padStart(2,"0"),"/",i.inbound==null?null:i.inbound.seatRow,"",i.inbound==null?null:i.inbound.seatCol,"")}}function At(t,a){t&1&&(o(0,"td"),l(1,"132"),n())}function Rt(t,a){if(t&1){let e=T();o(0,"tr",7),p(1,_t,2,0,"td"),o(2,"td"),l(3),n(),p(4,ft,4,1,"td")(5,xt,2,1,"td"),o(6,"td")(7,"div",8),p(8,Ct,1,1)(9,bt,3,5),n()(),o(10,"td",9)(11,"div",10),p(12,vt,1,1)(13,ht,2,2),n()(),o(14,"td",11),p(15,yt,2,0,"span",12),f(16,"input",13),o(17,"label",14),l(18,"\u6709"),n(),f(19,"input",13),o(20,"label",15),l(21,"\u7121"),n()(),o(22,"td",11)(23,"div",16)(24,"input",17),v("change",function(){let r=S(e).$index,d=m();return h(d.onNoIdDocumentChange(r))}),n(),o(25,"label",14),l(26,"\u7121\u8B49\u4EF6"),n()()(),o(27,"td")(28,"div",18)(29,"div",16),p(30,Et,2,1,"label",19)(31,It,1,1)(32,Tt,2,2),n(),p(33,Pt,5,2,"div",20),n()(),o(34,"td")(35,"div",18)(36,"span",21)(37,"span"),l(38,"NT$"),n(),l(39),n(),p(40,Ft,4,1,"span",22),n()(),o(41,"td")(42,"div",18)(43,"span",21),l(44),n(),p(45,Nt,2,3,"span",22),n()(),p(46,At,2,0,"td"),n()}if(t&2){let e,i=a.$implicit,r=a.$index,d=m();_("formGroupName",r),s(),c(d.showRowCheckbox()?1:-1),s(2),g(" ",i.index," "),s(),c(d.isSelect()?4:-1),s(),c(d.isSelect()?-1:5),s(3),c(d.readonly()?8:9),s(4),c(d.readonly()?12:13),s(3),c(!d.readonly()&&i.needCompanionRequired?15:-1),s(),P("disabled",d.readonly()),_("id","needCompanionYes-"+i.index)("readonly",d.readonly()?"true":null)("value",!0),s(),_("for","needCompanionYes-"+i.index),s(2),P("disabled",d.readonly()),_("id","needCompanionNo-"+i.index)("readonly",d.readonly()?"true":null)("value",!1),s(),_("for","needCompanionNo-"+i.index),s(4),P("disabled",d.readonly()),_("id","noIdDocument-"+i.index)("readonly",d.readonly()?"true":null),s(),_("for","noIdDocument-"+i.index),s(5),c(d.roundTrip()?30:-1),s(),c(d.readonly()?31:32),s(2),c(d.roundTrip()?33:-1),s(6),u(i==null||i.outbound==null?null:i.outbound.fare),s(),c(d.roundTrip()?40:-1),s(4),U("",i.outbound==null||i.outbound.car==null||(e=i.outbound.car.toString())==null?null:e.padStart(2,"0"),"/",i.outbound==null?null:i.outbound.seatRow,"",i.outbound==null?null:i.outbound.seatCol,""),s(),c(d.roundTrip()?45:-1),s(),c(d.showRowMarker()?46:-1)}}var Re=class t{passengers=C();roundTrip=C(!1);readonly=C(!1);promotion=C(null);needToCheck=G(!1);isSelect=C(!1);showRowCheckbox=C(!1);showRowMarker=C(!1);form;formBuilder=x(Ie);destroyRef=x(k);messageService=x(D);constructor(){this.form=this.formBuilder.group({passengers:this.formBuilder.array([])}),this.form.valueChanges.pipe(A(this.destroyRef)).subscribe(()=>{let e=(this.form.get("passengers")?.value||[]).some(i=>(i.profile==="\u611B\u5FC3"||i.profile==="\u656C\u8001")&&!i.noIdDocument);this.needToCheck.set(e)})}ngOnChanges(a){if(a.passengers||"promotion"in a){let e=a.promotion?.currentValue,i=a.passengers.currentValue.map(r=>{r.outbound=r.tickets.find(R=>R.journey==="OUTBOUND"),r.inbound=r.tickets.find(R=>R.journey==="INBOUND"),r.personalIdRequired=r.profile==="\u611B\u5FC3"||r.profile==="\u656C\u8001",e&&(r.profile==="\u6210\u4EBA"||r.profile==="\u5B69\u7AE5")&&(r.personalIdRequired=e.adultChildId),r.expiryDateRequired=r.profile==="\u611B\u5FC3",r.needCompanionRequired=r.profile==="\u611B\u5FC3";let d=r.profile==="\u7279\u60E0\u5168"||r.profile==="\u7279\u60E0\u534A"||e?.voucherNumberRequired;r.outboundCouponRequired=d,r.inboundCouponRequired=d;let b=r.profile==="\u611B\u5FC3"||r.profile==="\u656C\u8001";return this.formBuilder.group({index:[r.index],profile:[r.profile],personalIdCheck:[{value:!1,disabled:!r.personalIdRequired}],personalId:[{value:r.personalId||"",disabled:!r.personalIdRequired},r.personalIdRequired?[$.required]:[]],expiryDate:[{value:r.expiryDate||"",disabled:!r.expiryDateRequired},r.expiryDateRequired?[$.required]:[]],needCompanion:[{value:r.needCompanion,disabled:!r.needCompanionRequired},r.needCompanionRequired?[$.required]:[]],noIdDocument:[{value:r.noIdDocument||!1,disabled:!b}],outboundCoupon:[r.outbound?.coupon||"",r.outboundCouponRequired?[$.required]:[]],inboundCoupon:[r.inbound?.coupon||"",r.inboundCouponRequired?[$.required]:[]]})});this.form.setControl("passengers",this.formBuilder.array(i))}}onPersonalIdChange(a){let e=this.form.get(`passengers.${a-1}`),i=this.form.get(`passengers.${a}`);i.get("personalIdCheck")?.value?i.get("personalId")?.setValue(e.get("personalId")?.value):i.get("personalId")?.setValue("")}onNoIdDocumentChange(a){let e=this.form.get(`passengers.${a}`);e.get("profile")?.value==="\u611B\u5FC3"&&(e.get("noIdDocument").value?(e.get("needCompanion")?.disable(),e.get("expiryDate")?.disable()):(e.get("needCompanion")?.enable(),e.get("expiryDate")?.enable()))}getValues(){return this.form.value.passengers.map(e=>({index:e.index,profile:e.profile,personalId:e.personalId,expiryDate:e.expiryDate?.replaceAll("-","/"),needCompanion:e.needCompanion,noIdDocument:e.noIdDocument,outbound:{coupon:e.outboundCoupon},inbound:{coupon:e.inboundCoupon}}))}setPassengers(a){let e=this.getValues();for(let r of a)for(let d of e.filter(b=>b.personalId===r.personalId)){let b=this.form.get(`passengers.${d.index-1}`);b.get("expiryDate")?.enabled&&b.patchValue({expiryDate:r.expiryDate.replaceAll("/","-"),needCompanion:r.needCompanion})}let i=[];for(let r of(this.passengers()||[]).filter(d=>d.expiryDateRequired))this.form.get(`passengers.${r.index-1}`).get("expiryDate")?.value||i.push(`\u4E58\u5BA2${r.index}\u8CC7\u6599\u4E0D\u5B58\u5728\u65BC\u7CFB\u7D71\uFF0C\u8ACB\u4F9D\u65C5\u5BA2\u8B49\u4EF6\u8FA6\u7406\u8CC7\u6599\u767B\u9304`);this.form.markAllAsTouched(),this.messageService.setErrors(i)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-passengers"]],inputs:{passengers:[1,"passengers"],roundTrip:[1,"roundTrip"],readonly:[1,"readonly"],promotion:[1,"promotion"],needToCheck:[1,"needToCheck"],isSelect:[1,"isSelect"],showRowCheckbox:[1,"showRowCheckbox"],showRowMarker:[1,"showRowMarker"]},outputs:{needToCheck:"needToCheckChange"},features:[Y],decls:27,vars:3,consts:[[3,"formGroup"],[1,"table","table-sm","table-striped","table-hover","table-bordered","table-sticky-header","text-center","align-middle","m-0"],[1,"table-warning","backdrop-blur"],[1,"text-nowrap"],[1,"text-nowrap","id-col"],[1,"text-nowrap","expiry-col"],["formArrayName","passengers"],[3,"formGroupName"],[1,"id-col","d-flex","align-items-center"],[1,"expiry-col"],[1,"d-flex","align-items-center","justify-content-center"],[1,"align-items-center","text-nowrap"],[1,"m-1","text-danger"],["type","radio","formControlName","needCompanion",1,"form-check-input","me-1",3,"id","readonly","value"],[1,"form-check-label","me-2",3,"for"],[1,"form-check-label",3,"for"],[1,"d-flex","align-items-center"],["type","checkbox","formControlName","noIdDocument",1,"form-check-input","me-1","fs-6",3,"change","id","readonly"],[1,"d-flex","flex-column","justify-content-start"],[1,"me-1",3,"for"],[1,"d-flex","align-items-center","mt-1"],[1,"me-1","mb-2"],[1,"me-1","mb-1"],["type","checkbox","id","select-1",1,"form-check-input","me-1","flex-grow-1"],["disabled","",1,"form-select","form-select-sm","fs-7","ml-2"],["type","checkbox","formControlName","personalIdCheck",1,"form-check-input","me-1","fs-6","flex-grow-1",3,"change","id"],["type","text","formControlName","personalId",1,"fs-6","form-control","form-control-sm","flex-grow-1",3,"id"],["type","date","formControlName","expiryDate",1,"fs-6","form-control","form-control-sm","flex-1",3,"id"],["type","text","formControlName","outboundCoupon",1,"fs-6","form-control","form-control-sm","flex-grow-1",3,"id"],["type","text","formControlName","inboundCoupon",1,"fs-6","form-control","form-control-sm","flex-grow-1",3,"id"]],template:function(e,i){e&1&&(o(0,"form",0)(1,"table",1)(2,"thead",2)(3,"tr"),p(4,pt,1,0,"th",3),o(5,"th",3),l(6,"\u7DE8\u865F"),n(),o(7,"th",3),l(8,"\u8EAB\u5206\u5225"),n(),o(9,"th",4),l(10,"\u8EAB\u5206\u8B49\u865F/\u8B77\u7167\u865F\u78BC"),n(),o(11,"th",5),l(12,"\u6548\u671F"),n(),o(13,"th",3),l(14,"\u966A\u4F34\u8CC7\u683C"),n(),o(15,"th",3),l(16,"\u7121\u8B49\u4EF6"),n(),o(17,"th",3),l(18,"\u514C\u63DB\u5238\u865F\u78BC"),n(),o(19,"th",3),l(20,"\u7968\u50F9"),n(),o(21,"th",3),l(22,"\u8ECA\u5EC2/\u5EA7\u4F4D"),n(),p(23,ut,2,0,"th",3),n()(),o(24,"tbody",6),y(25,Rt,47,35,"tr",7,ct),n()()()),e&2&&(_("formGroup",i.form),s(4),c(i.showRowCheckbox()?4:-1),s(19),c(i.showRowMarker()?23:-1),s(2),E(i.passengers()))},dependencies:[N,ge,K,Q,H,xe,be,q,Ce,F,X,ve,ye,Se,he],styles:[".id-col[_ngcontent-%COMP%], .expiry-col[_ngcontent-%COMP%]{max-width:160px}.expiry-col[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{min-width:0}"]})};export{Me as a,Ae as b,Re as c,De as d};
