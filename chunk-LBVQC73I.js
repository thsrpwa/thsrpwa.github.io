import{a as Oe,b as Q,c as Ue,d as pe,e as $,f as se,g as ze}from"./chunk-XAPNK74H.js";import{a as je,c as We,d as He,f as Ye,g as Je}from"./chunk-FPHSEH65.js";import{b as M,i as $e,j as N}from"./chunk-F4AZ2R32.js";import{b as Ve,c as Z,e as ee,f as te,g as ie,j as oe,k as Me,l as Pe,m as ne,o as Le,p as re,q as qe,r as Ge,s as Re,t as Qe,v as ae,w as I,x as B}from"./chunk-TZ5BZHLV.js";import{a as Ae}from"./chunk-LW3WONP3.js";import{$a as R,Ba as be,Ca as A,Da as V,E as ve,Ea as a,Fa as n,Ga as f,Ha as E,J as Ee,Ja as C,Ka as d,Kb as x,M as b,Na as ge,Qb as Be,S as u,Sa as G,Sb as Ne,T as c,Ta as z,Va as s,Wa as D,Wb as Fe,Xa as W,Z as y,Za as Ie,_ as T,_a as H,a as L,aa as w,ab as O,b as Te,bb as J,cb as K,d as we,da as p,db as X,e as U,ga as ke,ia as q,ja as he,ka as g,la as De,m as _e,pa as S,ta as Se,ua as m,ub as k,vb as Y,wa as v,za as h}from"./chunk-O2LKXLAO.js";var Ke=r=>r?.canDeactiveGuard();var le=we(He());var tt=["departTripSection"],it=["returnTripSection"],ot=(r,i)=>i.code,nt=(r,i)=>i.name,rt=(r,i)=>i.id,at=(r,i)=>i.promotionCode;function pt(r,i){if(r&1&&(a(0,"option",8),s(1),n()),r&2){let e=i.$implicit;m("value",e),p(),D(e)}}function st(r,i){if(r&1&&(a(0,"option",8),s(1),n()),r&2){let e=i.$implicit;m("value",e),p(),D(e)}}function lt(r,i){if(r&1&&(a(0,"div",18)(1,"label",26),s(2),n(),f(3,"input",27),n()),r&2){let e=i.$implicit,t=i.$index;p(),m("for","profile-"+e.code),p(),D(e.content),p(),m("id","profile-"+e.code)("formControlName",t)}}function mt(r,i){if(r&1&&(a(0,"div",9),f(1,"input",28),a(2,"label",29),s(3),n()()),r&2){let e=i.$implicit;p(),ge("id","classType-",e.value,""),m("formControlName","classType")("value",e.value),Se("disabled",e.disabled?"true":null),p(),ge("for","classType-",e.value,""),p(),D(e.name)}}function dt(r,i){if(r&1&&(a(0,"div",19)(1,"div",9),s(2,"\u8ECA\u5EC2\u7A2E\u985E"),n(),A(3,mt,4,8,"div",9,nt),n()),r&2){let e=d();p(3),V(e.reservationService.reservation.classTypes())}}function ut(r,i){if(r&1&&f(0,"app-trip-section",22,1),r&2){let e=d();m("time",e.defaultReturnTime)("hasTitle",!0)("hasBorder",!0)("hasTrainNumber",!0)}}function ct(r,i){if(r&1&&(a(0,"option",8),s(1),n()),r&2){let e=i.$implicit;m("value",e.id),p(),D(e.name)}}function ft(r,i){if(r&1&&(a(0,"option",8),s(1),n()),r&2){let e=i.$implicit;m("value",e.promotionCode),p(),Ie(" ",e.promotionCode," - ",e.projectName," - ",e.projectDiscount," ")}}function Ct(r,i){if(r&1&&(a(0,"div",23)(1,"div",30)(2,"div",31)(3,"div",32)(4,"label",33),s(5,"\u5C08\u6848\u5206\u985E"),n(),a(6,"select",34),A(7,ct,2,2,"option",8,rt),n()(),a(9,"div",35)(10,"label",36),s(11,"\u4FC3\u92B7\u4EE3\u78BC"),n(),a(12,"select",37)(13,"option",38),s(14,"\u8ACB\u9078\u64C7"),n(),A(15,ft,2,4,"option",8,at),n()()(),a(17,"span",39),s(18,"\u6216"),n(),a(19,"div",40)(20,"label",41),s(21,"\u4FC3\u92B7\u4EE3\u78BC"),n(),f(22,"input",42),n()()()),r&2){let e=d();p(7),V(e.reservationService.reservation.promotionTypeList()),p(8),V(e.filteredPromotionDataList()),p(7),v("disabled",e.promotionList()),Se("readonly",e.promotionList()?"true":null)}}function _t(r,i){if(r&1){let e=E();a(0,"button",43),C("click",function(){u(e);let o=d();return c(o.onSubmit(o.bookingType.general))}),s(1," \u81EA\u7531\u5EA7\u8A02\u4F4D "),n()}if(r&2){let e=d();m("disabled",e.disableGernalBook())}}function vt(r,i){if(r&1){let e=E();a(0,"button",43),C("click",function(){u(e);let o=d();return c(o.onSubmit(o.bookingType.general))}),s(1," \u4E00\u822C\u8A02\u4F4D "),n(),a(2,"button",44),C("click",function(){u(e);let o=d();return c(o.onSubmit(o.bookingType.group))}),s(3," \u5718\u9AD4\u8A02\u4F4D "),n()}if(r&2){let e=d();m("disabled",e.disableGernalBook()),p(2),m("disabled",e.disableGroupBook())}}var me=class r{unreserved=T(!1);confirm=y();promotions=y();bookingType=je;form;defaultReturnTime=(0,le.default)().add(1,"day");totalPeople;classType;promotionType;promotionList;roundTrip;personalId=w("");coperateId=w("");selectedPromotion;departTripSection=q("departTripSection");returnTripSection=q("returnTripSection");filteredPromotionDataList=k(()=>{let{reservation:i}=this.reservationService,e=this.promotionType();return e===0?i.promotionDataList():i?.promotionDataList()?.filter(t=>t.promotionTypeId===e)});disableGernalBook=k(()=>this.totalPeople()>10);disableGroupBook=k(()=>this.roundTrip()||this.classType()===3||this.selectedPromotion()?.cancel_group_reservation);reservationService=b(Oe);formBuilder=b(ae);apiService=b(N);constructor(){this.form=this.formBuilder.group({profiles:this.formBuilder.array([]),departStation:[null,ee.required],arrivalStation:[null,ee.required],classType:["",ee.required],roundTrip:[!1],promotionType:[0],promotionCodeList:[""],promotionCode:[null]}),this.promotionType=M(this.form.get("promotionType").valueChanges.pipe(_e(e=>parseInt(e,10)),ve(()=>this.form.patchValue({promotionCodeList:""}))),{initialValue:0}),this.promotionList=M(this.form.get("promotionCodeList").valueChanges.pipe(ve(e=>this.form.patchValue({promotionCode:e}))),{initialValue:""}),this.totalPeople=M(this.form.valueChanges.pipe(_e(()=>this.form.get("profiles").controls.reduce((e,t)=>e+(t.value||0),0))),{initialValue:0}),this.roundTrip=M(this.form.get("roundTrip").valueChanges),this.classType=M(this.form.get("classType").valueChanges);let i=M(this.form.get("promotionCode").valueChanges);this.selectedPromotion=k(()=>this.reservationService.reservation.promotionDataList()?.find(t=>t.promotionCode===i())??null),Y(()=>{this.reservationService.start(this.unreserved())}),Y(()=>{let{reservation:e}=this.reservationService;e.data()&&(this.form.setControl("profiles",this.formBuilder.array(e.profiles().map(t=>this.formBuilder.control({value:null,disabled:!t.isEnable})))),this.form.patchValue({departStation:e.departStationList()[0],arrivalStation:e.arrivalStationList()[1]}),this.promotions.emit(e.promotionDataList()))})}swapStation(){let i=this.form.get("departStation")?.value,e=this.form.get("arrivalStation")?.value;this.form.get("departStation")?.setValue(e),this.form.get("arrivalStation")?.setValue(i)}onSubmit(i){if(this.apiService.loading)return;let e=Te(L({},this.form.value),{bookingType:i});e.tripType=e.roundTrip?2:1,e.profile=this.getProfiles(),e.membership={personalId:this.personalId(),coperateId:this.coperateId()},this.departTripSection()?.mergeValues(e,"depart"),this.returnTripSection()?.mergeValues(e,"return"),e.allTrain=0,e.requeryTrain=!1,["profiles","promotionType","promotionCodeList","roundTrip"].forEach(t=>{delete e[t]}),this.apiService.execute(this.apiService.queryTrain(e),t=>{this.confirm.emit({query:e,data:t.data})})}validate(){let i=[];this.form.get("departStation")?.value===this.form.get("arrivalStation")?.value&&i.push("\u51FA\u767C\u7AD9\u8207\u5230\u9054\u7AD9\u9700\u4E0D\u540C");let e=this.getProfiles();e.length>4&&i.push("\u6700\u591A\u53EA\u80FD\u540C\u6642\u8CFC\u8CB7\u56DB\u7A2E\u8EAB\u5206\u5225"),e.length<1&&i.push("\u81F3\u5C11\u9700\u8F38\u5165\u4E00\u500B\u8EAB\u5206\u5225\u7684\u5F35\u6578");let t=Math.max(...e.map(_=>_.quantity));this.form.get("roundTrip")?.value&&t>5&&i.push("\u4E00\u822C\u8A02\u4F4D\u53BB\u56DE\u7A0B\u6700\u591A\u50C5\u80FD\u9078\u64C75\u5F35\u7968");let o=(0,le.default)(`${this.form.get("departDate")?.value} ${this.form.get("departHour")?.value}:${this.form.get("departMinute")?.value}`),l=(0,le.default)(`${this.form.get("returnDate")?.value} ${this.form.get("returnHour")?.value}:${this.form.get("returnMinute")?.value}`);return(l.isBefore(o)||l.isSame(o))&&i.push("\u8A02\u8CFC\u53BB\u56DE\u7A0B\uFF0C\u56DE\u7A0B\u6642\u9593\u65E9\u65BC\u53BB\u7A0B\u6642\u9593"),e.some(_=>_.code==="P")&&this.form.get("classType").value===2&&i.push("\u5B78\u751F\u7968\u4E0D\u9069\u7528\u5546\u52D9\u8ECA\u5EC2\uFF0C\u8ACB\u91CD\u65B0\u9078\u64C7"),i}getProfiles(){let i=this.reservationService.reservation.profiles();return this.form.get("profiles").value.map((e,t)=>({code:i[t].code,quantity:e})).filter(e=>e.quantity)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=g({type:r,selectors:[["app-step1"]],viewQuery:function(e,t){e&1&&(G(t.departTripSection,tt,5),G(t.returnTripSection,it,5)),e&2&&z(2)},inputs:{unreserved:[1,"unreserved"]},outputs:{confirm:"confirm",promotions:"promotions"},decls:41,vars:13,consts:[["departTripSection",""],["returnTripSection",""],[1,"py-2",3,"formGroup"],[1,"border","rounded","p-3","shadow-sm","bg-white","fs-6","m-0","w-100"],[1,"row","mb-2","align-items-center","w-100"],["for","departStation",1,"col-auto"],[1,"col"],["id","departStation","formControlName","departStation",1,"form-select","form-select-sm","fs-6"],[3,"value"],[1,"col-auto"],["href","javascript:;",3,"click"],[1,"fa-solid","fa-right-left"],["for","arrivalStation",1,"col-auto"],["id","arrivalStation","formControlName","arrivalStation",1,"form-select","form-select-sm","fs-6"],["type","checkbox","id","roundTrip","formControlName","roundTrip",1,"form-check-input","me-1","fs-6"],["for","roundTrip",1,"form-check-label"],[1,"col-auto","text-end","text-warning"],["formArrayName","profiles",1,"row","mb-2","align-items-center","w-100"],[1,"col","d-flex","align-items-center","p-0","me-3"],[1,"row","mb-2","w-100"],[3,"personalIdChange","coperateIdChange","coperateIdDisabled","personalIdDisabled","rowStyle"],["title","\u53BB\u7A0B",1,"mt-2",3,"hasTitle","hasBorder","hasTrainNumber"],["title","\u56DE\u7A0B",1,"mt-2",3,"time","hasTitle","hasBorder","hasTrainNumber"],[1,"border","rounded","shadow-sm","mt-2","p-3","fs-6"],[1,"d-flex","align-items-center","gap-2","fs-6","w-100","justify-content-center","mt-2"],["type","button",1,"btn","bg-primary","text-white","px-4",3,"disabled"],[1,"text-center","text-nowrap","me-1",3,"for"],["type","number","min","0",1,"fs-6","form-control","form-control-sm",3,"id","formControlName"],["type","radio",1,"form-check-input","me-1",3,"id","formControlName","value"],[1,"form-check-label",3,"for"],[1,"d-flex","flex-wrap","align-items-center","justify-content-between"],[1,"border","rounded","d-flex","align-items-center","px-2","py-1","flex-grow-1","me-2"],[1,"d-flex","align-items-center","me-3","w-50"],["for","promotionType",1,"me-2","text-nowrap"],["id","promotionType","formControlName","promotionType",1,"form-select","form-select-sm","w-100"],[1,"d-flex","align-items-center","w-50"],["for","promotionCodeList",1,"me-2","text-nowrap"],["id","promotionCodeList","formControlName","promotionCodeList",1,"form-select","form-select-sm","w-100"],["value",""],[1,"mx-2"],[1,"border","rounded","d-flex","align-items-center","px-2","py-1",2,"min-width","250px"],["for","promotionCode",1,"me-2","text-nowrap"],["type","text","id","promotionCode","formControlName","promotionCode",1,"form-control","form-control-sm"],["type","button",1,"btn","bg-primary","text-white","px-4",3,"click","disabled"],["type","button",1,"btn","btn-secondary","px-4",3,"click","disabled"]],template:function(e,t){if(e&1){let o=E();a(0,"form",2)(1,"div",3)(2,"div",4)(3,"label",5),s(4,"\u51FA\u767C\u7AD9"),n(),a(5,"div",6)(6,"select",7),A(7,pt,2,2,"option",8,be),n()(),a(9,"div",9)(10,"a",10),C("click",function(){return u(o),c(t.swapStation())}),f(11,"i",11),n()(),a(12,"label",12),s(13,"\u5230\u9054\u7AD9"),n(),a(14,"div",6)(15,"select",13),A(16,st,2,2,"option",8,be),n()(),a(18,"div",9),f(19,"input",14),a(20,"label",15),s(21,"\u53BB\u56DE\u7968"),n()(),a(22,"div",16)(23,"span"),s(24,"\u7E3D\u4EBA\u6578 "),n(),a(25,"strong"),s(26),n()()(),a(27,"div",17)(28,"div",6),s(29,"\u8EAB\u5206\u5225/\u5F35\u6578"),n(),A(30,lt,4,4,"div",18,ot),n(),S(32,dt,5,0,"div",19),a(33,"app-member-code",20),C("personalIdChange",function(_){return u(o),c(t.personalId.set(_))})("coperateIdChange",function(_){return u(o),c(t.coperateId.set(_))}),n()(),f(34,"app-trip-section",21,0),S(36,ut,2,4,"app-trip-section",22)(37,Ct,23,3,"div",23),a(38,"div",24),S(39,_t,2,1,"button",25)(40,vt,4,2),n()()}if(e&2){let o,l;m("formGroup",t.form),p(7),V(t.reservationService.reservation.departStationList()),p(9),V(t.reservationService.reservation.arrivalStationList()),p(10),D(t.totalPeople()),p(4),V(t.reservationService.reservation.profiles()),p(2),h(t.unreserved()?-1:32),p(),m("coperateIdDisabled",!(!((o=(o=t.selectedPromotion())==null?null:o.accumulateCorporateMembers)!==null&&o!==void 0)||o))("personalIdDisabled",!(!((l=(l=t.selectedPromotion())==null?null:l.accumulateMembers)!==null&&l!==void 0)||l))("rowStyle",!0),p(),m("hasTitle",!0)("hasBorder",!0)("hasTrainNumber",!0),p(2),h(t.roundTrip()?36:-1),p(),h(t.unreserved()?-1:37),p(2),h(t.unreserved()?39:-1),p(),h(t.unreserved()?-1:40)}},dependencies:[x,I,oe,Ge,Re,Z,Me,Ve,qe,Pe,te,ie,Qe,B,ne,re,Le,Q,Ye],encapsulation:2})};var ye=we(He());function ht(r,i){if(r&1){let e=E();a(0,"div",4)(1,"app-timetable",8),O("indexChange",function(o){u(e);let l=d(2);return R(l.inboundIndex,o)||(l.inboundIndex=o),c(o)}),C("search",function(o){u(e);let l=d(2);return c(l.onInboundSearch(o))}),n()()}if(r&2){let e=d(2);p(),m("records",e.inbound())("promotion",e.promotion())("query",e.query()),H("index",e.inboundIndex),m("outbound",!1)}}function St(r,i){if(r&1){let e=E();a(0,"div",1)(1,"div",2)(2,"app-timetable",3),O("indexChange",function(o){u(e);let l=d();return R(l.outboundIndex,o)||(l.outboundIndex=o),c(o)}),C("search",function(o){u(e);let l=d();return c(l.onOutboundSearch(o))}),n()(),S(3,ht,2,5,"div",4),a(4,"div",5)(5,"button",6),C("click",function(){u(e);let o=d();return c(o.onConfirm())}),s(6,"\u958B\u59CB\u8A02\u4F4D"),n(),a(7,"button",6),C("click",function(){u(e);let o=d();return c(o.onShowAll())}),s(8),n(),a(9,"button",7),C("click",function(){u(e);let o=d();return c(o.back.emit())}),s(10,"\u91CD\u8A2D\u67E5\u8A62\u689D\u4EF6"),n()()()}if(r&2){let e=d();v("h-100",e.roundTrip()),p(),v("flex-1",e.roundTrip()),p(),m("records",e.outbound())("promotion",e.promotion())("query",e.query()),H("index",e.outboundIndex),p(),h(e.roundTrip()?3:-1),p(5),W(" ",e.showAll()?"\u50C5\u986F\u793A\u53EF\u552E\u8ECA\u6B21":"\u986F\u793A\u6700\u8FD1\u6240\u6709\u8ECA\u6B21"," ")}}var de=class r{confirm=y();back=y();query=he(null);data=he(null);inbound=k(()=>this.data()?.inbound||[]);outbound=k(()=>this.data()?.outbound||[]);promotion=k(()=>this.data()?.promotion||null);showAll=k(()=>this.query()?.allTrain===1);roundTrip=k(()=>!!this.data()?.inbound);outboundIndex=0;inboundIndex=0;apiService=b(N);onOutboundSearch(i){this.query.update(e=>(e.departTime=`${i.hour}:${i.minute}`,e.departSearchMethod=i.searchMethod,L({},e))),this.updateQuery()}onInboundSearch(i){this.query.update(e=>(e.returnTime=`${i.hour}:${i.minute}`,e.returnSearchMethod=i.searchMethod,L({},e))),this.updateQuery()}onShowAll(){this.query.update(i=>(i.allTrain=i.allTrain===0?1:0,L({},i))),this.updateQuery()}onConfirm(){this.apiService.loading||this.apiService.execute(this.apiService.chooseTrain(this.outboundIndex.toString(),(this.inboundIndex||"").toString()),i=>{this.confirm.emit(i.data.trip)})}validate(){let i=[],e=this.outbound().find(o=>o.index===this.outboundIndex),t=this.inbound().find(o=>o.index===this.inboundIndex);if(this.roundTrip()&&e.departDate===t.departDate){let o=(0,ye.default)(`${e.arrivalDate} ${e.arrivalTime}`,"YYYY/MM/DD HH:mm"),l=(0,ye.default)(`${t.departDate} ${t.departTime}`,"YYYY/MM/DD HH:mm");if(l.isBefore(o)||l.isSame(o)){let{departDate:_}=this.query(),xe=_.split("/")[0];i.push(`\u56DE\u7A0B\u51FA\u767C\u6642\u9593\u5FC5\u9808\u665A\u65BC\u53BB\u7A0B\u5230\u9054\u6642\u9593\u3002\u53BB\u7A0B\u51FA\u767C(\u5230\u9054)\u6642\u9593${xe}/${o.format("MM/DD HH:mm")} - \u56DE\u7A0B\u51FA\u767C\u6642\u9593${xe}/${l.format("MM/DD HH:mm")}`)}}return i}updateQuery(){this.apiService.loading||this.apiService.execute(this.apiService.queryTrain(this.query()),i=>{this.data.set(i.data)})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=g({type:r,selectors:[["app-step2"]],inputs:{query:[1,"query"],data:[1,"data"]},outputs:{confirm:"confirm",back:"back",query:"queryChange",data:"dataChange"},decls:1,vars:1,consts:[[1,"d-flex","flex-column","py-2",3,"h-100"],[1,"d-flex","flex-column","py-2"],[1,"border","rounded","shadow-sm","p-0","overflow-hidden"],[3,"indexChange","search","records","promotion","query","index"],[1,"flex-1","border","rounded","shadow-sm","p-0","overflow-hidden","mt-2"],[1,"d-flex","gap-3","justify-content-center","mt-2"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-dark",3,"click"],[3,"indexChange","search","records","promotion","query","index","outbound"]],template:function(e,t){e&1&&S(0,St,11,10,"div",0),e&2&&h(t.data()?0:-1)},dependencies:[I,x,Ue],encapsulation:2})};var F=class r{readonly=T(!1);groupInfo=T(null);form;constructor(i){this.form=i.group({groupName:[this.groupInfo()?.groupName??""],personId:[this.groupInfo()?.personId??""],firstName:[this.groupInfo()?.firstName??""],lastName:[this.groupInfo()?.lastName??""],phoneNumber:[this.groupInfo()?.phoneNumber??""]}),Y(()=>{this.groupInfo()&&this.form.patchValue(this.groupInfo())})}getValues(){return this.form.value}static \u0275fac=function(e){return new(e||r)(ke(ae))};static \u0275cmp=g({type:r,selectors:[["app-group-leader"]],inputs:{readonly:[1,"readonly"],groupInfo:[1,"groupInfo"]},decls:18,vars:16,consts:[[1,"w-100","d-flex","align-items-center",3,"formGroup"],["for","groupName",1,"text-nowrap","m-1"],[1,"m-1"],["id","groupName","formControlName","groupName",1,"form-control","form-control-sm","fs-6",3,"readonly"],["for","personId",1,"text-nowrap","m-1"],["id","personId","formControlName","personId",1,"form-control","form-control-sm","fs-6",3,"readonly"],["for","firstName",1,"text-nowrap","m-1"],[1,"m-1","d-flex"],["id","firstName","placeholder","\u59D3","formControlName","firstName",1,"form-control","form-control-sm","fs-6",3,"readonly"],["id","lastName","placeholder","\u540D","formControlName","lastName",1,"form-control","form-control-sm","fs-6","ms-1",3,"readonly"],["for","phoneNumber",1,"text-nowrap","m-1"],["id","phoneNumber","formControlName","phoneNumber",1,"form-control","form-control-sm","fs-6",3,"readonly"]],template:function(e,t){e&1&&(a(0,"form",0)(1,"label",1),s(2,"\u5718\u9AD4\u540D\u7A31"),n(),a(3,"div",2),f(4,"input",3),n(),a(5,"label",4),s(6,"\u8EAB\u5206\u8B49\u865F/\u5718\u9AD4\u7D71\u7DE8"),n(),a(7,"div",2),f(8,"input",5),n(),a(9,"label",6),s(10,"\u4EE3\u8868\u4EBA\u59D3\u540D"),n(),a(11,"div",7),f(12,"input",8)(13,"input",9),n(),a(14,"label",10),s(15,"\u9023\u7D61\u96FB\u8A71"),n(),a(16,"div",2),f(17,"input",11),n()()),e&2&&(m("formGroup",t.form),p(4),v("disabled",t.readonly()),m("readonly",t.readonly()),p(4),v("disabled",t.readonly()),m("readonly",t.readonly()),p(4),v("disabled",t.readonly()),m("readonly",t.readonly()),p(),v("disabled",t.readonly()),m("readonly",t.readonly()),p(4),v("disabled",t.readonly()),m("readonly",t.readonly()))},dependencies:[B,oe,Z,te,ie,ne,re],encapsulation:2})};function bt(r,i){r&1&&f(0,"app-group-leader")}function gt(r,i){if(r&1){let e=E();a(0,"div",1)(1,"app-bound",2),C("seatChange",function(o){u(e);let l=d();return c(l.onSeatChange(o))}),n(),a(2,"app-member-code",3),O("personalIdChange",function(o){let l=u(e);return R(l.membership.personalId,o)||(l.membership.personalId=o),c(o)})("coperateIdChange",function(o){let l=u(e);return R(l.membership.coperateId,o)||(l.membership.coperateId=o),c(o)}),n(),S(3,bt,1,0,"app-group-leader"),a(4,"div",4)(5,"app-passengers",5,0),C("needToCheckChange",function(o){u(e);let l=d();return c(l.needToCheck.set(o))}),n()(),a(7,"div",6)(8,"div",7)(9,"div",8),s(10,"\u4FC3\u92B7\u4EE3\u78BC"),n(),f(11,"app-promotion-tickets",9),n(),a(12,"div",10),f(13,"input",11),a(14,"label",12),s(15,"\u4FDD\u7559\u7968\u6839\u4F5C\u70BA\u4F9D\u64DA"),n()()(),a(16,"div",13)(17,"button",14),C("click",function(){u(e);let o=d();return c(o.onSubmit())}),s(18,"\u78BA\u8A8D"),n(),a(19,"button",15),C("click",function(){u(e);let o=d();return c(o.onCheck())}),s(20," \u8CC7\u683C\u6AA2\u6838 "),n(),a(21,"button",16),C("click",function(){u(e);let o=d();return c(o.back.emit())}),s(22,"\u91CD\u65B0\u9078\u64C7\u8ECA\u6B21"),n()()()}if(r&2){let e,t,o=i,l=d(),_=X(0);p(),m("order",_)("isShort",!1)("hasCheckbox",!1),p(),H("personalId",o.membership.personalId)("coperateId",o.membership.coperateId),m("coperateIdDisabled",!(!((e=(e=_.selectedPromotion())==null?null:e.accumulateCorporateMembers)!==null&&e!==void 0)||e))("personalIdDisabled",!(!((t=(t=_.selectedPromotion())==null?null:t.accumulateMembers)!==null&&t!==void 0)||t))("rowStyle",!0),p(),h(o!=null&&o.isGroup?3:-1),p(2),m("roundTrip",_.roundTrip())("passengers",o.passengers)("promotion",_.selectedPromotion()),p(6),m("promotionTickets",_.promotionTickets()),p(6),m("disabled",!_.seatTaken()),p(2),m("disabled",!l.needToCheck())}}var ue=class r{confirm=y();back=y();order=T();needToCheck=w(!1);apiService=b(N);passengersComponent=q($);groupLeaderComponent=q(F);onCheck(){if(this.apiService.loading)return;let i=this.passengersComponent().getValues(),e=new Set(i.filter(o=>o.profile==="\u611B\u5FC3"&&o.personalId).map(o=>o.personalId)),t={passengers:Array.of(e).map(o=>({personalId:o,profileType:3}))};this.apiService.execute(this.apiService.querySpecialPassenger(t),o=>{this.passengersComponent().setPassengers(o.passengers)})}onSeatChange(i){this.order().trip.set(i)}onSubmit(){if(this.apiService.loading)return;let i=this.passengersComponent().getValues(),e=this.groupLeaderComponent()?.getValues(),t=this.order().trip(),o={groupInfo:e,membership:t.membership,passengerInfo:i};this.apiService.execute(this.apiService.generalBooking(o),l=>{this.confirm.emit(l.data.trip)})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=g({type:r,selectors:[["app-step3"]],viewQuery:function(e,t){e&1&&(G(t.passengersComponent,$,5),G(t.groupLeaderComponent,F,5)),e&2&&z(2)},inputs:{order:[1,"order"]},outputs:{confirm:"confirm",back:"back"},decls:2,vars:2,consts:[["passengers",""],[1,"d-flex","flex-column","h-100","py-2"],[3,"seatChange","order","isShort","hasCheckbox"],[1,"mt-2",3,"personalIdChange","coperateIdChange","personalId","coperateId","coperateIdDisabled","personalIdDisabled","rowStyle"],[1,"mt-2","overflow-auto"],[3,"needToCheckChange","roundTrip","passengers","promotion"],[1,"d-flex","gap-3","justify-content-start","mt-2"],[1,"d-flex","w-50"],[1,"me-5"],[3,"promotionTickets"],[1,"ms-auto"],["type","checkbox","id","retain",1,"form-check-input","me-1","fs-6"],["for","retain"],[1,"d-flex","gap-3","justify-content-center","mt-2"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["type","button",1,"btn","btn-dark","ms-auto",3,"click","disabled"],["type","button",1,"btn","btn-dark",3,"click"]],template:function(e,t){if(e&1&&(J(0),S(1,gt,23,15,"div",1)),e&2){let o,l=K(t.order());p(),h((o=l.trip())?1:-1,o)}},dependencies:[I,x,pe,B,$,Q,F,se],encapsulation:2})};function yt(r,i){if(r&1&&f(0,"app-group-leader",6),r&2){let e=d();m("groupInfo",e.groupInfo)("readonly",!0)}}function xt(r,i){if(r&1){let e=E();a(0,"div",0)(1,"div",1)(2,"div")(3,"span",2),s(4,"\u8A02\u4F4D\u4EE3\u865F"),n(),a(5,"span"),s(6),n()(),a(7,"div",3)(8,"span",2),s(9,"\u4ED8\u6B3E\u671F\u9650"),n(),a(10,"span"),s(11,"\u7ACB\u5373\u4ED8\u6B3E"),n()()(),f(12,"app-bound",4)(13,"app-member-code",5),S(14,yt,1,2,"app-group-leader",6),a(15,"div",7),f(16,"app-passengers",8),n(),a(17,"div",9)(18,"div",10)(19,"div",11),s(20,"\u7E3D\u4EBA\u6578"),n(),a(21,"div",12),f(22,"app-people-counter",13),n()(),a(23,"div",10)(24,"div",11),s(25,"\u7E3D\u7968\u50F9"),n(),a(26,"div",3),s(27),n()()(),a(28,"div",14)(29,"div",11),s(30,"\u4FC3\u92B7\u4EE3\u78BC"),n(),f(31,"app-promotion-tickets",15),n(),a(32,"div",16)(33,"button",17),C("click",function(){u(e);let o=d();return c(o.onSubmit())}),s(34,"\u4ED8\u6B3E\u53D6\u7968"),n(),a(35,"button",18),C("click",function(){u(e);let o=d();return c(o.onCancel())}),s(36,"\u53D6\u6D88"),n()()()}if(r&2){let e=i;d();let t=X(0);p(6),D(e.pnrId),p(6),m("order",t)("seatSelectable",!1)("isShort",!1)("hasCheckbox",!1),p(),m("personalId",e.membership.personalId)("coperateId",e.membership.coperateId)("readonly",!0)("rowStyle",!0),p(),h(e!=null&&e.isGroup?14:-1),p(2),m("roundTrip",t.roundTrip())("passengers",e.passengers)("readonly",!0),p(6),m("order",t),p(5),D(t.totalFare()),p(4),m("promotionTickets",t.promotionTickets())}}var ce=class r{confirm=y();cancel=y();order=T();onSubmit(){this.confirm.emit()}onCancel(){return U(this,null,function*(){this.cancel.emit()})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=g({type:r,selectors:[["app-step4"]],inputs:{order:[1,"order"]},outputs:{confirm:"confirm",cancel:"cancel"},decls:2,vars:2,consts:[[1,"d-flex","flex-column","h-100","py-2"],[1,"d-flex","mb-2"],[1,"me-3"],[1,"ms-auto"],[3,"order","seatSelectable","isShort","hasCheckbox"],[1,"mt-2",3,"personalId","coperateId","readonly","rowStyle"],[3,"groupInfo","readonly"],[1,"mt-2","overflow-auto"],[3,"roundTrip","passengers","readonly"],[1,"bg-warning-subtle","mt-2","p-2","w-50"],[1,"d-flex"],[1,"me-5"],[1,"d-flex","gap-2"],[3,"order"],[1,"d-flex","w-50"],[3,"promotionTickets"],[1,"d-flex","gap-3","justify-content-center","mt-2"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-dark",3,"click"]],template:function(e,t){if(e&1&&(J(0),S(1,xt,37,16,"div",0)),e&2){let o,l=K(t.order());p(),h((o=l.trip())?1:-1,o)}},dependencies:[x,I,B,pe,$,Q,F,se,ze],encapsulation:2})};function Tt(r,i){if(r&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"strong"),s(5,"\u8A02\u4F4D\u4EE3\u865F\uFF1A"),n(),s(6),n()(),a(7,"div",2)(8,"div")(9,"strong"),s(10,"\u4ED8\u6B3E\u671F\u9650\uFF1A"),n()()()(),a(11,"div",1)(12,"div",2)(13,"div")(14,"strong"),s(15,"\u8A02\u4F4D\u901A\u8DEF\uFF1A"),n(),s(16),n()(),a(17,"div",2)(18,"div")(19,"strong"),s(20,"\u4ED8\u6B3E\u65B9\u5F0F\uFF1A"),n(),s(21," \u5C1A\u672A\u4ED8\u6B3E"),n()()()()),r&2){let e=i;p(6),W(" ",e.pnrId,""),p(10),W(" ",e.bookChanel,"")}}var fe=class r{data=T(null);static \u0275fac=function(e){return new(e||r)};static \u0275cmp=g({type:r,selectors:[["app-step4-cancel"]],inputs:{data:[1,"data"]},decls:1,vars:1,consts:[[1,"container","py-3"],[1,"row","mb-2"],[1,"col-6"]],template:function(e,t){if(e&1&&S(0,Tt,22,2,"div",0),e&2){let o;h((o=t.data())?0:-1,o)}},encapsulation:2})};var Ce=class r{unreserved=w(!1);step=w(1);step1Query=w(null);step1Data=w(null);step4CancelData=w(null);order=new We;mmiService=b(Ae);messageService=b($e);apiService=b(N);router=b(Ne);activatedRoute=b(Be);cancelingBooking=!1;constructor(){let i=!!this.activatedRoute.snapshot.data.unreserved;this.unreserved.set(i),this.mmiService.breadcrumb.set(i?["\u7AD9\u52D9\u54E1\u503C\u73ED","\u81EA\u7531\u5EA7(\u6307\u5B9A\u8ECA\u6B21)","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21"]:["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21"])}onStep1Confirm(i){this.step1Query.set(i.query),this.step1Data.set(i.data),this.step.set(2),this.mmiService.breadcrumb.set(this.unreserved()?["\u7AD9\u52D9\u54E1\u503C\u73ED","\u81EA\u7531\u5EA7(\u6307\u5B9A\u8ECA\u6B21)","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21"]:["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21"])}onStep2Back(){this.step.set(1),this.mmiService.breadcrumb.set(this.unreserved()?["\u7AD9\u52D9\u54E1\u503C\u73ED","\u81EA\u7531\u5EA7(\u6307\u5B9A\u8ECA\u6B21)","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21"]:["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21"])}onStep2Confirm(i){this.order.trip.set(i),this.step.set(3),this.mmiService.breadcrumb.set(this.unreserved()?["\u7AD9\u52D9\u54E1\u503C\u73ED","\u81EA\u7531\u5EA7(\u6307\u5B9A\u8ECA\u6B21)","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21","\u9078\u64C7\u5EA7\u4F4D/\u586B\u5BEB\u4E58\u5BA2\u8CC7\u6599"]:["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21","\u9078\u64C7\u5EA7\u4F4D/\u586B\u5BEB\u4E58\u5BA2\u8CC7\u6599"])}onStep3Confirm(i){this.order.trip.set(i),this.step.set(4),this.mmiService.breadcrumb.set(this.unreserved()?["\u7AD9\u52D9\u54E1\u503C\u73ED","\u81EA\u7531\u5EA7(\u6307\u5B9A\u8ECA\u6B21)","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21","\u9078\u64C7\u5EA7\u4F4D/\u586B\u5BEB\u4E58\u5BA2\u8CC7\u6599","\u8A02\u4F4D\u5B8C\u6210"]:["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21","\u9078\u64C7\u5EA7\u4F4D/\u586B\u5BEB\u4E58\u5BA2\u8CC7\u6599","\u8A02\u4F4D\u5B8C\u6210"])}onStep3Back(){this.step.set(2),this.mmiService.breadcrumb.set(this.unreserved()?["\u7AD9\u52D9\u54E1\u503C\u73ED","\u81EA\u7531\u5EA7(\u6307\u5B9A\u8ECA\u6B21)","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21"]:["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21"])}onStep4Confirm(){this.mmiService.breadcrumb.set(["\u7AD9\u52D9\u54E1\u503C\u73ED","\u4E00\u822C\u8A02\u4F4D","\u67E5\u8A62\u65C5\u7A0B\u73ED\u6B21","\u9078\u64C7\u8ECA\u6B21","\u9078\u64C7\u5EA7\u4F4D/\u586B\u5BEB\u4E58\u5BA2\u8CC7\u6599","\u8A02\u4F4D\u5B8C\u6210","\u4ED8\u6B3E"]),this.step.set(5),this.router.navigate(["/mmi/main/payment"])}onStep4Cancel(){this.cancelBooking()}canDeactiveGuard(){return this.step()===4?(this.cancelBooking(),!1):!0}cancelBooking(){return U(this,null,function*(){if(this.cancelingBooking||this.apiService.loading)return!1;this.cancelingBooking=!0;let i=yield this.messageService.show({title:"\u53D6\u6D88\u8A02\u7968",message:"\u78BA\u5B9A\u53D6\u6D88\u8A02\u7968\u7D00\u9304\uFF1F",confirmation:!0,cancelText:"\u5426",confirmText:"\u662F"}).result;return this.cancelingBooking=!1,i?(this.apiService.execute(this.apiService.cancelBooking(),e=>{this.step4CancelData.set(e.data),this.messageService.setErrors(["\u53D6\u6D88\u8A02\u4F4D\u6210\u529F\uFF01"]),this.step.set(42)}),!0):!1})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=g({type:r,selectors:[["app-new"]],decls:6,vars:16,consts:[[3,"confirm","promotions","unreserved"],[3,"confirm","back","query","data"],[3,"confirm","back","order"],[3,"confirm","cancel","order"],[3,"data"]],template:function(e,t){e&1&&(f(0,"app-errors"),a(1,"app-step1",0),C("confirm",function(l){return t.onStep1Confirm(l)})("promotions",function(l){return t.order.promotions.set(l)}),n(),a(2,"app-step2",1),C("confirm",function(l){return t.onStep2Confirm(l)})("back",function(){return t.onStep2Back()}),n(),a(3,"app-step3",2),C("confirm",function(l){return t.onStep3Confirm(l)})("back",function(){return t.onStep3Back()}),n(),a(4,"app-step4",3),C("confirm",function(){return t.onStep4Confirm()})("cancel",function(){return t.onStep4Cancel()}),n(),f(5,"app-step4-cancel",4)),e&2&&(p(),v("d-none",t.step()!==1),m("unreserved",t.unreserved()),p(),v("d-none",t.step()!==2),m("query",t.step1Query())("data",t.step1Data()),p(),v("d-none",t.step()!==3),m("order",t.order),p(),v("d-none",t.step()!==4),m("order",t.order),p(),v("d-none",t.step()!==42),m("data",t.step4CancelData()))},dependencies:[x,I,me,de,ue,ce,fe,Je],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})};var wt=[{path:"",component:Ce,canDeactivate:[Ke]}],Xe=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=De({type:r});static \u0275inj=Ee({imports:[x,Fe.forChild(wt)]})};export{Xe as NewModule};
